import{O as F,Z as P,av as o,D as c,G as m,I as s,ah as p,aF as N,P as v,E as b,K as C,F as _,az as z,ax as Q,x as q,A as U,o as B,w as E,B as H,H as K,J as h,am as G,ay as M,L as R,aG as Y,ag as L,M as A,af as V,Q as j}from"./index.e5170aa8.js";import{Q as J}from"./QDate.6e4f038a.js";import{b as d,f as W}from"./app.4ae85756.js";import{_ as X}from"./plugin-vue_export-helper.21dcd24c.js";import"./use-dark.c3bc50bb.js";import"./date.3f830218.js";const Z=["innerHTML"],ee={__name:"ListaTRComponent",props:{event:{type:Object,required:!0}},setup($){const S=$,{event:i}=S;function g(a){return T(a.date)&&!["AVISOS \xC0 IRMANDADE"].includes(a.title.toUpperCase())}function y(a){return g(a)&&!["VIAGENS MISSION\xC1RIAS"].includes(a.title.toUpperCase())}function e(a){return a.replace(/(\r\n|\n|\r)/g,"<br>")}function D(a){return!(a instanceof Date)||isNaN(a.getTime())?"":["Dom","Seg","Ter","Qua","Qui","Sex","S\xE1b"][a.getDay()]||""}function k(a){return!(a instanceof Date)||isNaN(a.getTime())?"":String(a.getDate()).padStart(2,"0")}function w(a){return!(a instanceof Date)||isNaN(a.getTime())?"":String(a.getMonth()+1).padStart(2,"0")}function x(a){if(!(a instanceof Date)||isNaN(a.getTime()))return"";const t=String(a.getHours()).padStart(2,"0"),r=String(a.getMinutes()).padStart(2,"0");return`${t}:${r}`}function T(a){return a instanceof Date&&!isNaN(a.getTime())}return(a,t)=>F((c(),m("tr",null,[s("td",{style:N(g(o(i))?"":"display: none;")},[s("b",null,p(k(o(i).date))+"/"+p(w(o(i).date)),1)],4),s("td",{style:N(g(o(i))?"":"display: none;")},p(D(o(i).date)),5),s("td",{style:N(y(o(i))?"":"display: none;")},p(x(o(i).date)),5),s("td",null,[v(p(o(i).locale)+" ",1),o(i)?.recurring&&o(i)?.recurring.length?(c(),b(C,{key:0,class:"print-hide",name:"event_repeat",style:{color:"#9e9e9e"}})):_("",!0)]),o(i).desc?(c(),m("td",{key:0,innerHTML:e(o(i).desc)},null,8,Z)):_("",!0)],512)),[[P,o(i).title||o(i).locale||o(i).desc]])}};const te={key:1},ae={class:"text-center"},se={class:"print-hide q-pa-sm row flex-center"},ne={id:"lista"},re={class:"print-hide fixed-bottom z-top menu flex space-between"},oe={class:"search"},ie={class:"q-pr-sm"},le={class:"q-pr-sm"},ce={class:"lista"},de=["summary"],ue={colspan:"5"},pe={key:0,class:"print-hide"},me={class:"print-only right"},fe=["href"],ge={key:1,class:"print-only"},he={__name:"ListasPage",setup($){const S=z(),i=Q(),g=q(!0),y=q(!1),e=U({search:S.query.pesquisar?.toString()||"",locale:S.params.local?.toString()||"",titles:[],date:"",from:d.agenda.from,to:d.agenda.to,eventsCalendar:[],listFiltered:[]}),D=t=>{i.push({path:`/event/edit/${t.id}`})},k=async()=>{await w(),e.eventsCalendar=Array.from(new Set(e.listFiltered.filter(t=>t.date instanceof Date).map(t=>t.date.toISOString().split("T")[0].replace(/-/g,"/")))),g.value=!1},w=async()=>{try{if(d.agenda.items.length){let t=d.agenda.items.filter(n=>{try{return n.date&&n.date.getTime()>new Date(`${e.from} 00:00:00`).getTime()&&n.end&&n.end.getTime()<new Date(`${e.to} 23:59:59`).getTime()}catch{return!1}});if(e.date&&(t=t.filter(n=>n.date.toISOString().split("T")[0]===e.date)),!e.search&&!e.locale)return[];const r=n=>n.trim().toUpperCase().normalize("NFD").replace(/\p{Diacritic}/gu,"");let f=r(e.search),l=r(e.locale);if(/^(\*)/gi.test(e.search)&&(l="",f=f.replace(/^(\*|\/)/gi,"").trim()),l){const n=new RegExp(`^${l}`);t=t.filter(u=>r(u.list).includes(l)||n.test(r(u.locale)))}if(f)try{const n=new RegExp(f,"gi");t=t.filter(u=>{const I=`${u.date?.toLocaleString()} ${u.title} ${u.locale} ${u.desc}`;return n.test(I)||f.split(" ").every(O=>new RegExp(`\\b${O}`,"i").test(r(I)))})}catch{console.log("Regex search inv\xE1lido!")}e.listFiltered.length=0,t.forEach(n=>{e.listFiltered.push(n)}),e.titles=[...new Set(e.listFiltered.map(n=>n.title))]}}catch(t){console.error("Erro ao atualizar lista: ",t)}},x=t=>{if(t.altKey&&t.key.toLowerCase()==="a")t.preventDefault(),t.stopPropagation(),i.push("/event/edit");else if(t.altKey&&["/","*"].includes(t.key)||t.ctrlKey&&t.key==="f"||t.key==="/"&&document.activeElement.tagName!=="INPUT"&&document.activeElement.tagName!=="TEXTAREA"){t.preventDefault(),t.stopPropagation();const r=document.querySelector('input[type="text"]');r&&r.focus()}};B(async()=>{window.addEventListener("keydown",x),E(()=>d.agenda.from,()=>{e.from=d.agenda.from,e.to=d.agenda.to}),E([()=>e.search,()=>e.date],w),E([()=>d.agenda.items],k),k()}),H(()=>{window.removeEventListener("keydown",x)});const T=async()=>{try{y.value=!0,await W.post("/api/agenda/updateall")}catch{}y.value=!1},a=()=>{window.print()};return(t,r)=>{const f=K("router-link");return g.value?(c(),m("div",{key:0,class:M([["loading-overlay",{show:g.value}],"print-hide"])},[h(G,{size:"90px",color:"dark"})],2)):(c(),m("div",te,[s("div",ae,[r[4]||(r[4]=s("div",{class:"print-only"},"LISTA DE ATENDIMENTO E DIVERSOS",-1)),s("div",null,[s("b",null,p(e.locale.replace(/-$/,"").trim()),1),s("p",null,[h(f,{to:"/settings"},{default:R(()=>[v(p(e.from.split("-").reverse().join("/"))+" \xE0 "+p(e.to.split("-").reverse().join("/")),1)]),_:1})])])]),s("div",se,[h(J,{modelValue:e.date,"onUpdate:modelValue":r[0]||(r[0]=l=>e.date=l),options:e.eventsCalendar,mask:"YYYY-MM-DD",minimal:"",color:"dark"},null,8,["modelValue","options"])]),s("div",ne,[s("div",re,[s("div",oe,[F(s("input",{class:"z-top",type:"text","onUpdate:modelValue":r[1]||(r[1]=l=>e.search=l),placeholder:"Pesquisar...","x-webkit-speech":""},null,512),[[Y,e.search]])]),o(d).state.admin?(c(),b(f,{key:0,to:"/event/edit"},{default:R(()=>[h(C,{name:"add"})]),_:1})):_("",!0),s("div",ie,[o(d).state.admin?(c(),b(C,{key:0,class:M({rotate:y.value}),name:"refresh",onClick:L(T,["prevent"])},null,8,["class"])):_("",!0)]),s("div",le,[h(C,{name:"print",onClick:r[2]||(r[2]=L(l=>a(),["prevent"]))})])]),s("div",ce,[(c(!0),m(A,null,V(e.titles,l=>(c(),m("div",{key:l},[s("table",{summary:String(l)},[s("thead",null,[s("tr",null,[s("th",ue,p(l),1)])]),s("tbody",null,[(c(!0),m(A,null,V(e.listFiltered.filter(n=>n.title===l),n=>(c(),b(ee,{key:n.gid+n.id,event:n,onDblclick:u=>D(n),onContextmenu:L(u=>D(n),["right","prevent"])},null,8,["event","onDblclick","onContextmenu"]))),128))])],8,de)]))),128))]),!e.listFiltered.length&&!e.search.startsWith("*")?(c(),m("div",pe,[h(j,{class:"print-hide q-mt-lg",onClick:r[3]||(r[3]=l=>e.search=`*${e.search}`),color:"blue",flat:"",label:"Lista completa..."})])):_("",!0),s("div",me,[s("a",{style:{color:"black"},href:o(d).state.url},p(o(d).state.url),9,fe)]),e.locale.includes("REGIONAL")?(c(),m("div",ge,r[5]||(r[5]=[s("i",null,[v(" Ora\xE7\xE3o Santa Ceia "),s("br"),s("b",null,"P\xE3o:"),v(' "Senhor, aben\xE7oa este P\xE3o que vamos comer, que \xE9 a comunh\xE3o do Corpo de Cristo." '),s("br"),s("b",null,"C\xE1lice: "),v('"Senhor, aben\xE7oa o C\xE1lice que vamos beber, que \xE9 a comunh\xE3o do Sangue de Cristo." ')],-1)]))):_("",!0)])]))}}};var we=X(he,[["__scopeId","data-v-01b26bc7"]]);export{we as default};
