import{K as q,W as O,F as i,B as d,C as g,D as n,ae as m,as as b,L as _,G as N,X as E,H as y,at as P,au as Q,r as z,x as U,w as C,o as B,y as H,A as j,E as h,aj as K,I as M,av as Y,M as R,J as A,ad as V,Q as G}from"./index.9b0c46b8.js";import{Q as W}from"./QDate.72facf31.js";import{b as c,a as X}from"./app.58e588b3.js";import{T as J}from"./Tag.e61372a0.js";import{_ as Z}from"./plugin-vue_export-helper.21dcd24c.js";import"./use-dark.80818ed8.js";const ee=["innerHTML"],te={__name:"ListaTRComponent",props:{event:{type:Object,required:!0}},setup(L){const v=L,{event:o}=v;function f(a){return T(a.date)&&!["AVISOS \xC0 IRMANDADE"].includes(a.title.toUpperCase())}function e(a){return f(a)&&!["VIAGENS MISSION\xC1RIAS"].includes(a.title.toUpperCase())}function S(a){return a.replace(/(\r\n|\n|\r)/g,"<br>")}function w(a){return!(a instanceof Date)||isNaN(a.getTime())?"":["Dom","Seg","Ter","Qua","Qui","Sex","S\xE1b"][a.getDay()]||""}function D(a){return!(a instanceof Date)||isNaN(a.getTime())?"":String(a.getDate()).padStart(2,"0")}function x(a){return!(a instanceof Date)||isNaN(a.getTime())?"":String(a.getMonth()+1).padStart(2,"0")}function k(a){if(!(a instanceof Date)||isNaN(a.getTime()))return"";const t=String(a.getHours()).padStart(2,"0"),r=String(a.getMinutes()).padStart(2,"0");return`${t}:${r}`}function T(a){return a instanceof Date&&!isNaN(a.getTime())}return(a,t)=>{var r,u;return q((d(),g("tr",null,[n("td",{style:b(f(i(o))?"":"display: none;")},[n("b",null,m(D(i(o).date))+"/"+m(x(i(o).date)),1)],4),n("td",{style:b(f(i(o))?"":"display: none;")},m(w(i(o).date)),5),n("td",{style:b(e(i(o))?"":"display: none;")},m(k(i(o).date)),5),n("td",null,[_(m(i(o).locale)+" ",1),((r=i(o))==null?void 0:r.recurring)&&((u=i(o))==null?void 0:u.recurring.length)?(d(),N(E,{key:0,class:"print-hide",name:"event_repeat",style:{color:"#9e9e9e"}})):y("",!0)]),i(o).desc?(d(),g("td",{key:0,innerHTML:S(i(o).desc)},null,8,ee)):y("",!0)],512)),[[O,i(o).title||i(o).locale||i(o).desc]])}}};const ae={key:0,class:"print-hide loading-overlay"},ne={key:1},re={class:"text-center"},se={class:"print-hide q-pa-sm row flex-center"},oe={id:"lista"},ie={class:"print-hide fixed-bottom z-top menu flex space-between"},le={class:"search"},ce={class:"lista"},de=["summary"],ue={colspan:"5"},pe={key:0,class:"print-hide"},me={class:"print-only right"},ge=["href"],fe={key:1,class:"print-only"},he={__name:"ListasPage",setup(L){var T,a;const v=P(),o=Q(),f=z(!0),e=U({search:((T=v.query.pesquisar)==null?void 0:T.toString())||"",locale:((a=v.params.local)==null?void 0:a.toString())||"",titles:[],date:"",from:c.agenda.from,to:c.agenda.to,eventsCalendar:[],listFiltered:[]}),S=t=>{o.push({path:`/event/edit/${t.id}`})},w=async()=>{await D(),e.eventsCalendar=Array.from(new Set(e.listFiltered.filter(t=>t.date instanceof Date).map(t=>t.date.toISOString().split("T")[0].replace(/-/g,"/")))),setTimeout(()=>{f.value=!1},300)},D=async()=>{try{if(c.agenda.items.length){let t=c.agenda.items.filter(s=>{try{return s.date&&s.date.getTime()>new Date(`${e.from} 00:00:00`).getTime()&&s.end&&s.end.getTime()<new Date(`${e.to} 23:59:59`).getTime()}catch{return!1}});if(e.date&&(t=t.filter(s=>s.date.toISOString().split("T")[0]===e.date)),!e.search&&!e.locale)return[];const r=s=>s.trim().toUpperCase().normalize("NFD").replace(/\p{Diacritic}/gu,"");let u=r(e.search),l=r(e.locale);if(/^(\*)/gi.test(e.search)&&(l="",u=u.replace(/^(\*|\/)/gi,"").trim()),l){const s=new RegExp(`^${l}`);t=t.filter(p=>r(p.list).includes(l)||s.test(r(p.locale)))}if(u)try{const s=new RegExp(u,"gi");t=t.filter(p=>{var I;const $=`${(I=p.date)==null?void 0:I.toLocaleString()} ${p.title} ${p.locale} ${p.desc}`;return s.test($)||u.split(" ").every(F=>new RegExp(`\\b${F}`,"i").test(r($)))})}catch{console.log("Regex search inv\xE1lido!")}e.listFiltered.length=0,t.forEach(s=>{e.listFiltered.push(s)}),e.titles=[...new Set(e.listFiltered.map(s=>s.title))]}}catch(t){console.error("Erro ao atualizar lista: ",t)}},x=t=>{if(t.altKey&&t.key.toLowerCase()==="a")t.preventDefault(),t.stopPropagation(),o.push("/event/edit");else if(t.altKey&&["/","*"].includes(t.key)||t.key==="/"&&document.activeElement.tagName!=="INPUT"&&document.activeElement.tagName!=="TEXTAREA"){t.preventDefault(),t.stopPropagation();const r=document.querySelector('input[type="text"]');r&&r.focus()}};C(()=>c.agenda.from,()=>{e.from=c.agenda.from,e.to=c.agenda.to}),C([()=>e.search,()=>e.date],D),C([()=>c.agenda.items],w),B(async()=>{window.addEventListener("keydown",x);const t=window.location.hash;setTimeout(async()=>{e.search&&e.listFiltered.length&&await X(c,J.create({description:e.search.trim(),title:e.search.replace(/[-,;]/gi,"").replace(/^\*$/,"Lista Completa").trim(),href:t}))},3e3),w()}),H(()=>{window.removeEventListener("keydown",x)});const k=()=>{window.print()};return(t,r)=>{const u=j("router-link");return f.value?(d(),g("div",ae,[h(K,{size:"90px",color:"dark"})])):(d(),g("div",ne,[n("div",re,[r[4]||(r[4]=n("div",{class:"print-only"},"LISTA DE ATENDIMENTO E DIVERSOS",-1)),n("div",null,[n("b",null,m(e.locale.replace(/-$/,"").trim()),1),n("p",null,[h(u,{to:"/settings"},{default:M(()=>[_(m(e.from.split("-").reverse().join("/"))+" \xE0 "+m(e.to.split("-").reverse().join("/")),1)]),_:1})])])]),n("div",se,[h(W,{modelValue:e.date,"onUpdate:modelValue":r[0]||(r[0]=l=>e.date=l),options:e.eventsCalendar,mask:"YYYY-MM-DD",minimal:"",color:"dark"},null,8,["modelValue","options"])]),n("div",oe,[n("div",ie,[n("div",le,[q(n("input",{class:"z-top",type:"text","onUpdate:modelValue":r[1]||(r[1]=l=>e.search=l),placeholder:"Pesquisar...","x-webkit-speech":""},null,512),[[Y,e.search]])]),i(c).state.admin?(d(),N(u,{key:0,to:"/event/edit"},{default:M(()=>[h(E,{name:"add"})]),_:1})):y("",!0),h(E,{name:"print",onClick:r[2]||(r[2]=R(l=>k(),["prevent"]))})]),n("div",ce,[(d(!0),g(A,null,V(e.titles,l=>(d(),g("div",{key:l},[n("table",{summary:String(l)},[n("thead",null,[n("tr",null,[n("th",ue,m(l),1)])]),n("tbody",null,[(d(!0),g(A,null,V(e.listFiltered.filter(s=>s.title===l),s=>(d(),N(te,{key:s.gid+s.id,event:s,onDblclick:p=>S(s),onContextmenu:R(p=>S(s),["right","prevent"])},null,8,["event","onDblclick","onContextmenu"]))),128))])],8,de)]))),128))]),!e.listFiltered.length&&!e.search.startsWith("*")?(d(),g("div",pe,[h(G,{class:"print-hide q-mt-lg",onClick:r[3]||(r[3]=l=>e.search=`*${e.search}`),color:"blue",flat:"",label:"Lista completa..."})])):y("",!0),n("div",me,[n("a",{style:{color:"black"},href:i(c).state.url},m(i(c).state.url),9,ge)]),e.locale.includes("REGIONAL")?(d(),g("div",fe,r[5]||(r[5]=[n("i",null,[_(" Ora\xE7\xE3o Santa Ceia "),n("br"),n("b",null,"P\xE3o:"),_(' "Senhor, aben\xE7oa este P\xE3o que vamos comer, que \xE9 a comunh\xE3o do Corpo de Cristo." '),n("br"),n("b",null,"C\xE1lice: "),_('"Senhor, aben\xE7oa o C\xE1lice que vamos beber, que \xE9 a comunh\xE3o do Sangue de Cristo." ')],-1)]))):y("",!0)])]))}}};var xe=Z(he,[["__scopeId","data-v-282cfe6d"]]);export{xe as default};
