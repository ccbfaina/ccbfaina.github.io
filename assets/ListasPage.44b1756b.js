import{K as F,W as P,F as o,B as d,C as m,D as r,ae as p,as as E,L as v,G as T,X as C,H as _,at as z,au as Q,r as U,x as B,o as H,w as L,y as K,A as j,E as y,aj as Y,av as G,I as R,aw as W,M as $,J as A,ad as V,Q as X}from"./index.1b47c0de.js";import{Q as J}from"./QDate.2d215d6d.js";import{b as c,a as Z,f as ee}from"./app.64ac0fcf.js";import{T as te}from"./Tag.e61372a0.js";import{_ as ae}from"./plugin-vue_export-helper.21dcd24c.js";import"./use-dark.33c71feb.js";const re=["innerHTML"],se={__name:"ListaTRComponent",props:{event:{type:Object,required:!0}},setup(I){const S=I,{event:i}=S;function g(a){return N(a.date)&&!["AVISOS \xC0 IRMANDADE"].includes(a.title.toUpperCase())}function e(a){return g(a)&&!["VIAGENS MISSION\xC1RIAS"].includes(a.title.toUpperCase())}function w(a){return a.replace(/(\r\n|\n|\r)/g,"<br>")}function D(a){return!(a instanceof Date)||isNaN(a.getTime())?"":["Dom","Seg","Ter","Qua","Qui","Sex","S\xE1b"][a.getDay()]||""}function k(a){return!(a instanceof Date)||isNaN(a.getTime())?"":String(a.getDate()).padStart(2,"0")}function x(a){return!(a instanceof Date)||isNaN(a.getTime())?"":String(a.getMonth()+1).padStart(2,"0")}function b(a){if(!(a instanceof Date)||isNaN(a.getTime()))return"";const h=String(a.getHours()).padStart(2,"0"),t=String(a.getMinutes()).padStart(2,"0");return`${h}:${t}`}function N(a){return a instanceof Date&&!isNaN(a.getTime())}return(a,h)=>{var t,n;return F((d(),m("tr",null,[r("td",{style:E(g(o(i))?"":"display: none;")},[r("b",null,p(k(o(i).date))+"/"+p(x(o(i).date)),1)],4),r("td",{style:E(g(o(i))?"":"display: none;")},p(D(o(i).date)),5),r("td",{style:E(e(o(i))?"":"display: none;")},p(b(o(i).date)),5),r("td",null,[v(p(o(i).locale)+" ",1),((t=o(i))==null?void 0:t.recurring)&&((n=o(i))==null?void 0:n.recurring.length)?(d(),T(C,{key:0,class:"print-hide",name:"event_repeat",style:{color:"#9e9e9e"}})):_("",!0)]),o(i).desc?(d(),m("td",{key:0,innerHTML:w(o(i).desc)},null,8,re)):_("",!0)],512)),[[P,o(i).title||o(i).locale||o(i).desc]])}}};const ne={key:1},oe={class:"text-center"},ie={class:"print-hide q-pa-sm row flex-center"},le={id:"lista"},ce={class:"print-hide fixed-bottom z-top menu flex space-between"},de={class:"search"},ue={class:"lista"},pe=["summary"],me={colspan:"5"},fe={key:0,class:"print-hide"},ge={class:"print-only right"},he=["href"],ye={key:1,class:"print-only"},_e={__name:"ListasPage",setup(I){var a,h;const S=z(),i=Q(),g=U(!0),e=B({search:((a=S.query.pesquisar)==null?void 0:a.toString())||"",locale:((h=S.params.local)==null?void 0:h.toString())||"",titles:[],date:"",from:c.agenda.from,to:c.agenda.to,eventsCalendar:[],listFiltered:[]}),w=t=>{i.push({path:`/event/edit/${t.id}`})},D=async()=>{await k(),e.eventsCalendar=Array.from(new Set(e.listFiltered.filter(t=>t.date instanceof Date).map(t=>t.date.toISOString().split("T")[0].replace(/-/g,"/")))),g.value=!1},k=async()=>{try{if(c.agenda.items.length){let t=c.agenda.items.filter(s=>{try{return s.date&&s.date.getTime()>new Date(`${e.from} 00:00:00`).getTime()&&s.end&&s.end.getTime()<new Date(`${e.to} 23:59:59`).getTime()}catch{return!1}});if(e.date&&(t=t.filter(s=>s.date.toISOString().split("T")[0]===e.date)),!e.search&&!e.locale)return[];const n=s=>s.trim().toUpperCase().normalize("NFD").replace(/\p{Diacritic}/gu,"");let f=n(e.search),l=n(e.locale);if(/^(\*)/gi.test(e.search)&&(l="",f=f.replace(/^(\*|\/)/gi,"").trim()),l){const s=new RegExp(`^${l}`);t=t.filter(u=>n(u.list).includes(l)||s.test(n(u.locale)))}if(f)try{const s=new RegExp(f,"gi");t=t.filter(u=>{var M;const q=`${(M=u.date)==null?void 0:M.toLocaleString()} ${u.title} ${u.locale} ${u.desc}`;return s.test(q)||f.split(" ").every(O=>new RegExp(`\\b${O}`,"i").test(n(q)))})}catch{console.log("Regex search inv\xE1lido!")}e.listFiltered.length=0,t.forEach(s=>{e.listFiltered.push(s)}),e.titles=[...new Set(e.listFiltered.map(s=>s.title))]}}catch(t){console.error("Erro ao atualizar lista: ",t)}},x=t=>{if(t.altKey&&t.key.toLowerCase()==="a")t.preventDefault(),t.stopPropagation(),i.push("/event/edit");else if(t.altKey&&["/","*"].includes(t.key)||t.ctrlKey&&t.key==="f"||t.key==="/"&&document.activeElement.tagName!=="INPUT"&&document.activeElement.tagName!=="TEXTAREA"){t.preventDefault(),t.stopPropagation();const n=document.querySelector('input[type="text"]');n&&n.focus()}};H(async()=>{window.addEventListener("keydown",x),L(()=>c.agenda.from,()=>{e.from=c.agenda.from,e.to=c.agenda.to}),L([()=>e.search,()=>e.date],k),L([()=>c.agenda.items],D);const t=window.location.hash;setTimeout(async()=>{e.search&&e.listFiltered.length&&await Z(c,te.create({description:e.search.trim(),title:e.search.replace(/[-,;]/gi,"").replace(/^\*$/,"Lista Completa").trim(),href:t}))},3e3),D()}),K(()=>{window.removeEventListener("keydown",x)});const b=async()=>{try{await ee.post("/api/agenda/updateall")}catch{}},N=()=>{window.print()};return(t,n)=>{const f=j("router-link");return g.value?(d(),m("div",{key:0,class:G([["loading-overlay",{show:g.value}],"print-hide"])},[y(Y,{size:"90px",color:"dark"})],2)):(d(),m("div",ne,[r("div",oe,[n[4]||(n[4]=r("div",{class:"print-only"},"LISTA DE ATENDIMENTO E DIVERSOS",-1)),r("div",null,[r("b",null,p(e.locale.replace(/-$/,"").trim()),1),r("p",null,[y(f,{to:"/settings"},{default:R(()=>[v(p(e.from.split("-").reverse().join("/"))+" \xE0 "+p(e.to.split("-").reverse().join("/")),1)]),_:1})])])]),r("div",ie,[y(J,{modelValue:e.date,"onUpdate:modelValue":n[0]||(n[0]=l=>e.date=l),options:e.eventsCalendar,mask:"YYYY-MM-DD",minimal:"",color:"dark"},null,8,["modelValue","options"])]),r("div",le,[r("div",ce,[r("div",de,[F(r("input",{class:"z-top",type:"text","onUpdate:modelValue":n[1]||(n[1]=l=>e.search=l),placeholder:"Pesquisar...","x-webkit-speech":""},null,512),[[W,e.search]])]),o(c).state.admin?(d(),T(f,{key:0,to:"/event/edit"},{default:R(()=>[y(C,{name:"add"})]),_:1})):_("",!0),o(c).state.admin?(d(),T(C,{key:1,class:"q-pr-sm",name:"refresh",onClick:$(b,["prevent"])})):_("",!0),y(C,{name:"print",onClick:n[2]||(n[2]=$(l=>N(),["prevent"])),class:"q-pr-sm"})]),r("div",ue,[(d(!0),m(A,null,V(e.titles,l=>(d(),m("div",{key:l},[r("table",{summary:String(l)},[r("thead",null,[r("tr",null,[r("th",me,p(l),1)])]),r("tbody",null,[(d(!0),m(A,null,V(e.listFiltered.filter(s=>s.title===l),s=>(d(),T(se,{key:s.gid+s.id,event:s,onDblclick:u=>w(s),onContextmenu:$(u=>w(s),["right","prevent"])},null,8,["event","onDblclick","onContextmenu"]))),128))])],8,pe)]))),128))]),!e.listFiltered.length&&!e.search.startsWith("*")?(d(),m("div",fe,[y(X,{class:"print-hide q-mt-lg",onClick:n[3]||(n[3]=l=>e.search=`*${e.search}`),color:"blue",flat:"",label:"Lista completa..."})])):_("",!0),r("div",ge,[r("a",{style:{color:"black"},href:o(c).state.url},p(o(c).state.url),9,he)]),e.locale.includes("REGIONAL")?(d(),m("div",ye,n[5]||(n[5]=[r("i",null,[v(" Ora\xE7\xE3o Santa Ceia "),r("br"),r("b",null,"P\xE3o:"),v(' "Senhor, aben\xE7oa este P\xE3o que vamos comer, que \xE9 a comunh\xE3o do Corpo de Cristo." '),r("br"),r("b",null,"C\xE1lice: "),v('"Senhor, aben\xE7oa o C\xE1lice que vamos beber, que \xE9 a comunh\xE3o do Sangue de Cristo." ')],-1)]))):_("",!0)])]))}}};var Te=ae(_e,[["__scopeId","data-v-163afb42"]]);export{Te as default};
