import{P as F,$ as P,aB as o,E as u,M as g,I as n,am as m,aC as E,R as v,F as C,a0 as T,N as h,J as z,K as Q,t as q,x as U,o as B,w as N,y as K,L as H,aE as M,H as _,as as Y,G as V,aK as j,al as $,O as L,ak as A,Q as G}from"./index.e00bdcb8.js";import{Q as J}from"./QDate.7e69376e.js";import{b as d,c as W}from"./app.f782fcf9.js";import{_ as X}from"./plugin-vue_export-helper.21dcd24c.js";import"./use-dark.a980260f.js";import"./private.use-form.05ba04c8.js";import"./date.b89d4fee.js";const Z=["innerHTML"],ee={__name:"ListaTRComponent",props:{event:{type:Object,required:!0}},setup(I){const S=I,{event:i}=S;function f(a){return b(a.date)&&!["AVISOS \xC0 IRMANDADE"].includes(a.title.toUpperCase())}function y(a){return f(a)&&!["VIAGENS MISSION\xC1RIAS"].includes(a.title.toUpperCase())}function e(a){return a.replace(/(\r\n|\n|\r)/g,"<br>")}function w(a){return!(a instanceof Date)||isNaN(a.getTime())?"":["Dom","Seg","Ter","Qua","Qui","Sex","S\xE1b"][a.getDay()]||""}function D(a){return!(a instanceof Date)||isNaN(a.getTime())?"":String(a.getDate()).padStart(2,"0")}function k(a){return!(a instanceof Date)||isNaN(a.getTime())?"":String(a.getMonth()+1).padStart(2,"0")}function x(a){if(!(a instanceof Date)||isNaN(a.getTime()))return"";const t=String(a.getHours()).padStart(2,"0"),s=String(a.getMinutes()).padStart(2,"0");return`${t}:${s}`}function b(a){return a instanceof Date&&!isNaN(a.getTime())}return(a,t)=>F((u(),g("tr",null,[n("td",{style:E(f(o(i))?"":"display: none;")},[n("b",null,m(D(o(i).date))+"/"+m(k(o(i).date)),1)],4),n("td",{style:E(f(o(i))?"":"display: none;")},m(w(o(i).date)),5),n("td",{style:E(y(o(i))?"":"display: none;")},m(x(o(i).date)),5),n("td",null,[v(m(o(i).locale)+" ",1),o(i)?.recurring&&o(i)?.recurring.length?(u(),C(T,{key:0,class:"print-hide",name:"event_repeat",style:{color:"#9e9e9e"}})):h("",!0)]),o(i).desc?(u(),g("td",{key:0,innerHTML:e(o(i).desc)},null,8,Z)):h("",!0)],512)),[[P,o(i).title||o(i).locale||o(i).desc]])}};const te={class:"text-center"},ae={class:"print-hide q-pa-sm row flex-center"},ne={id:"lista"},se={class:"print-hide fixed-bottom z-top menu flex space-between"},re={class:"search"},oe={class:"q-pr-sm"},ie={class:"q-pr-sm"},le={class:"lista"},ce=["summary"],de={colspan:"5"},ue={key:0,class:"print-hide"},pe={class:"print-only right"},me=["href"],ge={key:1,class:"print-only"},fe={__name:"ListasPage",setup(I){const S=z(),i=Q(),f=q(!0),y=q(!1),e=U({search:S.query.pesquisar?.toString()||"",locale:S.params.local?.toString()||"",titles:[],date:"",from:d.agenda.from,to:d.agenda.to,eventsCalendar:[],listFiltered:[]}),w=t=>{i.push({path:`/event/edit/${t.id}`})};setTimeout(()=>{f.value=!1},8e3);const D=async()=>{await k(),e.eventsCalendar=Array.from(new Set(e.listFiltered.filter(t=>t.date instanceof Date).map(t=>t.date.toISOString().split("T")[0].replace(/-/g,"/")))),f.value=!1},k=async()=>{try{if(d.agenda.items.length){let t=d.agenda.items.filter(r=>{try{return r.date&&r.date.getTime()>new Date(`${e.from} 00:00:00`).getTime()&&r.end&&r.end.getTime()<new Date(`${e.to} 23:59:59`).getTime()}catch{return!1}});if(e.date&&(t=t.filter(r=>r.date.toISOString().split("T")[0]===e.date)),!e.search&&!e.locale)return[];const s=r=>r.trim().toUpperCase().normalize("NFD").replace(/\p{Diacritic}/gu,"");let l=s(e.search),c=s(e.locale);if(/^(\*)/gi.test(e.search)&&(c="",l=l.replace(/^(\*|\/)/gi,"").trim()),c){const r=new RegExp(`^${c}`);t=t.filter(p=>s(p.list).includes(c)||r.test(s(p.locale)))}if(l)try{const r=new RegExp(l,"gi");t=t.filter(p=>{const R=`${p.date?.toLocaleString()} ${p.title} ${p.locale} ${p.desc}`;return r.test(R)||l.split(" ").every(O=>new RegExp(`\\b${O}`,"i").test(s(R)))})}catch{console.log("Regex search inv\xE1lido!")}e.listFiltered.length=0,t.forEach(r=>{e.listFiltered.push(r)}),e.titles=[...new Set(e.listFiltered.map(r=>r.title))]}}catch(t){console.error("Erro ao atualizar lista: ",t)}},x=t=>{if(t.altKey&&t.key.toLowerCase()==="a")t.preventDefault(),t.stopPropagation(),i.push("/event/edit");else if(t.altKey&&["/","*"].includes(t.key)||t.ctrlKey&&t.key==="f"||t.key==="/"&&document.activeElement.tagName!=="INPUT"&&document.activeElement.tagName!=="TEXTAREA"){t.preventDefault(),t.stopPropagation();const s=document.querySelector('input[type="text"]');s&&s.focus()}};B(async()=>{window.addEventListener("keydown",x),N(()=>d.agenda.from,()=>{e.from=d.agenda.from,e.to=d.agenda.to}),N([()=>e.search,()=>e.date],k),N([()=>d.agenda.items],D),await D()}),K(()=>{window.removeEventListener("keydown",x)});const b=async()=>{try{y.value=!0;const{data:t}=await W.post("/api/agenda/updateall"),{data:s}=t;s.items=s.items.map(l=>(l.date=new Date(l.date),l.end=new Date(l.end),l.updated=l.updated?new Date(l.updated):new Date,l)),d.agenda.items=s.items}catch(t){console.log("Erro ao atualizar lista: ",t)}y.value=!1},a=()=>{window.print()};return(t,s)=>{const l=H("router-link");return u(),g(L,null,[f.value?(u(),g("div",{key:0,class:M([["loading-overlay",{show:f.value}],"print-hide"])},[_(Y,{size:"90px",color:"dark"})],2)):h("",!0),n("div",te,[s[4]||(s[4]=n("div",{class:"print-only"},"LISTA DE ATENDIMENTO E DIVERSOS",-1)),n("div",null,[n("b",null,m(e.locale.replace(/-$/,"").trim()),1),n("p",null,[_(l,{to:"/settings"},{default:V(()=>[v(m(e.from.split("-").reverse().join("/"))+" \xE0 "+m(e.to.split("-").reverse().join("/")),1)]),_:1})])])]),n("div",ae,[_(J,{modelValue:e.date,"onUpdate:modelValue":s[0]||(s[0]=c=>e.date=c),options:e.eventsCalendar,mask:"YYYY-MM-DD",minimal:"",color:"dark"},null,8,["modelValue","options"])]),n("div",ne,[n("div",se,[n("div",re,[F(n("input",{class:"z-top",type:"text","onUpdate:modelValue":s[1]||(s[1]=c=>e.search=c),placeholder:"Pesquisar...","x-webkit-speech":""},null,512),[[j,e.search]])]),o(d).state.admin?(u(),C(l,{key:0,to:"/event/edit"},{default:V(()=>[_(T,{name:"add"})]),_:1})):h("",!0),n("div",oe,[o(d).state.admin?(u(),C(T,{key:0,class:M({rotate:y.value}),name:"refresh",onClick:$(b,["prevent"])},null,8,["class"])):h("",!0)]),n("div",ie,[_(T,{name:"print",onClick:s[2]||(s[2]=$(c=>a(),["prevent"]))})])]),n("div",le,[(u(!0),g(L,null,A(e.titles,c=>(u(),g("div",{key:c},[n("table",{summary:String(c)},[n("thead",null,[n("tr",null,[n("th",de,m(c),1)])]),n("tbody",null,[(u(!0),g(L,null,A(e.listFiltered.filter(r=>r.title===c),r=>(u(),C(ee,{key:r.gid+r.id,event:r,onDblclick:p=>w(r),onContextmenu:$(p=>w(r),["right","prevent"])},null,8,["event","onDblclick","onContextmenu"]))),128))])],8,ce)]))),128))]),!e.listFiltered.length&&!e.search.startsWith("*")?(u(),g("div",ue,[_(G,{class:"print-hide q-mt-lg",onClick:s[3]||(s[3]=c=>e.search=`*${e.search}`),color:"blue",flat:"",label:"Lista completa..."})])):h("",!0),n("div",pe,[n("a",{style:{color:"black"},href:o(d).state.url},m(o(d).state.url),9,me)]),e.locale.includes("REGIONAL")?(u(),g("div",ge,s[5]||(s[5]=[n("i",null,[v(" Ora\xE7\xE3o Santa Ceia "),n("br"),n("b",null,"P\xE3o:"),v(' "Senhor, aben\xE7oa este P\xE3o que vamos comer, que \xE9 a comunh\xE3o do Corpo de Cristo." '),n("br"),n("b",null,"C\xE1lice: "),v('"Senhor, aben\xE7oa o C\xE1lice que vamos beber, que \xE9 a comunh\xE3o do Sangue de Cristo." ')],-1)]))):h("",!0)])],64)}}};var ke=X(fe,[["__scopeId","data-v-5444765c"]]);export{ke as default};
