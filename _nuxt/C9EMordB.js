import{_ as B,f as I,r as p,z as U,j as T,A as z,i as x,c as u,a as e,k as y,C as M,x as l,t as N,F as H,n as G,I as W,g as J,q as K,o as c,e as k,m as Q,G as X}from"#entry";import{d as R}from"./D0Dr7phT.js";const Y={class:"page-relatorio"},Z={class:"filters"},ee={class:"form-group"},oe={class:"form-group"},te={class:"row gap flex-end",style:{"justify-content":"flex-end","margin-bottom":"1em","align-items":"center"}},se={style:{color:"#a4a4a4"}},ne=["disabled"],le={class:"table-container"},ae=["onMouseup"],ie={class:"cursor"},re={style:{color:"#888"}},de={key:0},ue=["innerHTML"],ce={key:0},fe={class:"row space-between"},me={class:"form-group"},pe={class:"row gap-xs text-center flex-end"},ve=["disabled"],ge=["disabled"],ye=5e3,be={__name:"relatorio",setup(he){const{$toast:A,$indexedDB:D}=I(),b=J(),L=K(),f=p([]),a=p(0),i=p(!1),o=U({nome:"",cidade:"",offset:0,limit:50}),h=p(0),v=s=>{const t=Date.now();return t-h.value>ye?(A.success(s),h.value=t,!0):!1},q=T(()=>Math.floor(o.offset/o.limit)+1),E=T(()=>a.value?Math.ceil(a.value/o.limit):1),_=R(async()=>{i.value=!0;try{const{data:s,total:t,message:n}=await D.getRelatorio({nome:o.nome,cidade:o.cidade,locale:"",offset:o.offset,limit:o.limit});f.value=s||[],a.value=Number(t)||0,v(n||"Relatório carregado com sucesso.")}catch(s){console.error(s),f.value=[],a.value=0}finally{i.value=!1}},300),S=()=>{o.offset=0,r()},$=()=>{o.nome="",o.cidade="",o.offset=0,r()},w=()=>{if(typeof window>"u"||typeof document>"u")return;const s=document.querySelector(".content");s?typeof s.scrollTo=="function"?s.scrollTo({top:0,behavior:"smooth"}):s.scrollTop=0:typeof window.scrollTo=="function"&&window.scrollTo({top:0,behavior:"smooth"})},j=()=>{o.offset=Math.max(0,o.offset-o.limit),r(),w()},F=()=>{o.offset+o.limit<a.value&&(o.offset=o.offset+o.limit,r(),w())},r=R(()=>{const s=Object.fromEntries(Object.entries(o).filter(([,t])=>t!==""&&t!==0&&t!=null).map(([t,n])=>[t,Array.isArray(n)?n.join(","):String(n)]));L.replace({query:s})},200),C=()=>{const s=b.query||{};o.nome=s.nome||"",o.cidade=s.cidade||"",o.offset=s.offset&&parseInt(s.offset,10)||0,o.limit=s.limit&&parseInt(s.limit,10)||50};z(async()=>{C(),_()}),x(()=>b.query,()=>{C(),_()}),x([()=>[o.nome,o.cidade],()=>o.limit,()=>o.offset],()=>{r()});let g=null;const O=s=>{g=s.currentTarget},P=async(s,t)=>{if(g!==s.currentTarget)return;g=null;const n=window.getSelection(),d=n?n.toString().trim():"";if(d){try{await navigator.clipboard.writeText(d)}catch{const m=document.createElement("textarea");m.value=d,document.body.appendChild(m),m.select(),document.execCommand("copy"),document.body.removeChild(m)}v("Texto copiado para a área de transferência");return}V(t),v("Abrindo Google Maps")},V=s=>{window.open(`https://www.google.com/maps/search/?api=1&query=CCB Congregação ${s.NomeLocalidade} ${s.NomeCidade} ${s.NomeEstado} ${s.NomePais} ${s.Cep}`,"_blank","noopener noreferrer")};return(s,t)=>(c(),u("div",Y,[e("div",Z,[e("div",ee,[t[3]||(t[3]=e("label",{for:"search"},"Ministério",-1)),y(e("input",{id:"search","onUpdate:modelValue":t[0]||(t[0]=n=>o.nome=n),type:"text",placeholder:"Nome"},null,512),[[M,o.nome]])]),e("div",oe,[t[4]||(t[4]=e("label",{for:"search"},"Cidade",-1)),y(e("input",{id:"search","onUpdate:modelValue":t[1]||(t[1]=n=>o.cidade=n),type:"text",placeholder:"Cidade"},null,512),[[M,o.cidade]])])]),e("div",te,[e("small",se,"Total: "+l(a.value),1),e("button",{class:"success",disabled:i.value,onClick:S},l(i.value?"Aguarde...":"Aplicar"),9,ne),e("button",{onClick:$},"Limpar")]),e("div",le,[e("table",null,[t[10]||(t[10]=e("thead",null,[e("tr",null,[e("th",null,"Local"),e("th",null,"Culto"),e("th",null,"Ministério")])],-1)),e("tbody",null,[(c(!0),u(H,null,G(f.value,n=>(c(),u("tr",{key:n.Codigo,onMousedown:O,onMouseup:d=>P(d,n)},[e("td",ie,[e("dl",null,[t[5]||(t[5]=e("dt",null,"Local:",-1)),e("dd",null,l(n.NomeLocalidade),1),t[6]||(t[6]=e("dt",null,"Cidade:",-1)),e("dd",null,l(n.NomeCidade),1),t[7]||(t[7]=e("dt",null,"Estado:",-1)),e("dd",null,l(n.NomeEstado),1),t[8]||(t[8]=e("dt",null,[e("small",{style:{color:"#888"}},"Código:")],-1)),e("dd",null,[e("small",re,l(n.CodigoRelatorio),1)])])]),e("td",null,[k(l(n.DiasCultosConcatenado)+" ",1),n.DiasCultosConcatenado?(c(),u("br",de)):N("",!0),k(" "+l(n.Observacao),1)]),e("td",null,[e("div",{innerHTML:Q(X)(n.MinisterioConcatenados?.split(";").join("<br>"))},null,8,ue)])],40,ae))),128)),!f.value.length&&!i.value?(c(),u("tr",ce,[...t[9]||(t[9]=[e("td",{colspan:"6"},"Nenhum registro encontrado.",-1)])])):N("",!0)])])]),e("div",fe,[e("div",me,[y(e("select",{"onUpdate:modelValue":t[2]||(t[2]=n=>o.limit=n),style:{"min-width":"100px"}},[...t[11]||(t[11]=[e("option",{value:50},"50",-1),e("option",{value:100},"100",-1),e("option",{value:200},"200",-1)])],512),[[W,o.limit,void 0,{number:!0}]])]),e("div",pe,[e("small",null,"Página: "+l(q.value)+" / "+l(E.value),1),e("button",{disabled:o.offset===0,onClick:j},"Anterior",8,ve),e("button",{disabled:o.offset+o.limit>=a.value,onClick:F},"Próxima",8,ge)])])]))}},Te=B(be,[["__scopeId","data-v-781e1864"]]);export{Te as default};
