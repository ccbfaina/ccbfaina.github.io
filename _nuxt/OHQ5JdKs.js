import{L as be}from"./DbEtIfB4.js";import{_ as me,f as ge,r as p,z as Y,A as Z,i as j,j as x,Q as ye,c as a,B as ee,F as g,a as t,s as y,x as u,k as b,v as A,E as F,t as v,C as q,n as C,I as te,e as z,m as se,g as _e,R as B,q as ke,o,M as L,G as he}from"#entry";import{a as Ce,S as De,E as Se}from"./CNKszBmN.js";import{d as le}from"./D0Dr7phT.js";const Te={class:"tabs-container print-hide"},$e={class:"tabs justify-end","aria-label":"Tabs",role:"tablist","aria-orientation":"horizontal"},Ee=["aria-selected"],Le={class:"badge"},we=["aria-selected"],xe={class:"badge"},Ae=["aria-selected"],qe={class:"tab-content"},ze={id:"tab-content-lista",role:"tabpanel"},Ve={key:0},Oe={key:1},je={key:2},Fe={key:3},Be={id:"tab-content-filters",role:"tabpanel"},Me={class:"content"},Ge={class:"form-inline"},Ie={class:"form-group"},Ne={class:"row"},Re={class:"form-group"},Ue={class:"row"},Pe=["value"],He={class:"form-group"},We={class:"row"},Ke=["value"],Qe={class:"form-group"},Je={class:"flex gap-xs"},Xe={class:"form-group",style:{"text-align":"right"}},Ye=["disabled"],Ze={class:"form-inline",style:{gap:"1rem","margin-top":"1rem"}},et={id:"tab-content-print",role:"tabpanel"},tt={class:"a4 print-hide"},st={class:"settings-list"},lt={id:"fontSteps"},nt=["value"],ot={class:"settings-list print-hide"},at=["onDragstart","onDragover","onDrop","onClick"],it={key:0,class:"print-page"},rt=["onDragstart","onDragover","onDrop"],ut={colspan:"5"},dt={class:"flex items-center aling-center justify-center"},ct=["onClick"],vt=["onClick","onContextmenu","onMousedown"],pt={key:0},ft={key:0},bt={key:0},mt=["innerHTML"],gt={key:1},yt={class:"text-center p"},_t={__name:"index",setup(kt){const{$toast:ne,$indexedDB:M}=ge(),D=p([]),c=p("lista"),l=Y({search:"",title:"",locale:"",date:"",start:"",end:"",calendars:[]}),_=p(1),oe=_e(),G=ke(),V=p(!1),ae=()=>{const s=oe.query||{};["search","title","locale","date","start","end"].forEach(d=>{s[d]!==void 0&&(l[d]=s[d])}),s.calendars&&(l.calendars=Array.isArray(s.calendars)?s.calendars:s.calendars.split(",").filter(Boolean));const{today:i,future:n}=B();l.start||(l.start=i),l.end||(l.end=n)},I=le(()=>{const s=Object.fromEntries(Object.entries(l).filter(([e,i])=>e==="calendars"?i.length:i!==""&&i!=null).map(([e,i])=>Array.isArray(i)?[e,i.join(",")]:[e,i]));G.replace({query:s})},200);function ie(){I()}Z(()=>{ae()}),j([l,_],I,{deep:!0});function w(s){if(s==="calendars")l.calendars=[];else if(s==="date"){l.date="";const{today:e,future:i}=B();l.start=e,l.end=i}else if(s==="start"||s==="end"){const{today:e,future:i}=B();l.start=e,l.end=i}else l[s]=""}const re=p([]),N=p([]),R=p([]),S=p([]),U=p([]),ue=le(async()=>{const{data:s,message:e}=await M.getEvents(l)||{},{events:i,calendars:n,titles:d,locales:r}=s;U.value=await M.getTitles()||[],D.value=i,re.value=n,N.value=d,R.value=r;const E=Array.from(new Set(D.value.map(h=>h.title||"Sem título"))),O=U.value.filter(h=>E.includes(h));E.forEach(h=>{O.includes(h)||O.push(h)}),S.value=O,ne.success(e||"Eventos carregados com sucesso.")},400);j(()=>l,async()=>{l.start&&ue()},{immediate:!0,deep:!0});const m=x(()=>{const s={};return D.value.forEach(e=>{const i=e.title||"Sem título";(s[i]||=[]).push(e)}),S.value.filter(e=>s[e]).map(e=>({title:e,items:s[e].slice().sort((i,n)=>i.onDate&&n.onDate?i.onDate-n.onDate:0)}))}),P=s=>s?.replace(/-$/,"")?.trim(),de=x(()=>{let s=0;return l.search&&s++,l.title&&s++,l.locale&&s++,l.date&&s++,l.calendars&&l.calendars.length>0&&s++,s}),ce=()=>{c.value="lista",setTimeout(()=>{window.print()},1e3)},k=p(null),T=p(null),H=s=>{k.value=s},W=s=>{T.value=s},K=s=>{if(k.value===null||k.value===s){k.value=null,T.value=null;return}const e=[...S.value],[i]=e.splice(k.value,1);e.splice(s,0,i),S.value=e,k.value=null,T.value=null},f=Y({});j(m,()=>{if(!m.value)return;const s=m.value.map(e=>e.title);s.forEach(e=>{e in f||(f[e]=!0)});for(const e in f)s.includes(e)||delete f[e]},{immediate:!0});const Q=s=>{c.value="print",f[s]=!f[s]},J=x(()=>m.value.length>0&&m.value.every(s=>f[s.title])),ve=s=>{m.value.forEach(e=>{f[e.title]=s})},$=p(null),pe=x(()=>Object.values(f).filter(Boolean).length);Z(()=>{$.value=new Ce({extensions:[De],content:`
      <p>Oração Santa Ceia</p>
      <p><strong>Pão:</strong> "Senhor, abençoa este Pão que vamos comer, que é a comunhão do Corpo de Cristo."</p>
      <p><strong>Cálice:</strong> "Senhor, abençoa o Cálice que vamos beber, que é a comunhão do Sangue de Cristo."</p>
    `,editable:!0})}),ye(()=>{$.value&&$.value.destroy()});const fe=s=>{G.push({path:"/evento",query:{id:s.id}})};function X(s){s&&s.htmlLink&&window.open(s.htmlLink,"_blank")}return(s,e)=>{const i=be;return o(),a("div",null,[V.value?(o(),ee(i,{key:0})):(o(),a(g,{key:1},[t("div",Te,[t("nav",$e,[t("span",{id:"tab-filters","aria-selected":c.value==="filters",role:"tab",type:"button",class:y(["tab",{active:c.value==="filters"}]),style:{position:"relative"},onClick:e[0]||(e[0]=n=>c.value="filters")},[t("span",Le,u(de.value),1),e[16]||(e[16]=t("i",{class:"la la-filter z-10"},null,-1))],10,Ee),t("span",{id:"tab-print","aria-selected":c.value==="print",role:"tab",type:"button",class:y(["tab",{active:c.value==="print"}]),onClick:e[1]||(e[1]=n=>c.value="print")},[t("span",xe,u(pe.value),1),e[17]||(e[17]=t("i",{class:"la la-print"},null,-1))],10,we),t("span",{id:"tab-lista","aria-selected":c.value==="lista",role:"tab",type:"button",class:y(["tab",{active:c.value==="lista"}]),onClick:e[2]||(e[2]=n=>c.value="lista")}," Lista ",10,Ae)])]),t("div",null,[t("div",qe,[b(t("div",ze,[t("div",{class:"text-center",style:F({fontSize:_.value+"em"})},[e[18]||(e[18]=t("div",null,"LISTA DE ATENDIMENTO E DIVERSOS",-1)),l.calendars.length?(o(),a("div",Ve,[t("b",null,u(l.calendars.map(P).join(", ")),1)])):v("",!0),l.locale?(o(),a("span",Oe,[t("b",null,u(P(l.locale)),1)])):v("",!0),!l.date&&(l.start||l.end)?(o(),a("div",je," Período: "+u(l.start?.split("T")[0]?.split("-")?.reverse()?.join("/"))+" à "+u(l.end?.split("T")[0]?.split("-")?.reverse()?.join("/")),1)):v("",!0),l.search?(o(),a("div",Fe,u(l.search.replace(/\!\S+/gi,"")),1)):v("",!0)],4)],512),[[A,c.value==="lista"]]),b(t("div",Be,[t("div",Me,[t("div",Ge,[t("div",null,[t("div",Ie,[e[19]||(e[19]=t("label",{for:"search"},"Pesquisar",-1)),t("div",Ne,[b(t("input",{id:"search","onUpdate:modelValue":e[3]||(e[3]=n=>l.search=n),type:"text",placeholder:"Buscar itens..."},null,512),[[q,l.search]]),l.search?(o(),a("button",{key:0,class:"btn-clear","aria-label":"Limpar pesquisa",type:"button",onClick:e[4]||(e[4]=n=>w("search"))}," × ")):v("",!0)])]),t("div",Re,[e[21]||(e[21]=t("label",{for:"title"},"Título",-1)),t("div",Ue,[b(t("select",{id:"title","onUpdate:modelValue":e[5]||(e[5]=n=>l.title=n)},[e[20]||(e[20]=t("option",{value:""},"Todos os títulos",-1)),(o(!0),a(g,null,C(N.value,n=>(o(),a("option",{key:n,value:n},u(n),9,Pe))),128))],512),[[te,l.title]]),l.title?(o(),a("button",{key:0,class:"btn-clear","aria-label":"Limpar título",type:"button",onClick:e[6]||(e[6]=n=>w("title"))}," × ")):v("",!0)])]),t("div",He,[e[23]||(e[23]=t("label",{for:"locale"},"Local",-1)),t("div",We,[b(t("select",{id:"locale","onUpdate:modelValue":e[7]||(e[7]=n=>l.locale=n)},[e[22]||(e[22]=t("option",{value:""},"Todos os locais",-1)),(o(!0),a(g,null,C(R.value,n=>(o(),a("option",{key:n,value:n},u(n),9,Ke))),128))],512),[[te,l.locale]]),l.locale?(o(),a("button",{key:0,class:"btn-clear","aria-label":"Limpar local",type:"button",onClick:e[8]||(e[8]=n=>w("locale"))}," × ")):v("",!0)])]),t("div",Qe,[e[24]||(e[24]=t("label",null,"Intervalo de Datas",-1)),t("div",Je,[b(t("input",{"onUpdate:modelValue":e[9]||(e[9]=n=>l.start=n),type:"date"},null,512),[[q,l.start]]),b(t("input",{"onUpdate:modelValue":e[10]||(e[10]=n=>l.end=n),type:"date"},null,512),[[q,l.end]]),l.start||l.end?(o(),a("button",{key:0,class:"btn-clear","aria-label":"Limpar datas",type:"button",onClick:e[11]||(e[11]=n=>w("date"))}," × ")):v("",!0)])])]),t("div",null,[t("div",Xe,[e[25]||(e[25]=t("label",null,null,-1)),t("button",{class:"success",disabled:V.value,onClick:e[12]||(e[12]=n=>ie())},u(V.value?"Atualizando...":"Aplicar"),9,Ye)])])]),t("div",Ze,[t("span",null,[e[26]||(e[26]=t("i",{class:"la la-tasks"},null,-1)),z(" "+u(Array.isArray(D.value)?D.value.length:0),1)])])])],512),[[A,c.value==="filters"]]),b(t("div",et,[t("div",{class:"text-center flex col items-center gap-4"},[e[28]||(e[28]=t("b",{class:"mb-4 p"},"Ajustes de impressão:",-1)),t("div",{class:"p"},[t("button",{class:"success",onClick:ce},[...e[27]||(e[27]=[t("i",{class:"la la-print"},null,-1),z(" Imprimir ",-1)])])])]),t("div",tt,[t("div",st,[e[29]||(e[29]=t("b",null,"Tamanho da Fonte",-1)),b(t("input",{id:"fontSizeSlider",type:"range","onUpdate:modelValue":e[13]||(e[13]=n=>_.value=n),min:"0.5",max:"1.6",step:"0.05",list:"fontSteps"},null,512),[[q,_.value,void 0,{number:!0}]]),t("datalist",lt,[(o(),a(g,null,C(15,n=>t("option",{key:n,value:(n*.1).toFixed(1)},null,8,nt)),64))])]),t("div",ot,[e[30]||(e[30]=t("b",null,"Lista",-1)),t("div",null,[t("i",{class:y(["la",J.value?"la-toggle-on":"la-toggle-off"]),title:"Ocultar todos",onClick:e[14]||(e[14]=n=>ve(!J.value))},null,2)])]),(o(!0),a(g,null,C(S.value,(n,d)=>(o(),a("div",{key:n,class:y(["settings-list print-hide",{"drag-over":T.value===d}]),draggable:"true",onDragstart:r=>H(d),onDragover:L(r=>W(d),["prevent"]),onDrop:r=>K(d),onClick:r=>Q(n)},[z(u(n)+" ",1),t("i",{class:y(["la",f[n]?"la-toggle-on":"la-toggle-off"]),title:"Alterar visibilidade"},null,2)],42,at))),128))])],512),[[A,c.value==="print"]])])]),m.value.length?(o(),a("div",it,[(o(!0),a(g,null,C(m.value,(n,d)=>b((o(),a("div",{key:n.title,class:y(["table-list",{"drag-over":T.value===d}]),draggable:"true",style:{cursor:"move"},onDragstart:r=>H(d),onDragover:L(r=>W(d),["prevent"]),onDrop:r=>K(d)},[t("div",{class:"table-container",style:F({fontSize:_.value+"em"})},[t("table",null,[t("thead",null,[t("tr",null,[t("th",ut,[t("div",dt,[z(u(n.title)+" ",1),t("i",{class:"la la-toggle-on print-hide",style:{cursor:"pointer"},onClick:r=>Q(n.title)},null,8,ct)])])])]),t("tbody",null,[(o(!0),a(g,null,C(n.items,r=>(o(),a("tr",{key:r.id,onClick:L(E=>fe(r),["left"]),onContextmenu:L(E=>X(r),["prevent"]),onMousedown:L(E=>X(r),["right","prevent"])},[t("td",null,[r.formatDate?(o(),a("span",pt,u(r.formatDate),1)):v("",!0)]),t("td",null,[r.formatWeek?(o(),a("span",ft,u(r.formatWeek),1)):v("",!0)]),t("td",null,[r.formatTime?(o(),a("span",bt,u(r.formatTime),1)):v("",!0)]),t("td",null,u(r.locale),1),t("td",null,[r.desc?(o(),a("span",{key:0,innerHTML:se(he)(r.desc)},null,8,mt)):v("",!0)])],40,vt))),128))])])],4)],42,rt)),[[A,f[n.title]]])),128)),$.value?(o(),ee(se(Se),{key:0,editor:$.value,class:"editable",style:F({fontSize:_.value+"em"})},null,8,["editor","style"])):v("",!0)])):(o(),a("div",gt,[e[31]||(e[31]=t("p",{class:"text-center p"}," Nenhum evento encontrado com os filtros aplicados. ",-1)),t("div",yt,[t("button",{class:"btn",onClick:e[15]||(e[15]=()=>s.location.reload())}," Clique para recarregar a página ")])]))],64))])}}},Et=me(_t,[["__scopeId","data-v-8f2ffd61"]]);export{Et as default};
