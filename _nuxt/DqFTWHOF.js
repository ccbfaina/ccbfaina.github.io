import{L as pe}from"./DxGekH0p.js";import{_ as fe,u as be,r as f,y as J,o as X,z as E,j as T,P as me,c as u,A as Y,F as y,a as t,s as v,q as _,t as d,k as b,v as w,D as F,B as A,n as S,H as Z,f as z,m as ee,i as ge,Q as P,p as ye,b as a,L as x,E as _e}from"#entry";import{a as he,S as ke,E as Ce}from"./BlSOZO3q.js";import{d as te}from"./D0Dr7phT.js";const De={class:"tabs-container print-hide"},Te={class:"tabs justify-end","aria-label":"Tabs",role:"tablist","aria-orientation":"horizontal"},Se=["aria-selected"],$e={class:"badge"},Le=["aria-selected"],Ee={class:"badge"},xe=["aria-selected"],qe={class:"tab-content"},we={id:"tab-content-lista",role:"tabpanel"},Ae={key:0},ze={key:1},Ve={key:2},Oe={key:3},je={id:"tab-content-filters",role:"tabpanel"},Be={class:"content"},Fe={class:"form-inline"},Pe={class:"form-group"},Me={class:"row"},Ge={class:"form-group"},Ie={class:"row"},Ue=["value"],Ne={class:"form-group"},Re={class:"row"},He=["value"],We={class:"form-group"},Ke={class:"flex gap-xs"},Qe={class:"form-group",style:{"text-align":"right"}},Je=["disabled"],Xe={class:"form-inline",style:{gap:"1rem","margin-top":"1rem"}},Ye={id:"tab-content-print",role:"tabpanel"},Ze={class:"a4 print-hide"},et={class:"settings-list"},tt={id:"fontSteps"},lt=["value"],st={class:"settings-list print-hide"},nt=["onDragstart","onDragover","onDrop","onClick"],ot={key:0,class:"print-page"},at=["onDragstart","onDragover","onDrop"],rt={colspan:"5"},it={class:"flex items-center aling-center justify-center"},ut=["onClick"],dt=["onClick","onContextmenu","onMousedown","onTouchstartPassive","onTouchendPassive"],ct={key:0},vt={key:0},pt={key:0},ft=["innerHTML"],bt={__name:"index",setup(mt){const{$indexedDB:M}=be(),g=f([]),c=f("lista"),n=J({search:"",title:"",locale:"",date:"",start:"",end:"",calendars:[]}),h=f(1),V=ge(),O=ye(),j=f(!1),le=()=>{const l=V.query||{};["search","title","locale","date","start","end"].forEach(r=>{l[r]!==void 0&&(n[r]=l[r])}),l.calendars&&(n.calendars=Array.isArray(l.calendars)?l.calendars:l.calendars.split(",").filter(Boolean));const{today:o,future:s}=P();n.start||(n.start=o),n.end||(n.end=s)},G=te(()=>{const l=Object.fromEntries(Object.entries(n).filter(([e,o])=>e==="calendars"?o.length:o!==""&&o!=null).map(([e,o])=>Array.isArray(o)?[e,o.join(",")]:[e,o]));O.replace({query:l})},200);function se(){G()}X(()=>{le()}),E([n,h],G,{deep:!0});function q(l){if(l==="calendars")n.calendars=[];else if(l==="date"){n.date="";const{today:e,future:o}=P();n.start=e,n.end=o}else if(l==="start"||l==="end"){const{today:e,future:o}=P();n.start=e,n.end=o}else n[l]=""}function I(l,e){return Array.from(new Set(l.map(o=>o[e]).filter(o=>typeof o=="string"&&o.trim())))}const ne=T(()=>I(g.value,"title")),oe=T(()=>I(g.value,"locale")),ae=f([]),k=f([]),B=f([]),re=te(async()=>{const{events:l,calendars:e}=await M.getEvents(n)||[];B.value=await M.getTitles()||[],g.value=l,ae.value=e},400);E(()=>n,async()=>{n.start&&re()},{immediate:!0,deep:!0}),E(g,l=>{const e=Array.from(new Set(l.map(r=>r.title||"Sem título"))),s=(V.query.order?.split(",").filter(Boolean)||[]).filter(r=>e.includes(r));e.forEach(r=>{s.includes(r)||s.push(r)}),k.value=s},{immediate:!0}),E(k,l=>{const e={...V.query};l&&l.length>0?e.order=l.join(","):delete e.order,O.replace({query:e})});const m=T(()=>{const l={};return g.value.forEach(o=>{const s=o.title||"Sem título";(l[s]||=[]).push(o)}),k.value.slice().sort((o,s)=>{const r=B.value.indexOf(o),i=B.value.indexOf(s);return r===-1&&i===-1?0:r===-1?1:i===-1?-1:r-i}).filter(o=>l[o]).map(o=>({title:o,items:l[o].slice().sort((s,r)=>s.onDate&&r.onDate?s.onDate-r.onDate:0)}))}),U=l=>l?.replace(/-$/,"")?.trim(),ie=T(()=>{let l=0;return n.search&&l++,n.title&&l++,n.locale&&l++,n.date&&l++,n.calendars&&n.calendars.length>0&&l++,l}),ue=()=>{c.value="lista",setTimeout(()=>{window.print()},1e3)},C=f(null),$=f(null),N=l=>{C.value=l},R=l=>{$.value=l},H=l=>{if(C.value===null||C.value===l){C.value=null,$.value=null;return}const e=[...k.value],[o]=e.splice(C.value,1);e.splice(l,0,o),k.value=e,C.value=null,$.value=null},p=J({});E(m,()=>{if(!m.value)return;const l=m.value.map(e=>e.title);l.forEach(e=>{e in p||(p[e]=!0)});for(const e in p)l.includes(e)||delete p[e]},{immediate:!0});const W=l=>{c.value="print",p[l]=!p[l]},K=T(()=>m.value.length>0&&m.value.every(l=>p[l.title])),de=l=>{m.value.forEach(e=>{p[e.title]=l})},L=f(null),ce=T(()=>Object.values(p).filter(Boolean).length);X(()=>{L.value=new he({extensions:[ke],content:`
      <p>Oração Santa Ceia</p>
      <p><strong>Pão:</strong> "Senhor, abençoa este Pão que vamos comer, que é a comunhão do Corpo de Cristo."</p>
      <p><strong>Cálice:</strong> "Senhor, abençoa o Cálice que vamos beber, que é a comunhão do Sangue de Cristo."</p>
    `,editable:!0})}),me(()=>{L.value&&L.value.destroy()});const ve=l=>{O.push({path:"/evento",query:{id:l.id}})};function Q(l){l&&l.htmlLink&&window.open(l.htmlLink,"_blank")}return(l,e)=>{const o=pe;return a(),u("div",null,[j.value?(a(),Y(o,{key:0})):(a(),u(y,{key:1},[t("div",De,[t("nav",Te,[t("span",{id:"tab-filters","aria-selected":c.value==="filters",role:"tab",type:"button",class:_(["tab",{active:c.value==="filters"}]),style:{position:"relative"},onClick:e[0]||(e[0]=s=>c.value="filters")},[t("span",$e,d(ie.value),1),e[15]||(e[15]=t("i",{class:"la la-filter z-10"},null,-1))],10,Se),t("span",{id:"tab-print","aria-selected":c.value==="print",role:"tab",type:"button",class:_(["tab",{active:c.value==="print"}]),onClick:e[1]||(e[1]=s=>c.value="print")},[t("span",Ee,d(ce.value),1),e[16]||(e[16]=t("i",{class:"la la-print"},null,-1))],10,Le),t("span",{id:"tab-lista","aria-selected":c.value==="lista",role:"tab",type:"button",class:_(["tab",{active:c.value==="lista"}]),onClick:e[2]||(e[2]=s=>c.value="lista")}," Lista ",10,xe)])]),t("div",null,[t("div",qe,[b(t("div",we,[t("div",{class:"text-center",style:F({fontSize:h.value+"em"})},[e[17]||(e[17]=t("div",null,"LISTA DE ATENDIMENTO E DIVERSOS",-1)),n.calendars.length?(a(),u("div",Ae,[t("b",null,d(n.calendars.map(U).join(", ")),1)])):v("",!0),n.locale?(a(),u("span",ze,[t("b",null,d(U(n.locale)),1)])):v("",!0),!n.date&&(n.start||n.end)?(a(),u("div",Ve," Período: "+d(n.start?.split("T")[0]?.split("-")?.reverse()?.join("/"))+" à "+d(n.end?.split("T")[0]?.split("-")?.reverse()?.join("/")),1)):v("",!0),n.search?(a(),u("div",Oe,d(n.search),1)):v("",!0)],4)],512),[[w,c.value==="lista"]]),b(t("div",je,[t("div",Be,[t("div",Fe,[t("div",null,[t("div",Pe,[e[18]||(e[18]=t("label",{for:"search"},"Pesquisar",-1)),t("div",Me,[b(t("input",{id:"search","onUpdate:modelValue":e[3]||(e[3]=s=>n.search=s),type:"text",placeholder:"Buscar itens..."},null,512),[[A,n.search]]),n.search?(a(),u("button",{key:0,class:"btn-clear","aria-label":"Limpar pesquisa",type:"button",onClick:e[4]||(e[4]=s=>q("search"))}," × ")):v("",!0)])]),t("div",Ge,[e[20]||(e[20]=t("label",{for:"title"},"Título",-1)),t("div",Ie,[b(t("select",{id:"title","onUpdate:modelValue":e[5]||(e[5]=s=>n.title=s)},[e[19]||(e[19]=t("option",{value:""},"Todos os títulos",-1)),(a(!0),u(y,null,S(ne.value,s=>(a(),u("option",{key:s,value:s},d(s),9,Ue))),128))],512),[[Z,n.title]]),n.title?(a(),u("button",{key:0,class:"btn-clear","aria-label":"Limpar título",type:"button",onClick:e[6]||(e[6]=s=>q("title"))}," × ")):v("",!0)])]),t("div",Ne,[e[22]||(e[22]=t("label",{for:"locale"},"Local",-1)),t("div",Re,[b(t("select",{id:"locale","onUpdate:modelValue":e[7]||(e[7]=s=>n.locale=s)},[e[21]||(e[21]=t("option",{value:""},"Todos os locais",-1)),(a(!0),u(y,null,S(oe.value,s=>(a(),u("option",{key:s,value:s},d(s),9,He))),128))],512),[[Z,n.locale]]),n.locale?(a(),u("button",{key:0,class:"btn-clear","aria-label":"Limpar local",type:"button",onClick:e[8]||(e[8]=s=>q("locale"))}," × ")):v("",!0)])]),t("div",We,[e[23]||(e[23]=t("label",null,"Intervalo de Datas",-1)),t("div",Ke,[b(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>n.start=s),type:"date"},null,512),[[A,n.start]]),b(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>n.end=s),type:"date"},null,512),[[A,n.end]]),n.start||n.end?(a(),u("button",{key:0,class:"btn-clear","aria-label":"Limpar datas",type:"button",onClick:e[11]||(e[11]=s=>q("date"))}," × ")):v("",!0)])])]),t("div",null,[t("div",Qe,[e[24]||(e[24]=t("label",null,null,-1)),t("button",{class:"success",disabled:j.value,onClick:e[12]||(e[12]=s=>se())},d(j.value?"Atualizando...":"Aplicar"),9,Je)])])]),t("div",Xe,[t("span",null,[e[25]||(e[25]=t("i",{class:"la la-tasks"},null,-1)),z(" "+d(Array.isArray(g.value)?g.value.length:0),1)])])])],512),[[w,c.value==="filters"]]),b(t("div",Ye,[t("div",{class:"text-center flex col items-center gap-4"},[e[27]||(e[27]=t("b",{class:"mb-4 p"},"Ajustes de impressão:",-1)),t("div",{class:"p"},[t("button",{class:"success",onClick:ue},[...e[26]||(e[26]=[t("i",{class:"la la-print"},null,-1),z(" Imprimir ",-1)])])])]),t("div",Ze,[t("div",et,[e[28]||(e[28]=t("b",null,"Tamanho da Fonte",-1)),b(t("input",{id:"fontSizeSlider",type:"range","onUpdate:modelValue":e[13]||(e[13]=s=>h.value=s),min:"0.5",max:"1.6",step:"0.05",list:"fontSteps"},null,512),[[A,h.value,void 0,{number:!0}]]),t("datalist",tt,[(a(),u(y,null,S(15,s=>t("option",{key:s,value:(s*.1).toFixed(1)},null,8,lt)),64))])]),t("div",st,[e[29]||(e[29]=t("b",null,"Lista",-1)),t("div",null,[t("i",{class:_(["la",K.value?"la-toggle-on":"la-toggle-off"]),title:"Ocultar todos",onClick:e[14]||(e[14]=s=>de(!K.value))},null,2)])]),(a(!0),u(y,null,S(k.value,(s,r)=>(a(),u("div",{key:s,class:_(["settings-list print-hide",{"drag-over":$.value===r}]),draggable:"true",onDragstart:i=>N(r),onDragover:x(i=>R(r),["prevent"]),onDrop:i=>H(r),onClick:i=>W(s)},[z(d(s)+" ",1),t("i",{class:_(["la",p[s]?"la-toggle-on":"la-toggle-off"]),title:"Alterar visibilidade"},null,2)],42,nt))),128))])],512),[[w,c.value==="print"]])])]),m.value.length?(a(),u("div",ot,[(a(!0),u(y,null,S(m.value,(s,r)=>b((a(),u("div",{key:s.title,class:_(["table-list",{"drag-over":$.value===r}]),draggable:"true",style:{cursor:"move"},onDragstart:i=>N(r),onDragover:x(i=>R(r),["prevent"]),onDrop:i=>H(r)},[t("div",{class:"table-container",style:F({fontSize:h.value+"em"})},[t("table",null,[t("thead",null,[t("tr",null,[t("th",rt,[t("div",it,[z(d(s.title)+" ",1),t("i",{class:"la la-toggle-on print-hide",style:{cursor:"pointer"},onClick:i=>W(s.title)},null,8,ut)])])])]),t("tbody",null,[(a(!0),u(y,null,S(s.items,i=>(a(),u("tr",{key:i.id,onClick:x(D=>ve(i),["left"]),onContextmenu:x(D=>Q(i),["prevent"]),onMousedown:x(D=>Q(i),["right","prevent"]),onTouchstartPassive:D=>l.handleTouchStart(D,i),onTouchendPassive:D=>l.handleTouchEnd(D,i)},[t("td",null,[i.formatDate?(a(),u("span",ct,d(i.formatDate),1)):v("",!0)]),t("td",null,[i.formatWeek?(a(),u("span",vt,d(i.formatWeek),1)):v("",!0)]),t("td",null,[i.formatTime?(a(),u("span",pt,d(i.formatTime),1)):v("",!0)]),t("td",null,d(i.locale),1),t("td",null,[i.desc?(a(),u("span",{key:0,innerHTML:ee(_e)(i.desc)},null,8,ft)):v("",!0)])],40,dt))),128))])])],4)],42,at)),[[w,p[s.title]]])),128)),L.value?(a(),Y(ee(Ce),{key:0,editor:L.value,class:"editable",style:F({fontSize:h.value+"em"})},null,8,["editor","style"])):v("",!0)])):v("",!0)],64))])}}},Ct=fe(bt,[["__scopeId","data-v-65c0ef1f"]]);export{Ct as default};
