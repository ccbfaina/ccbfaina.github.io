import{_ as E,u as I,r as y,A as U,j as M,o as O,B as T,c as d,a as o,m as g,C as N,t as a,y as k,F as z,p as G,I as H,i as W,s as J,b as c,f as u,l as K,G as Q}from"#entry";import{d as A}from"./D0Dr7phT.js";const X={class:"page-relatorio"},Y={class:"filters"},Z={class:"form-group"},ee={class:"form-group"},oe={class:"row gap flex-end",style:{"justify-content":"flex-end","margin-bottom":"1em","align-items":"center"}},te={style:{color:"#a4a4a4"}},se=["disabled"],ne={class:"table-container"},ae=["onMouseup"],le={class:"cursor"},ie={key:0},re=["innerHTML"],de={key:0},ce={class:"row space-between"},ue={class:"form-group"},fe={class:"row gap-xs text-center flex-end"},pe=["disabled"],me=["disabled"],ve={__name:"relatorio",setup(be){const{$toast:h,$indexedDB:D}=I(),_=W(),L=J(),f=y([]),l=y(0),i=y(!1),e=U({nome:"",cidade:"",offset:0,limit:50}),$=M(()=>Math.floor(e.offset/e.limit)+1),j=M(()=>l.value?Math.ceil(l.value/e.limit):1),v=async()=>{i.value=!0;try{const s=await D.getRelatorio({nome:e.nome,cidade:e.cidade,locale:"",offset:e.offset,limit:e.limit});f.value=s?.items||[],l.value=s?.total||0}catch{f.value=[],l.value=0}finally{i.value=!1}},w=A(v,300),q=()=>{e.offset=0,p()},B=()=>{e.nome="",e.cidade="",e.offset=0,p()},C=()=>{if(typeof window>"u"||typeof document>"u")return;const s=document.querySelector(".content");s?typeof s.scrollTo=="function"?s.scrollTo({top:0,behavior:"smooth"}):s.scrollTop=0:typeof window.scrollTo=="function"&&window.scrollTo({top:0,behavior:"smooth"})},F=()=>{e.offset=Math.max(0,e.offset-e.limit),p(),C()},P=()=>{e.offset+e.limit<l.value&&(e.offset=e.offset+e.limit,p(),C())},p=A(()=>{const s=Object.fromEntries(Object.entries(e).filter(([,t])=>t!==""&&t!==0&&t!=null).map(([t,n])=>[t,Array.isArray(n)?n.join(","):String(n)]));L.replace({query:s}),w()},400),x=()=>{const s=_.query||{};e.nome=s.search||"",e.offset=s.offset&&parseInt(s.offset,10)||0,e.limit=s.limit&&parseInt(s.limit,10)||50};O(async()=>{x(),await v()}),T(()=>_.query,()=>{x(),v()}),T([()=>[e.nome,e.cidade],()=>e.limit,()=>e.offset],()=>{w()});let b=null;const R=s=>{b=s.currentTarget},S=async(s,t)=>{if(b!==s.currentTarget)return;b=null;const n=window.getSelection(),r=n?n.toString().trim():"";if(r){try{await navigator.clipboard.writeText(r)}catch{const m=document.createElement("textarea");m.value=r,document.body.appendChild(m),m.select(),document.execCommand("copy"),document.body.removeChild(m)}h.success("Texto copiado para a Ã¡rea de transferÃªncia");return}V(t),h.success("Abrindo Google Maps")},V=s=>{window.open(`https://www.google.com/maps/search/?api=1&query=CCB CongregaÃ§Ã£o ${s.NomeLocalidade} ${s.NomeCidade} ${s.NomeEstado} ${s.NomePais} ${s.Cep}`,"_blank","noopener noreferrer")};return(s,t)=>(c(),d("div",X,[o("div",Y,[o("div",Z,[t[3]||(t[3]=o("label",{for:"search"},"MinistÃ©rio",-1)),g(o("input",{id:"search","onUpdate:modelValue":t[0]||(t[0]=n=>e.nome=n),type:"text",placeholder:"Nome"},null,512),[[N,e.nome]])]),o("div",ee,[t[4]||(t[4]=o("label",{for:"search"},"Cidade",-1)),g(o("input",{id:"search","onUpdate:modelValue":t[1]||(t[1]=n=>e.cidade=n),type:"text",placeholder:"Cidade"},null,512),[[N,e.cidade]])])]),o("div",oe,[o("small",te,"Total: "+a(l.value),1),o("button",{class:"success",disabled:i.value,onClick:q},a(i.value?"Aguarde...":"Aplicar"),9,se),o("button",{onClick:B},"Limpar")]),o("div",ne,[o("table",null,[t[8]||(t[8]=o("thead",null,[o("tr",null,[o("th",null,"Local"),o("th",null,"Culto"),o("th",null,"MinistÃ©rio")])],-1)),o("tbody",null,[(c(!0),d(z,null,G(f.value,n=>(c(),d("tr",{key:n.Codigo,onMousedown:R,onMouseup:r=>S(r,n)},[o("td",le,[u(" ğŸ“ "+a(n.NomeLocalidade)+" ",1),t[5]||(t[5]=o("br",null,null,-1)),u(" ğŸ™ï¸ "+a(n.NomeCidade)+" ",1),t[6]||(t[6]=o("br",null,null,-1)),u(" ğŸŒ "+a(n.NomeEstado),1)]),o("td",null,[u(a(n.DiasCultosConcatenado)+" ",1),n.DiasCultosConcatenado?(c(),d("br",ie)):k("",!0),u(" "+a(n.Observacao),1)]),o("td",null,[o("div",{innerHTML:K(Q)(n.MinisterioConcatenados?.split(";").join("<br>"))},null,8,re)])],40,ae))),128)),!f.value.length&&!i.value?(c(),d("tr",de,[...t[7]||(t[7]=[o("td",{colspan:"6"},"Nenhum registro encontrado.",-1)])])):k("",!0)])])]),o("div",ce,[o("div",ue,[g(o("select",{"onUpdate:modelValue":t[2]||(t[2]=n=>e.limit=n),style:{"min-width":"100px"}},[...t[9]||(t[9]=[o("option",{value:50},"50",-1),o("option",{value:100},"100",-1),o("option",{value:200},"200",-1)])],512),[[H,e.limit,void 0,{number:!0}]])]),o("div",fe,[o("small",null,"PÃ¡gina: "+a($.value)+" / "+a(j.value),1),o("button",{disabled:e.offset===0,onClick:F},"Anterior",8,pe),o("button",{disabled:e.offset+e.limit>=l.value,onClick:P},"PrÃ³xima",8,me)])])]))}},he=E(ve,[["__scopeId","data-v-71ae7831"]]);export{he as default};
