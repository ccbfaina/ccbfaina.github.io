import{L as ce}from"./DxGekH0p.js";import{_ as ve,u as pe,r as f,y as W,o as K,z as x,j as C,P as fe,c as i,A as Q,F as y,a as t,s as v,q as _,t as d,k as b,v as q,D as j,B as A,n as S,H as J,f as L,m as X,i as be,Q as B,p as me,b as o,L as Y,E as ge}from"#entry";import{a as ye,S as _e,E as ke}from"./BlSOZO3q.js";import{d as Z}from"./D0Dr7phT.js";const he={class:"tabs-container print-hide"},De={class:"tabs justify-end","aria-label":"Tabs",role:"tablist","aria-orientation":"horizontal"},Ce=["aria-selected"],Se={class:"badge"},Te=["aria-selected"],$e={class:"badge"},xe=["aria-selected"],Ee={class:"tab-content"},qe={id:"tab-content-lista",role:"tabpanel"},Ae={key:0},Le={key:1},ze={key:2},Ve={key:3},we={id:"tab-content-filters",role:"tabpanel"},Oe={class:"content"},je={class:"form-inline"},Be={class:"form-group"},Fe={class:"row"},Ge={class:"form-group"},Ie={class:"row"},Ue=["value"],Me={class:"form-group"},Ne={class:"row"},Pe=["value"],Re={class:"form-group"},He={class:"flex gap-xs"},We={class:"form-group",style:{"text-align":"right"}},Ke=["disabled"],Qe={class:"form-inline",style:{gap:"1rem","margin-top":"1rem"}},Je={id:"tab-content-print",role:"tabpanel"},Xe={class:"a4 print-hide"},Ye={class:"settings-list"},Ze={id:"fontSteps"},et=["value"],tt={class:"settings-list print-hide"},lt=["onDragstart","onDragover","onDrop","onClick"],st={key:0,class:"print-page"},nt=["onDragstart","onDragover","onDrop"],at={colspan:"5"},ot={class:"flex items-center aling-center justify-center"},rt=["onClick"],it=["onClick"],ut={key:0},dt={key:0},ct={key:0},vt=["innerHTML"],pt={__name:"index",setup(ft){const{$indexedDB:F}=pe(),g=f([]),c=f("lista"),n=W({search:"",title:"",locale:"",date:"",start:"",end:"",calendars:[]}),k=f(1),z=be(),V=me(),w=f(!1),ee=()=>{const l=z.query||{};["search","title","locale","date","start","end"].forEach(r=>{l[r]!==void 0&&(n[r]=l[r])}),l.calendars&&(n.calendars=Array.isArray(l.calendars)?l.calendars:l.calendars.split(",").filter(Boolean));const{today:a,future:s}=B();n.start||(n.start=a),n.end||(n.end=s)},G=Z(()=>{const l=Object.fromEntries(Object.entries(n).filter(([e,a])=>e==="calendars"?a.length:a!==""&&a!=null).map(([e,a])=>Array.isArray(a)?[e,a.join(",")]:[e,a]));V.replace({query:l})},200);function te(){G()}K(()=>{ee()}),x([n,k],G,{deep:!0});function E(l){if(l==="calendars")n.calendars=[];else if(l==="date"){n.date="";const{today:e,future:a}=B();n.start=e,n.end=a}else if(l==="start"||l==="end"){const{today:e,future:a}=B();n.start=e,n.end=a}else n[l]=""}function I(l,e){return Array.from(new Set(l.map(a=>a[e]).filter(a=>typeof a=="string"&&a.trim())))}const le=C(()=>I(g.value,"title")),se=C(()=>I(g.value,"locale")),ne=f([]),h=f([]),O=f([]),ae=Z(async()=>{const{events:l,calendars:e}=await F.getEvents(n)||[];O.value=await F.getTitles()||[],g.value=l,ne.value=e},400);x(()=>n,async()=>{n.start&&ae()},{immediate:!0,deep:!0}),x(g,l=>{const e=Array.from(new Set(l.map(r=>r.title||"Sem título"))),s=(z.query.order?.split(",").filter(Boolean)||[]).filter(r=>e.includes(r));e.forEach(r=>{s.includes(r)||s.push(r)}),h.value=s},{immediate:!0}),x(h,l=>{const e={...z.query};l&&l.length>0?e.order=l.join(","):delete e.order,V.replace({query:e})});const m=C(()=>{const l={};return g.value.forEach(a=>{const s=a.title||"Sem título";(l[s]||=[]).push(a)}),h.value.slice().sort((a,s)=>{const r=O.value.indexOf(a),u=O.value.indexOf(s);return r===-1&&u===-1?0:r===-1?1:u===-1?-1:r-u}).filter(a=>l[a]).map(a=>({title:a,items:l[a].slice().sort((s,r)=>s.onDate&&r.onDate?s.onDate-r.onDate:0)}))}),U=l=>l?.replace(/-$/,"")?.trim(),oe=C(()=>{let l=0;return n.search&&l++,n.title&&l++,n.locale&&l++,n.date&&l++,n.calendars&&n.calendars.length>0&&l++,l}),re=()=>{c.value="lista",setTimeout(()=>{window.print()},1e3)},D=f(null),T=f(null),M=l=>{D.value=l},N=l=>{T.value=l},P=l=>{if(D.value===null||D.value===l){D.value=null,T.value=null;return}const e=[...h.value],[a]=e.splice(D.value,1);e.splice(l,0,a),h.value=e,D.value=null,T.value=null},p=W({});x(m,()=>{if(!m.value)return;const l=m.value.map(e=>e.title);l.forEach(e=>{e in p||(p[e]=!0)});for(const e in p)l.includes(e)||delete p[e]},{immediate:!0});const R=l=>{c.value="print",p[l]=!p[l]},H=C(()=>m.value.length>0&&m.value.every(l=>p[l.title])),ie=l=>{m.value.forEach(e=>{p[e.title]=l})},$=f(null),ue=C(()=>Object.values(p).filter(Boolean).length);K(()=>{$.value=new ye({extensions:[_e],content:`
      <p>Oração Santa Ceia</p>
      <p><strong>Pão:</strong> "Senhor, abençoa este Pão que vamos comer, que é a comunhão do Corpo de Cristo."</p>
      <p><strong>Cálice:</strong> "Senhor, abençoa o Cálice que vamos beber, que é a comunhão do Sangue de Cristo."</p>
    `,editable:!0})}),fe(()=>{$.value&&$.value.destroy()});const de=l=>{V.push({path:"/evento",query:{id:l.id}})};return(l,e)=>{const a=ce;return o(),i("div",null,[w.value?(o(),Q(a,{key:0})):(o(),i(y,{key:1},[t("div",he,[t("nav",De,[t("span",{id:"tab-filters","aria-selected":c.value==="filters",role:"tab",type:"button",class:_(["tab",{active:c.value==="filters"}]),style:{position:"relative"},onClick:e[0]||(e[0]=s=>c.value="filters")},[t("span",Se,d(oe.value),1),e[15]||(e[15]=t("i",{class:"la la-filter z-10"},null,-1))],10,Ce),t("span",{id:"tab-print","aria-selected":c.value==="print",role:"tab",type:"button",class:_(["tab",{active:c.value==="print"}]),onClick:e[1]||(e[1]=s=>c.value="print")},[t("span",$e,d(ue.value),1),e[16]||(e[16]=t("i",{class:"la la-print"},null,-1))],10,Te),t("span",{id:"tab-lista","aria-selected":c.value==="lista",role:"tab",type:"button",class:_(["tab",{active:c.value==="lista"}]),onClick:e[2]||(e[2]=s=>c.value="lista")}," Lista ",10,xe)])]),t("div",null,[t("div",Ee,[b(t("div",qe,[t("div",{class:"text-center",style:j({fontSize:k.value+"em"})},[e[17]||(e[17]=t("div",null,"LISTA DE ATENDIMENTO E DIVERSOS",-1)),n.calendars.length?(o(),i("div",Ae,[t("b",null,d(n.calendars.map(U).join(", ")),1)])):v("",!0),n.locale?(o(),i("span",Le,[t("b",null,d(U(n.locale)),1)])):v("",!0),!n.date&&(n.start||n.end)?(o(),i("div",ze," Período: "+d(n.start?.split("T")[0]?.split("-")?.reverse()?.join("/"))+" à "+d(n.end?.split("T")[0]?.split("-")?.reverse()?.join("/")),1)):v("",!0),n.search?(o(),i("div",Ve,d(n.search),1)):v("",!0)],4)],512),[[q,c.value==="lista"]]),b(t("div",we,[t("div",Oe,[t("div",je,[t("div",null,[t("div",Be,[e[18]||(e[18]=t("label",{for:"search"},"Pesquisar",-1)),t("div",Fe,[b(t("input",{id:"search","onUpdate:modelValue":e[3]||(e[3]=s=>n.search=s),type:"text",placeholder:"Buscar itens..."},null,512),[[A,n.search]]),n.search?(o(),i("button",{key:0,class:"btn-clear","aria-label":"Limpar pesquisa",type:"button",onClick:e[4]||(e[4]=s=>E("search"))}," × ")):v("",!0)])]),t("div",Ge,[e[20]||(e[20]=t("label",{for:"title"},"Título",-1)),t("div",Ie,[b(t("select",{id:"title","onUpdate:modelValue":e[5]||(e[5]=s=>n.title=s)},[e[19]||(e[19]=t("option",{value:""},"Todos os títulos",-1)),(o(!0),i(y,null,S(le.value,s=>(o(),i("option",{key:s,value:s},d(s),9,Ue))),128))],512),[[J,n.title]]),n.title?(o(),i("button",{key:0,class:"btn-clear","aria-label":"Limpar título",type:"button",onClick:e[6]||(e[6]=s=>E("title"))}," × ")):v("",!0)])]),t("div",Me,[e[22]||(e[22]=t("label",{for:"locale"},"Local",-1)),t("div",Ne,[b(t("select",{id:"locale","onUpdate:modelValue":e[7]||(e[7]=s=>n.locale=s)},[e[21]||(e[21]=t("option",{value:""},"Todos os locais",-1)),(o(!0),i(y,null,S(se.value,s=>(o(),i("option",{key:s,value:s},d(s),9,Pe))),128))],512),[[J,n.locale]]),n.locale?(o(),i("button",{key:0,class:"btn-clear","aria-label":"Limpar local",type:"button",onClick:e[8]||(e[8]=s=>E("locale"))}," × ")):v("",!0)])]),t("div",Re,[e[23]||(e[23]=t("label",null,"Intervalo de Datas",-1)),t("div",He,[b(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>n.start=s),type:"date"},null,512),[[A,n.start]]),b(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>n.end=s),type:"date"},null,512),[[A,n.end]]),n.start||n.end?(o(),i("button",{key:0,class:"btn-clear","aria-label":"Limpar datas",type:"button",onClick:e[11]||(e[11]=s=>E("date"))}," × ")):v("",!0)])])]),t("div",null,[t("div",We,[e[24]||(e[24]=t("label",null,null,-1)),t("button",{class:"success",disabled:w.value,onClick:e[12]||(e[12]=s=>te())},d(w.value?"Atualizando...":"Aplicar"),9,Ke)])])]),t("div",Qe,[t("span",null,[e[25]||(e[25]=t("i",{class:"la la-tasks"},null,-1)),L(" "+d(Array.isArray(g.value)?g.value.length:0),1)])])])],512),[[q,c.value==="filters"]]),b(t("div",Je,[t("div",{class:"text-center flex col items-center gap-4"},[e[27]||(e[27]=t("b",{class:"mb-4 p"},"Ajustes de impressão:",-1)),t("div",{class:"p"},[t("button",{class:"success",onClick:re},[...e[26]||(e[26]=[t("i",{class:"la la-print"},null,-1),L(" Imprimir ",-1)])])])]),t("div",Xe,[t("div",Ye,[e[28]||(e[28]=t("b",null,"Tamanho da Fonte",-1)),b(t("input",{id:"fontSizeSlider",type:"range","onUpdate:modelValue":e[13]||(e[13]=s=>k.value=s),min:"0.5",max:"1.6",step:"0.05",list:"fontSteps"},null,512),[[A,k.value,void 0,{number:!0}]]),t("datalist",Ze,[(o(),i(y,null,S(15,s=>t("option",{key:s,value:(s*.1).toFixed(1)},null,8,et)),64))])]),t("div",tt,[e[29]||(e[29]=t("b",null,"Lista",-1)),t("div",null,[t("i",{class:_(["la",H.value?"la-toggle-on":"la-toggle-off"]),title:"Ocultar todos",onClick:e[14]||(e[14]=s=>ie(!H.value))},null,2)])]),(o(!0),i(y,null,S(h.value,(s,r)=>(o(),i("div",{key:s,class:_(["settings-list print-hide",{"drag-over":T.value===r}]),draggable:"true",onDragstart:u=>M(r),onDragover:Y(u=>N(r),["prevent"]),onDrop:u=>P(r),onClick:u=>R(s)},[L(d(s)+" ",1),t("i",{class:_(["la",p[s]?"la-toggle-on":"la-toggle-off"]),title:"Alterar visibilidade"},null,2)],42,lt))),128))])],512),[[q,c.value==="print"]])])]),m.value.length?(o(),i("div",st,[(o(!0),i(y,null,S(m.value,(s,r)=>b((o(),i("div",{key:s.title,class:_(["table-list",{"drag-over":T.value===r}]),draggable:"true",style:{cursor:"move"},onDragstart:u=>M(r),onDragover:Y(u=>N(r),["prevent"]),onDrop:u=>P(r)},[t("div",{class:"table-container",style:j({fontSize:k.value+"em"})},[t("table",null,[t("thead",null,[t("tr",null,[t("th",at,[t("div",ot,[L(d(s.title)+" ",1),t("i",{class:"la la-toggle-on print-hide",style:{cursor:"pointer"},onClick:u=>R(s.title)},null,8,rt)])])])]),t("tbody",null,[(o(!0),i(y,null,S(s.items,u=>(o(),i("tr",{key:u.id,onClick:mt=>de(u)},[t("td",null,[u.formatDate?(o(),i("span",ut,d(u.formatDate),1)):v("",!0)]),t("td",null,[u.formatWeek?(o(),i("span",dt,d(u.formatWeek),1)):v("",!0)]),t("td",null,[u.formatTime?(o(),i("span",ct,d(u.formatTime),1)):v("",!0)]),t("td",null,d(u.locale),1),t("td",null,[u.desc?(o(),i("span",{key:0,innerHTML:X(ge)(u.desc)},null,8,vt)):v("",!0)])],8,it))),128))])])],4)],42,nt)),[[q,p[s.title]]])),128)),$.value?(o(),Q(X(ke),{key:0,editor:$.value,class:"editable",style:j({fontSize:k.value+"em"})},null,8,["editor","style"])):v("",!0)])):v("",!0)],64))])}}},ht=ve(pt,[["__scopeId","data-v-b72ff47d"]]);export{ht as default};
