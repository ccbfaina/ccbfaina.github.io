import{L as ie}from"./CmDiAl2l.js";import{_ as ce,r as m,z as ve,f as he,A as fe,g as pe,j as C,i as w,c as u,B as ge,a as o,x as g,F as y,n as D,e as N,k as be,C as me,D as Ce,o as r,s as M,t as H,E as A,b as ye,w as De,m as _e,G as Ge,d as ke}from"./Cgzjmo2D.js";const we={key:1,class:"calendar-wrapper"},Me={class:"calendar-header"},Te={class:"month-year"},Se={class:"calendar-table"},xe=["onClick"],Ee={class:"day-content"},Ne={class:"day-number"},Ae={key:0,class:"event-indicators"},qe={class:"events-panel"},Ue={class:"events-list-container"},Fe={class:"chips-container"},$e={key:0,class:"las la-toggle-on"},Be={key:1,class:"las la-toggle-off"},Re=["onClick"],Ye={key:0,class:"las la-toggle-on"},ze={key:1,class:"las la-toggle-off"},Ie={class:"chips-container"},Le=["onClick"],Pe={key:0,class:"las la-toggle-on"},Oe={key:1,class:"las la-toggle-off"},Xe={class:"search-container"},Ve={key:0},Je={class:"event-date-title"},je={class:"events-list"},He={class:"sub-events-list"},Qe=["innerHTML"],Ke={key:1,class:"no-events-message"},Q=50,We={__name:"agenda",setup(Ze){const b=pe(),q=m(!0),T=new Date,i=m(T.getMonth()),h=m(T.getFullYear()),c=m(null),a=ve({search:"",title:"",locale:"",date:"",start:"",end:"",enabledGroups:[],disabledGroups:[],enabledCalendars:[],disabledCalendars:[]}),{$toast:K,$indexedDB:W}=he(),k=m([]),U=m([]);fe(async()=>{b.query?.regionais==="true"&&a.enabledCalendars.push("REGIONAL FAINA","Regional Goiânia","Regional Uruaçu","Regional Bom Jesus","Regional Catalão","Brás"),console.log("Carregando eventos do IndexedDB com filtros:",{...a,calendars:a.enabledCalendars});const{data:e,message:s}=await W.getEvents({...a,calendars:a.enabledCalendars})||{},{events:t,calendars:n}=e;K.success(s||"Eventos carregados com sucesso."),k.value=t.sort((l,v)=>new Date(l.date)-new Date(v.date)),U.value=n});function F(){return[]}const _=C(()=>Array.from(new Set(k.value.map(e=>e.group))).filter(e=>e).sort((e,s)=>e.localeCompare(s)));w(_,e=>{if(!(b.query.groups&&b.query.groups.length>0)&&a.enabledGroups.length===0&&a.disabledGroups.length===0){const s=F(),t=F();s.length>0||t.length>0?(a.enabledGroups=s.filter(n=>e.includes(n)),a.disabledGroups=t.filter(n=>e.includes(n))):(a.enabledGroups=e.filter(n=>n!=="Rodízios"),a.disabledGroups=e.filter(n=>n==="Rodízios"))}},{immediate:!0}),w(U,e=>{b.query.calendars&&b.query.calendars.length>0||a.enabledCalendars.length===0&&a.disabledCalendars.length===0&&(a.enabledCalendars=[...e],a.disabledCalendars=[])},{immediate:!0}),w([()=>a.enabledGroups,()=>a.disabledGroups],()=>{},{deep:!0});const Z=C(()=>{const e=[...a.enabledGroups,...a.disabledGroups];return Array.from(new Set(e)).sort((t,n)=>t.localeCompare(n))}),ee=C(()=>{const e=[...a.enabledCalendars,...a.disabledCalendars];return Array.from(new Set(e)).sort((t,n)=>t.localeCompare(n))}),$=C(()=>a.enabledGroups.length===_.value.length);w(()=>k.value,()=>{const e=b.query||{};if(["search","title","locale","date","start","end"].forEach(t=>{e[t]!==void 0&&(a[t]=e[t])}),e.groups){const t=Array.isArray(e.groups)?e.groups:e.groups.split(",").filter(Boolean);a.enabledGroups=t.filter(n=>_.value.includes(n)),a.disabledGroups=_.value.filter(n=>!t.includes(n))}if(e.calendars){const t=Array.isArray(e.calendars)?e.calendars:e.calendars.split(",").filter(Boolean);a.enabledCalendars=t,a.disabledCalendars=[]}q.value=!1},{immediate:!0});function te(e){a.enabledGroups.includes(e)?(a.enabledGroups=a.enabledGroups.filter(t=>t!==e),a.disabledGroups.push(e)):(a.disabledGroups=a.disabledGroups.filter(t=>t!==e),a.enabledGroups.push(e)),a.enabledGroups.sort((t,n)=>t.localeCompare(n)),a.disabledGroups.sort((t,n)=>t.localeCompare(n))}function ae(){$.value?(a.disabledGroups=[..._.value],a.enabledGroups=[]):(a.enabledGroups=[..._.value],a.disabledGroups=[])}function se(e){a.enabledCalendars.includes(e)?(a.enabledCalendars=a.enabledCalendars.filter(t=>t!==e),a.disabledCalendars.push(e)):(a.disabledCalendars=a.disabledCalendars.filter(t=>t!==e),a.enabledCalendars.push(e)),a.enabledCalendars.sort((t,n)=>t.localeCompare(n)),a.disabledCalendars.sort((t,n)=>t.localeCompare(n))}const S=C(()=>{const e=a.search.trim();let s=Ce(k.value||[],a);if(b.query.next==="true"){const n=new Date;s=s.filter(l=>new Date(l.date)>n)}return s=s.filter(n=>a.enabledGroups.includes(n.group)).filter(n=>a.enabledCalendars.includes(n.list)).filter(n=>!n.noDate),s}),B=C(()=>{let e;if(c.value){const t=c.value.date;e=S.value.filter(n=>{const l=new Date(n.date);return l.getUTCFullYear()===t.getFullYear()&&l.getUTCMonth()===t.getMonth()&&l.getUTCDate()===t.getDate()})}else e=S.value.filter(t=>{const n=new Date(t.date);return n.getUTCFullYear()===h.value&&n.getUTCMonth()===i.value});const s=new Map;for(const t of e){const l=new Date(t.date).toISOString().split("T")[0];s.has(l)||s.set(l,new Map);const v=s.get(l);v.has(t.title)||v.set(t.title,[]),v.get(t.title).push(t)}return Array.from(s.entries()).sort(([t],[n])=>new Date(t)-new Date(n))}),R=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],ne=C(()=>`${R[i.value]} ${h.value}`),Y=C(()=>{const e=[],s=new Date(h.value,i.value,1).getDay(),t=new Date(h.value,i.value+1,0).getDate(),n=new Date(h.value,i.value,0).getDate();for(let d=s-1;d>=0;d--)e.push({dayNumber:n-d,date:new Date(h.value,i.value-1,n-d),isPrevMonth:!0,isNextMonth:!1,isToday:!1,hasEvent:!1,events:[]});for(let d=1;d<=t;d++){const p=new Date(h.value,i.value,d),f=S.value.filter(de=>{const E=new Date(de.date);return E.getUTCDate()===d&&E.getUTCMonth()===i.value&&E.getUTCFullYear()===h.value});e.push({dayNumber:d,date:p,isPrevMonth:!1,isNextMonth:!1,isToday:p.toDateString()===T.toDateString(),hasEvent:f.length>0,events:f})}const l=42-e.length;for(let d=1;d<=l;d++)e.push({dayNumber:d,date:new Date(h.value,i.value+1,d),isPrevMonth:!1,isNextMonth:!0,isToday:!1,hasEvent:!1,events:[]});const v=[];for(;e.length>0;)v.push(e.splice(0,7));return v});function le(e){const s=new Date(e),t=s.getUTCDate(),n=R[s.getUTCMonth()],l=s.getUTCFullYear();return`${t} de ${n} de ${l}`}function G(e){i.value+=e,i.value<0?(i.value=11,h.value--):i.value>11&&(i.value=0,h.value++),c.value=null}function oe(e){return{"prev-month-day":e.isPrevMonth||e.isNextMonth,today:e.isToday,"has-event":e.hasEvent,"selected-day":c.value&&e.date&&c.value.date&&c.value.date.toDateString()===e.date.toDateString()}}function z(e){e.isPrevMonth?(G(-1),c.value={...e,date:new Date(h.value,i.value,e.dayNumber)}):e.isNextMonth?(G(1),c.value={...e,date:new Date(h.value,i.value,e.dayNumber)}):c.value&&c.value.date.toDateString()===e.date.toDateString()?c.value=null:c.value=e}if(b.query?.data){const e=Y.value[0].find(s=>s.date?.toDateString()===new Date(b.query?.data+" 03:00:00")?.toDateString());e&&z(e)}function re(e){return c.value?e.some(s=>{const t=new Date(s.date),n=c.value.date;return t.getUTCFullYear()===n.getFullYear()&&t.getUTCMonth()===n.getMonth()&&t.getUTCDate()===n.getDate()}):!1}function ue(e){const s=new Set;for(const t of e)t.group&&s.add(t.group);return[...s]}const I=["#d6b8c1","#d1c965","#cdb8d1","#aed4d7","#b3a9a5","#a9c6aa","#d39a8f","#b0a2cc","#d28fa9","#b2d29f","#d1b05e","#84c9cc","#d1be83","#92c2be","#a3b1b5","#bdc75d"],L={Reuniões:"#c4d7b9",Atendimentos:"#b4d0e3",Rodízios:"#e6b97f",Outros:"#c3bfe0"},x=m({});function P(e){if(L[e])return L[e];if(!x.value[e]){const t=Array.from(new Set(k.value.map(n=>n.group).filter(n=>n!==null))).indexOf(e);x.value[e]=I[t%I.length]}return x.value[e]}function O(e){return{backgroundColor:P(e)}}const X=m(0),V=m(0);function J(e){X.value=e.touches?e.touches[0].clientX:e.clientX}function j(e){V.value=e.changedTouches?e.changedTouches[0].clientX:e.clientX;const s=V.value-X.value;s>Q?G(-1):s<-Q&&G(1)}return(e,s)=>{const t=ie,n=ke;return r(),u("div",null,[q.value?(r(),ge(t,{key:0})):(r(),u("div",we,[o("div",{class:"calendar-panel",onTouchstart:J,onTouchend:j,onMousedown:J,onMouseup:j},[o("div",Me,[o("i",{class:"las la-chevron-left",onClick:s[0]||(s[0]=l=>G(-1))}),o("h2",Te,g(ne.value),1),o("i",{class:"las la-chevron-right",onClick:s[1]||(s[1]=l=>G(1))})]),o("table",Se,[s[3]||(s[3]=o("thead",null,[o("tr",null,[o("th",null,"Dom"),o("th",null,"Seg"),o("th",null,"Ter"),o("th",null,"Qua"),o("th",null,"Qui"),o("th",null,"Sex"),o("th",null,"Sáb")])],-1)),o("tbody",null,[(r(!0),u(y,null,D(Y.value,(l,v)=>(r(),u("tr",{key:v},[(r(!0),u(y,null,D(l,d=>(r(),u("td",{key:d.date,class:M(oe(d)),onClick:p=>z(d)},[o("div",Ee,[o("div",Ne,g(d.dayNumber),1),d.events.length?(r(),u("div",Ae,[(r(!0),u(y,null,D(ue(d.events),p=>(r(),u("span",{key:p,class:"event-indicator",style:A({backgroundColor:P(p)})},null,4))),128))])):H("",!0)])],10,xe))),128))]))),128))])])],32),o("div",qe,[o("div",Ue,[s[6]||(s[6]=o("small",{style:{opacity:"0.8"}},"Grupos:",-1)),o("div",Fe,[o("span",{class:"chip",onClick:ae},[$.value?(r(),u("i",$e)):(r(),u("i",Be)),s[4]||(s[4]=N(" Todos os Grupos ",-1))]),(r(!0),u(y,null,D(Z.value,l=>(r(),u("span",{key:l,class:M(["chip",{"chip-disabled":a.disabledGroups.includes(l)}]),style:A(O(l)),onClick:v=>te(l)},[a.enabledGroups.includes(l)?(r(),u("i",Ye)):(r(),u("i",ze)),N(" "+g(l),1)],14,Re))),128))]),s[7]||(s[7]=o("small",{style:{opacity:"0.8"}},"Agenda(s):",-1)),o("div",Ie,[(r(!0),u(y,null,D(ee.value,l=>(r(),u("span",{key:l,class:M(["chip",{"chip-disabled":a.disabledCalendars.includes(l)}]),onClick:v=>se(l)},[a.enabledCalendars.includes(l)?(r(),u("i",Pe)):(r(),u("i",Oe)),N(" "+g(l),1)],10,Le))),128))]),o("div",Xe,[be(o("input",{"onUpdate:modelValue":s[2]||(s[2]=l=>a.search=l),type:"text",placeholder:"Buscar eventos...",class:"search-input"},null,512),[[me,a.search]]),s[5]||(s[5]=o("i",{class:"las la-search search-icon"},null,-1))]),Object.keys(B.value).length?(r(),u("div",Ve,[(r(!0),u(y,null,D(B.value,([l,v])=>(r(),u("div",{key:l},[o("h4",Je,g(le(l)),1),o("ul",je,[(r(!0),u(y,null,D(v,([d,p])=>(r(),u("li",{key:d,class:M({"selected-event":re(p)}),style:A(O(p[0].group))},[o("strong",null,g(d),1),o("ul",He,[(r(!0),u(y,null,D(p,f=>(r(),u("li",{key:f.id},[ye(n,{to:{path:"/evento",query:{id:f.id}}},{default:De(()=>[o("p",null,[o("b",null,[o("i",null,g(f.formatTime)+g(f.formatTime?" - ":"")+g(f.formatDate),1)])]),o("p",null,g(f.locale),1),f.desc?(r(),u("p",{key:0,innerHTML:_e(Ge)(f.desc)},null,8,Qe)):H("",!0)]),_:2},1032,["to"])]))),128))])],6))),128))])]))),128))])):(r(),u("p",Ke,"Nenhum evento agendado."))])])]))])}}},at=ce(We,[["__scopeId","data-v-562ce541"]]);export{at as default};
