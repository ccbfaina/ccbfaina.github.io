import{_ as B,r as O,f as se,z as N,c as w,p as T,o as y,i as I,a as t,B as S,s as re,u as G,x as te,l as m,b as R,A as U,G as ue,w as ce,n as F,t as x,T as pe,H as le,g as ne,m as fe,I as ie,F as Y,k as j,e as Z,y as ee,J as de,h as V,j as q,K as X,L as me,D as ge,v as Q}from"./CIqvZ9TS.js";import{d as oe}from"./BcZQbp_F.js";import{E as ve,a as ye,S as be}from"./DwwXAg1P.js";const $e={key:0,class:"space-y-4 max-w-md mx-auto"},De={__name:"git",setup(C,{expose:$}){const v=O(""),o=O(""),b=O(""),p=O(!1);se(()=>{const d=localStorage.getItem("git_config");if(d)try{const r=JSON.parse(atob(d));v.value=r.token||"",o.value=r.repoOwner||"",b.value=r.repoName||""}catch(r){console.log("Erro::: ",r)}p.value=!0}),N([v,o,b],()=>{const d={token:v.value,repoOwner:o.value,repoName:b.value};localStorage.setItem("git_config",btoa(JSON.stringify(d)))},{deep:!0});const D=()=>({Authorization:`Bearer ${v.value}`,"Content-Type":"application/json; charset=UTF-8",Accept:"application/vnd.github.v3+json"}),k=async d=>{const r=`https://api.github.com/repos/${o.value}/${b.value}/contents/${d}`,{data:a,error:s}=await re(r,{method:"GET",headers:D(),pick:["content","sha"],watch:!1},"$9xe66jx9KU");if(s.value)throw new Error(`Erro ao buscar: ${s.value.data?.message||s.value.message}`);return{content:Buffer.from(a.value.content,"base64").toString("utf-8"),sha:a.value.sha}},E=async(d,r)=>{console.log("Solicitacao de atualizacao:: ",d,r);const a=`https://api.github.com/repos/${o.value}/${b.value}/contents/${r}`,s=D();let c=null;try{const u=await k(r);if(u.content===d)return console.info("GIT: Conteúdo idêntico."),!1;c=u.sha}catch(u){if(!u.message.includes("404"))throw u;console.log("GIT: Arquivo será criado.")}const g={message:c?"Atualização via Nuxt":"Criação via Nuxt",content:Buffer.from(d,"utf-8").toString("base64"),...c&&{sha:c}},{error:h}=await re(a,{method:"PUT",headers:s,body:g,watch:!1},"$aH25C_JKj4");if(h.value)throw new Error(`Erro ao enviar: ${h.value.data?.message||h.value.message}`);return console.log("GIT: Enviado com sucesso!"),!0},_=async()=>{await E(`# Atualizado em ${new Date().toISOString()}`,"README.md")};return $({getFile:k,pushFile:E}),(d,r)=>p.value?(y(),w("div",$e,[I(t("input",{"onUpdate:modelValue":r[0]||(r[0]=a=>v.value=a),type:"password",placeholder:"Token",class:"input"},null,512),[[S,v.value]]),I(t("input",{"onUpdate:modelValue":r[1]||(r[1]=a=>o.value=a),placeholder:"Owner",class:"input"},null,512),[[S,o.value]]),I(t("input",{"onUpdate:modelValue":r[2]||(r[2]=a=>b.value=a),placeholder:"Repo",class:"input"},null,512),[[S,b.value]]),t("button",{class:"btn",onClick:_},"Sync")])):T("",!0)}},we=B(De,[["__scopeId","data-v-adc87aea"]]),ke={class:"container"},he={key:0},Ie={class:"dropdown-content"},Ee={class:"dropdown-avatar-container"},Se={class:"countdown"},Te={key:1},ae=!1,_e={__name:"auth",setup(C){const{auth:$}=G(),{$toast:v}=te(),o=O(!1),b=O(!1),p=O(!1);function D(){o.value=!o.value}function k(){o.value=!1}async function E(){const a=()=>v.success("Conectando"),s=c=>v.error("Erro ao conectar: "+c);try{await v.promise($.signIn({callback:a,errorCallback:s}),{pending:"Conectando...",success:"Janela de solicitação aberta!",error:"Erro ao conectar."})}catch(c){console.error("Erro ao fazer login:",c),s(c)}}async function _(){try{const a=()=>{v.success("Até logo!",{duration:2e3,position:"top-right"}),k()},s=c=>v.error("Erro ao desconectar: "+c);await $.signOut(a,s)}catch(a){v.error("Erro ao fazer logout: "+a)}}const d=a=>a>0?[a/3600,a%3600/60,a%60].map(s=>String(Math.floor(s)).padStart(2,"0")).join(":"):"00:00:00",r=ue({props:{src:{type:String,default:""},alt:{type:String,default:""},fallback:{type:String,default:""},hovered:Boolean,size:{type:Number,default:2.5},border:{type:String,default:"#d1d5db"}},setup(a){const s=O(!1);return()=>s.value?le("div",{class:"avatar-fallback",style:{width:`${a.size}rem`,height:`${a.size}rem`,borderRadius:"9999px",border:`2px solid ${a.border}`,display:"flex",alignItems:"center",justifyContent:"center",background:"#e5e7eb",color:"#111827",fontSize:a.size===4?"2rem":"1.25rem",fontWeight:600,transition:"border-color 0.2s"},class:{"avatar-hovered":a.hovered}},a.fallback):le("img",{src:a.src,alt:a.alt,class:"avatar",style:{width:`${a.size}rem`,height:`${a.size}rem`,borderRadius:"9999px",border:`2px solid ${a.border}`,transition:"border-color 0.2s"},class:{"avatar-hovered":a.hovered},onError:()=>s.value=!0})}});return(a,s)=>(y(),w("div",ke,[m($).user.token?(y(),w("div",he,[t("div",{class:"avatar-container",onClick:D,onMouseover:s[0]||(s[0]=c=>b.value=!0),onMouseleave:s[1]||(s[1]=c=>b.value=!1)},[(y(),U(m(r),{key:m($).user.picture,src:m($).user.picture,alt:m($).user.name,fallback:m($).user.name.charAt(0).toUpperCase(),hovered:b.value,size:2.5},null,8,["src","alt","fallback","hovered"]))],32),R(pe,{name:"fade"},{default:ce(()=>[o.value?(y(),w("div",{key:0,class:F(["dropdown",{"dropdown-dark":ae}])},[t("div",Ie,[t("div",Ee,[(y(),U(m(r),{key:m($).user.picture,src:m($).user.picture,alt:m($).user.name,fallback:m($).user.name.charAt(0).toUpperCase(),size:4,border:"#3b82f6"},null,8,["src","alt","fallback"]))]),t("div",{class:F(["user-name",{"user-name-dark":ae}])},x(m($).user.name),3),t("div",{class:F(["user-email",{"user-email-dark":ae}])},x(m($).user.email),3),t("button",{class:F(["signout-button",{"signout-button-hovered":p.value}]),onClick:_,onMouseover:s[2]||(s[2]=c=>p.value=!0),onMouseleave:s[3]||(s[3]=c=>p.value=!1)},[s[4]||(s[4]=t("span",null,"Sair",-1)),t("span",Se,x(d(m($).user.expires_countdown)),1)],34)])],2)):T("",!0)]),_:1}),o.value?(y(),w("div",{key:0,class:"overlay",onClick:k})):T("",!0)])):(y(),w("div",Te,[t("button",{class:"gsi-material-button",type:"button",onClick:E},s[5]||(s[5]=[t("div",{class:"gsi-material-button-state"},null,-1),t("div",{class:"gsi-material-button-content-wrapper"},[t("div",{class:"gsi-material-button-icon"}),t("span",{class:"gsi-material-button-contents"},"Entrar com Google")],-1)]))]))]))}},xe=B(_e,[["__scopeId","data-v-d834dc4c"]]),Ae={class:"form-inline"},Oe={class:"form-group"},Ce={class:"row"},Me={class:"form-group"},Le={class:"row"},Fe={class:"form-group"},Re={class:"row"},Ue=["value"],Ne={class:"form-group"},ze={class:"flex gap-xs"},Ve={class:"form-group"},qe={class:"flex gap-xs"},Ye={class:"form-group",style:{"align-items":"flex-start"}},je={class:"chips-container"},Be=["onClick"],Ge={key:0,class:"las la-toggle-on"},He={key:1,class:"las la-toggle-off"},Ke={class:"form-group",style:{"text-align":"right"}},We=["disabled"],Pe={class:"form-inline",style:{gap:"1rem","margin-top":"1rem"}},Je={__name:"filters-agenda",setup(C){const $=ne(),v=fe(),{agenda:o,auth:b}=G(),{$toast:p}=te(),D=O(!1),k={formatISOToInput(u){if(!u)return"";const n=new Date(u);return u.length>10?n.toISOString().slice(0,16):n.toISOString().slice(0,10)},getDefaultDates(){const u=new Date,n=new Date;return n.setDate(u.getDate()+70),{today:this.formatISOToInput(u),future:this.formatISOToInput(n)}},getFriendlyErrorMessage(u){const n=u?.result?.error?.message||u?.message||u?.toString()||"";return n.includes("Request is missing required authentication credential")?"Sua sessão expirou. Por favor, faça login novamente para acessar os eventos.":`Erro (${u?.result?.error?.code||""}) ao carregar eventos: ${n}`},sleep(u){return new Promise(n=>setTimeout(n,u))}},{today:E,future:_}=k.getDefaultDates();(()=>{const u=$.query||{};if(u.calendar){const n=Array.isArray(u.calendar)?u.calendar:u.calendar.split(",").filter(Boolean);o.filters.calendarIDs=n}else o.filters.calendarIDs=[];o.filters.title=u.title||"",o.filters.locale=u.locale||"",o.filters.search=u.search||"",o.filters.date=u.date||"",o.filters.start=u.start||E,o.filters.end=u.end||_})();const r=oe(()=>{const u=Object.fromEntries(Object.entries(o.filters).filter(([n,f])=>n==="calendarIDs"?Array.isArray(f)&&f.length>0:f!==""&&f!==null&&f!==void 0).map(([n,f])=>n==="calendarIDs"&&Array.isArray(f)?["calendar",f.join(",")]:[n,f]));v.replace({query:{...u}})},300);function a(u){o.filters[u]="",u==="date"&&(o.filters.start=k.formatISOToInput(E),o.filters.end=k.formatISOToInput(_)),u==="calendarIDs"&&(o.filters.calendarIDs=[]),r()}async function s(){try{if(window&&!window?.gapi?.client?.calendar){p.error("Google Calendar API não está disponível. Faça login ou aguarde o carregamento.");return}await k.sleep(200),await p.promise(o.fetchGoogleCalendars(),{pending:"Carregando eventos...",success:"Eventos carregados com sucesso!",error:{render({data:u}){return k.getFriendlyErrorMessage(u)}}})}catch(u){p.error(k.getFriendlyErrorMessage(u)),console.error(`Erro (${u.result?.error?.code}) ao carregar eventos: ${u.result?.error?.message}`,u)}finally{D.value=!1}}async function c(){await o.fetchGoogleEvents()}function g(u){o.filters.calendarIDs.includes(u)?o.filters.calendarIDs=o.filters.calendarIDs.filter(n=>n!==u):o.filters.calendarIDs.push(u)}const h=oe(async()=>{try{D.value=!0,await o.awaitGapi(),await s(),await c()}catch{p.error("Google Calendar API não foi carregada. Tente recarregar a página ou aguarde.")}finally{D.value=!1}},400);return N(()=>b.user.token,async u=>{u&&h()},{immediate:!0}),se(()=>{h()}),N(()=>({...o.filters}),()=>{r()},{deep:!0}),(u,n)=>(y(),w("div",null,[R(xe,{style:{"margin-bottom":"8px"}}),t("div",Ae,[t("div",null,[t("div",Oe,[n[10]||(n[10]=t("label",{for:"search",class:"text-sm font-medium text-gray-700 mb-1"},"Pesquisar",-1)),t("div",Ce,[I(t("input",{id:"search","onUpdate:modelValue":n[0]||(n[0]=f=>m(o).filters.search=f),type:"text",placeholder:"Buscar eventos..."},null,512),[[S,m(o).filters.search]]),m(o).filters.search?(y(),w("button",{key:0,"aria-label":"Limpar pesquisa",type:"button",onClick:n[1]||(n[1]=f=>a("search"))}," × ")):T("",!0)])]),t("div",Me,[n[11]||(n[11]=t("label",{for:"title",class:"text-sm font-medium text-gray-700 mb-1"},"Título",-1)),t("div",Le,[I(t("input",{id:"title","onUpdate:modelValue":n[2]||(n[2]=f=>m(o).filters.title=f),type:"text",placeholder:"Filtrar por título..."},null,512),[[S,m(o).filters.title]]),m(o).filters.title?(y(),w("button",{key:0,"aria-label":"Limpar título",type:"button",onClick:n[3]||(n[3]=f=>a("title"))}," × ")):T("",!0)])]),t("div",Fe,[n[13]||(n[13]=t("label",{for:"locale",class:"text-sm font-medium text-gray-700 mb-1"},"Local",-1)),t("div",Re,[I(t("select",{id:"locale","onUpdate:modelValue":n[4]||(n[4]=f=>m(o).filters.locale=f)},[n[12]||(n[12]=t("option",{value:""},"Todos os locais",-1)),(y(!0),w(Y,null,j(m(o).eventsLocales,f=>(y(),w("option",{key:f,value:f},x(f),9,Ue))),128))],512),[[ie,m(o).filters.locale]]),m(o).filters.locale?(y(),w("button",{key:0,"aria-label":"Limpar local",type:"button",onClick:n[5]||(n[5]=f=>a("locale"))}," × ")):T("",!0)])]),t("div",Ne,[n[14]||(n[14]=t("label",{for:"date",class:"text-sm font-medium text-gray-700 mb-1"},"Data",-1)),t("div",ze,[I(t("input",{id:"date","onUpdate:modelValue":n[6]||(n[6]=f=>m(o).filters.date=f),type:"date"},null,512),[[S,m(o).filters.date]]),m(o).filters.date?(y(),w("button",{key:0,"aria-label":"Limpar data",type:"button",onClick:n[7]||(n[7]=f=>a("date"))}," × ")):T("",!0)])]),t("div",Ve,[n[15]||(n[15]=t("label",null,"Intervalo de Datas",-1)),t("div",qe,[I(t("input",{id:"datepicker-range-start","onUpdate:modelValue":n[8]||(n[8]=f=>m(o).filters.start=f),type:"date"},null,512),[[S,m(o).filters.start]]),I(t("input",{id:"datepicker-range-end","onUpdate:modelValue":n[9]||(n[9]=f=>m(o).filters.end=f),type:"date"},null,512),[[S,m(o).filters.end]])])])]),t("div",null,[t("div",Ye,[n[16]||(n[16]=t("label",null,"Agendas",-1)),t("div",je,[(y(!0),w(Y,null,j(m(o).calendars,f=>(y(),w("span",{key:f.id,class:F(["chip",{"chip-disabled":!m(o).filters.calendarIDs.includes(f.id)}]),onClick:M=>g(f.id)},[m(o).filters.calendarIDs.includes(f.id)?(y(),w("i",Ge)):(y(),w("i",He)),Z(" "+x(f.summary),1)],10,Be))),128))])]),t("div",Ke,[n[17]||(n[17]=t("label",null,null,-1)),t("button",{class:"success",disabled:m(D)||m(o).loading,onClick:c},x(m(D)||m(o).loading?"Atualizando...":"Aplicar"),9,We)])])]),t("div",Pe,[t("span",null,[n[18]||(n[18]=t("i",{class:"la la-calendar-check"},null,-1)),Z(" "+x(m(o)?.calendars?.length),1)]),t("span",null,[n[19]||(n[19]=t("i",{class:"la la-tasks"},null,-1)),Z(" "+x(m(o).eventsFiltered?.length),1)])])]))}},Qe=B(Je,[["__scopeId","data-v-b8b959f1"]]),Ze={class:"suggestion-container"},Xe=["onClick"],et={__name:"suggestion",props:{suggestions:{type:Array,required:!0}},emits:["select"],setup(C,{emit:$}){const v=$,o=p=>typeof p=="string"?p:JSON.stringify(p),b=p=>{v("select",p)};return(p,D)=>(y(),w("ul",Ze,[(y(!0),w(Y,null,j(C.suggestions,k=>(y(),w("li",{key:o(k),class:"suggestion-item",onClick:E=>b(k)},x(k),9,Xe))),128))]))}},P=B(et,[["__scopeId","data-v-b2c7e18e"]]),tt={key:0},at={colspan:"2"},ot={class:"col"},st={class:"col"},nt={__name:"AddEventRow",props:{initialTitle:{type:String,default:""},initialLocale:{type:String,default:""},initialDesc:{type:String,default:""},initialDate:{type:String,default:""}},setup(C){const $=C,{$toast:v}=te(),{lista:o,agenda:b}=G(),p=ne(),D=l=>String(l).padStart(2,"0");function k(l){return(l||"").toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim()}function E(l,e,i=4){if(!e)return l.slice(0,i);const A=k(e);return l.filter(L=>e!==L).filter(L=>A.split(" ").every(z=>k(L).includes(z))).slice(0,i)}function _(l){if(!l)return"";const e=new Date(l);return`${e.getFullYear()}-${D(e.getMonth()+1)}-${D(e.getDate())}T${D(e.getHours())}:${D(e.getMinutes())}`}function d(){const l=new Date,e=new Date(l);return e.setHours(19,0,0,0),{today:_(e)}}const{today:r}=d(),a=r,s=ee({calendarId:"",date:"",end:"",title:"",locale:"",desc:"",recurrence:"",rrule:""});function c(){s.date=$.initialDate||p.query?.date||a,s.title=($.initialTitle||p.query?.title||"").trim(),s.locale=($.initialLocale||p.query?.locale||"").trim(),s.desc=($.initialDesc||p.query?.desc||"").trim(),s.recurrence="",s.rrule="",s.end=""}se(()=>{c()}),N(()=>s.date,l=>{if(!l)return;const e=new Date(l),i=e.getMinutes()===0?2:1.5;s.end=_(new Date(e.getTime()+i*36e5))}),de(()=>{const l=b.calendars.filter(e=>b.filters.calendarIDs.includes(e.id));l.length===1&&(s.calendarId=l[0].id)});const g=o.locales,h=o.desc,u=V(()=>E(g,s.locale,3)),n=V(()=>{if(!s.desc)return[];const l=s.desc.trim().split(/\s+/),e=l.slice(-2).join(" "),i=l.slice(-1).join(" "),A=new Set([...E(h,e),...E(h,i)]);return Array.from(A).slice(0,3)});function f(l,e){e&&(s[l]=e)}function M(l,e){e&&e.length>0&&(s[l]=e[0])}function J(){}async function H(){if(!s.calendarId||!b.calendars.some(l=>l.id===s.calendarId)){alert("Selecione um calendário válido.");return}if(s.date&&s.title&&s.locale){const l={...s};try{const e=new Date(l.date);if(isNaN(e.getTime())){alert("Data inválida.");return}const i=new Date(l.end||e.getTime()+7200*1e3);if(isNaN(i.getTime())){alert("Data de término inválida.");return}if(i<e){alert("A data de término não pode ser anterior à data de início.");return}const A=Intl.DateTimeFormat().resolvedOptions().timeZone,L=e.toISOString(),z=i.toISOString(),K={summary:l.title,location:l.locale,description:l.desc,start:{dateTime:L,timeZone:A},end:{dateTime:z,timeZone:A}};l.recurrence&&(K.recurrence=[l.recurrence]);const W=await b.createGoogleEvent(l.calendarId,K);v.success(W.summary+" criado com sucesso: "+W.description),c()}catch(e){v.error("Erro ao criar evento: "+(e?.message||e)),console.log("Erro ao criar evento: ",e)}}else console.warn("Campos obrigatórios não preenchidos:",s),v.error("Por favor, preencha todos os campos obrigatórios."),alert("Por favor, preencha todos os campos obrigatórios.")}return(l,e)=>m(b).filters.calendarIDs.length===1?(y(),w("tr",tt,[t("td",at,[e[7]||(e[7]=t("label",{for:"date",class:"sr-only"},"Data Início:",-1)),I(t("input",{"onUpdate:modelValue":e[0]||(e[0]=i=>s.date=i),type:"datetime-local",required:"",class:"form-control"},null,512),[[S,s.date]])]),t("td",null,[e[8]||(e[8]=t("label",{for:"locale",class:"sr-only"},"Local:",-1)),t("div",ot,[I(t("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>s.locale=i),class:"form-control",type:"text",placeholder:"Local...",autocomplete:"off",onKeydown:[e[2]||(e[2]=q(X(i=>M("locale",u.value),["prevent"]),["enter"])),e[3]||(e[3]=q(i=>void 0,["tab"]))]},null,544),[[S,s.locale]]),s.locale.length>0&&u.value.length?(y(),U(P,{key:0,suggestions:u.value,onSelect:e[4]||(e[4]=i=>f("locale",i))},null,8,["suggestions"])):T("",!0)])]),t("td",null,[t("div",st,[e[9]||(e[9]=t("label",{for:"desc",class:"sr-only"},"Descrição:",-1)),I(t("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>s.desc=i),placeholder:"Descrição...",class:"form-control"},null,512),[[S,s.desc]]),s.desc.length>0&&n.value.length?(y(),U(P,{key:0,suggestions:n.value,onSelect:e[6]||(e[6]=i=>f("desc",i))},null,8,["suggestions"])):T("",!0)])]),t("td",null,[t("button",{title:"Adicionar evento",class:"btn-clean",style:{"font-size":"1.3rem",color:"#07bc0c"},onClick:H},e[10]||(e[10]=[t("i",{class:"las la-save"},null,-1)]))])])):T("",!0)}},rt=B(nt,[["__scopeId","data-v-89978e21"]]),lt={colspan:"8"},it=["onDblclick"],dt={key:0,class:"la la-redo-alt print-hide",style:{color:"#9e9e9e"}},ut={class:"tooltip","data-tooltip":"Data fim"},ct=["onUpdate:modelValue","onFocusout"],pt=["onFocusout"],ft={class:"print-hide"},mt=["onClick"],gt={__name:"edit",setup(C){const{agenda:$,lista:v}=G(),o=ee({}),b={formatISOToInput(d){if(!d)return"";const r=new Date(d),a=s=>s.toString().padStart(2,"0");return d.length>10?`${r.getFullYear()}-${a(r.getMonth()+1)}-${a(r.getDate())}T${a(r.getHours())}:${a(r.getMinutes())}`:`${r.getFullYear()}-${a(r.getMonth()+1)}-${a(r.getDate())}`}},p={grouped:V(()=>{const d=v.titles||[],r=($.eventsFiltered||[]).reduce((s,c)=>{const g=c.summary||c.title||"";return s[g]||(s[g]=[]),s[g].push({...c,startEvent:b.formatISOToInput(c.start?.dateTime||c.start?.date),endEvent:b.formatISOToInput(c.end?.dateTime||c.end?.date)}),s},{}),a={};return d.forEach(s=>{r[s]&&(a[s]=r[s])}),Object.keys(r).forEach(s=>{a[s]||(a[s]=r[s])}),a}),_debouncers:{},handleEdit(d,r,a){if(a!==(d[r]||"")){const s=`${d.id}_${r}`;o[d.id]=!0,this._debouncers[s]||(this._debouncers[s]=oe((c,g,h)=>{const u={summary:g==="summary"?h:c.summary,location:g==="location"?h:c.location,description:g==="description"?h:c.description,start:c.start,end:c.end},n=c.calendarId;$.updateGoogleEvent(n,c.id,u).then(()=>{o[c.id]=!1}).catch(f=>{o[c.id]=!1,console.warn("Erro ao editar evento:",f)})},3e3)),this._debouncers[s](d,r,a)}},updateDate(d,r,a){if(b.formatISOToInput(d.start?.dateTime||d.start?.date)!==a){o[d.id]=!0;let c=d.start,g=d.end;const h=Intl.DateTimeFormat().resolvedOptions().timeZone;if(r==="startEvent"){const n=new Date(a),f=new Date(n.getTime()+7200*1e3);f.setMinutes(0,0,0),c={...c,dateTime:n.toISOString(),timeZone:h},g={...g,dateTime:f.toISOString(),timeZone:h}}else if(r==="endEvent"){const n=new Date(a);g={...g,dateTime:n.toISOString(),timeZone:h}}const u={summary:d.summary,location:d.location,description:d.description,start:c,end:g};$.updateGoogleEvent(d.calendarId,d.id,u).then(n=>{o[d.id]=!1,console.log("Evento atualizado com sucesso:",n)}).catch(n=>{o[d.id]=!1,console.warn("Erro ao editar data do evento:",n)})}},openEventLink(d){d&&window.open(d,"_blank")},handleDelete(d){confirm("Tem certeza que deseja excluir este evento?")&&(o[d.id]=!0,$.deleteGoogleEvent(d.calendarId,d.id).then(()=>{o[d.id]=!1}).catch(r=>{o[d.id]=!1,console.warn("Erro ao excluir evento:",r)}))}},D=ee({});function k(){Object.values(p.grouped.value).flat().forEach(r=>{D[r.id]?D[r.id].getHTML()!==(r.description||"")&&D[r.id].commands.setContent(r.description||"",!1):D[r.id]=new ye({content:`${r.description||""}`.trim().replace(/[\n\r]/g,`
<br />`),extensions:[be],editorProps:{attributes:{class:"focus:outline-none min-h-[60px] p-2"}},onUpdate:({editor:a})=>{console.log("Atualizando::: ",a.getHTML()),p.handleEdit(r,"description",a.getHTML())}})})}N(()=>p.grouped.value,()=>{me(()=>{k()})},{immediate:!0,deep:!0});function E(d){const r=D[d.id];if(!r)return;const a=r.getHTML();p.handleEdit(d,"description",a)}const _=p.grouped;return(d,r)=>{const a=rt;return y(),w("div",null,[(y(!0),w(Y,null,j(m(_),(s,c)=>(y(),w("div",{key:c,class:"table-container"},[t("table",null,[t("thead",null,[t("tr",null,[t("th",lt,x(c||"(sem título)"),1)])]),t("tbody",null,[R(a,{"initial-title":c},null,8,["initial-title"]),(y(!0),w(Y,null,j(s,g=>(y(),w("tr",{key:g.id,onDblclick:h=>p.openEventLink(g.htmlLink)},[t("td",null,[g.recurringEventId?(y(),w("i",dt)):T("",!0)]),t("td",ut,[I(t("input",{"onUpdate:modelValue":h=>g.startEvent=h,type:"datetime-local",class:F([{updating:o[g.id]},"date-clean"]),onFocusout:h=>p.updateDate(g,"startEvent",h.target.value)},null,42,ct),[[S,g.startEvent]])]),t("td",{contenteditable:"true",class:F(["tooltip",{updating:o[g.id]}]),"data-tooltip":"Local",onFocusout:h=>p.handleEdit(g,"location",h.target.innerText.trim())},x(g.location||""),43,pt),t("td",{class:F(["tooltip",{updating:o[g.id]}]),"data-tooltip":"Descrição"},[R(m(ve),{editor:D[g.id],onBlur:h=>E(g)},null,8,["editor","onBlur"])],2),t("td",ft,[t("button",{title:"Excluir evento",class:"btn-clean",style:{"font-size":"1.3rem",color:"#e74c3c"},onClick:h=>p.handleDelete(g)},r[0]||(r[0]=[t("i",{class:"las la-trash-alt"},null,-1)]),8,mt)])],40,it))),128))])])]))),128))])}}},vt=B(gt,[["__scopeId","data-v-e5148350"]]),yt={class:"border shadow",style:{width:"100%"}},bt={key:0,style:{padding:"1rem",background:"#fff","border-radius":"0 0 0.5rem 0.5rem"}},$t=["value"],Dt={style:{display:"block","margin-top":"0.25rem","font-size":"0.85em",color:"#6b7280"}},wt={__name:"recurrence",props:{rrule:{type:String,default:""},data:{type:Object,default:()=>({})},recurrence:{type:String,default:""}},emits:["update:rrule","update:recurrence"],setup(C,{emit:$}){const v=O(!1),o=C,b=$,p=O(o.rrule||""),D=O("");N(()=>o.rrule,d=>{p.value=d||""});const k=V(()=>{if(!o.data?.date)return null;const d=new Date(o.data.date);return isNaN(d.getTime())?null:d});function E(d){p.value=d.target.value,b("update:rrule",p.value),_()}function _(){D.value="";const d=p.value?.toUpperCase()||"",r=/^(\d+)([DSMA])$/.exec(d);if(!o.data||!k.value){D.value="Data inválida.",b("update:recurrence","");return}if(!r){D.value="Expressão de recorrência inválida. Use [número][D/S/M/A]",b("update:recurrence","");return}const a=+r[1],c={D:"DAILY",S:"WEEKLY",M:"MONTHLY",A:"YEARLY"}[r[2]];if(!c||a<=0){D.value="Tipo ou intervalo inválido.",b("update:recurrence","");return}const g=k.value,u=["SU","MO","TU","WE","TH","FR","SA"][g.getDay()];if(c==="WEEKLY")b("update:recurrence",`RRULE:FREQ=${c};INTERVAL=${a};BYDAY=${u}`);else if(c==="MONTHLY"){let n=Math.floor((g.getDate()-1)/7)+1;const f=new Date(g);f.setDate(g.getDate()+7),f.getMonth()!==g.getMonth()&&(n=-1);const M=(n===-1?"-1":n)+u;b("update:recurrence",`RRULE:FREQ=${c};INTERVAL=${a};BYDAY=${M}`)}else if(c==="YEARLY"){const n=g.getMonth()+1,f=g.getDate();let M=Math.floor((f-1)/7)+1;const J=new Date(g);J.setDate(f+7),J.getMonth()!==g.getMonth()&&(M=-1);const H=(M===-1?"-1":M)+u;b("update:recurrence",`RRULE:FREQ=YEARLY;INTERVAL=${a};BYMONTH=${n};BYDAY=${H}`)}else b("update:recurrence",`RRULE:FREQ=${c};INTERVAL=${a}`)}return N(()=>o.data?.date,_,{immediate:!0}),(d,r)=>(y(),w("div",yt,[t("button",{type:"button",style:{display:"flex","align-items":"center",width:"100%",padding:"1rem","text-align":"left",color:"#374151",background:"none",border:"none",cursor:"pointer"},onClick:r[0]||(r[0]=a=>v.value=!v.value)},[r[1]||(r[1]=t("i",{class:"la la-tools"},null,-1)),r[2]||(r[2]=t("span",{style:{"margin-left":"0.5rem"}},"Outras opções",-1)),t("i",{class:"la la-angle-double-down",style:ge([{"margin-left":"auto",transition:"transform 0.2s"},{transform:v.value?"rotate(180deg)":""}])},null,4)]),v.value?(y(),w("div",bt,[r[3]||(r[3]=t("label",{for:"rrule-input",style:{display:"block","font-size":"0.95em","font-weight":"500",color:"#374151","margin-bottom":"0.25rem"}},"Recorrência",-1)),t("input",{id:"rrule-input",value:p.value,type:"text",style:{width:"100%",border:"1px solid #d1d5db","border-radius":"0.375rem",padding:"0.5rem 0.75rem","font-size":"0.95em"},placeholder:"Ex: 2S para cada 2 semanas ou 1M para cada mês",autocomplete:"off",onInput:E},null,40,$t),t("small",Dt,x(D.value)+" "+x(C.recurrence),1)])):T("",!0)]))}},kt={class:"form-group"},ht=["value"],It={class:"form-group"},Et={class:"form-group"},St={class:"form-group"},Tt={class:"row"},_t={class:"form-group"},xt={class:"row"},At={class:"form-group",style:{flex:"1 1 100%"}},Ot={class:"form-group",style:{flex:"1 1 100%"}},Ct={__name:"create",setup(C){const{$toast:$}=te(),{lista:v,agenda:o}=G(),b=ne(),p=l=>String(l).padStart(2,"0");function D(l){return(l||"").toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim()}function k(l,e,i=4){if(!e)return l.slice(0,i);const A=D(e);return l.filter(L=>e!==L).filter(L=>A.split(" ").every(z=>D(L).includes(z))).slice(0,i)}function E(l){if(!l)return"";const e=new Date(l);return`${e.getFullYear()}-${p(e.getMonth()+1)}-${p(e.getDate())}T${p(e.getHours())}:${p(e.getMinutes())}`}function _(){const l=new Date,e=new Date;e.setDate(l.getDate()+70);const i=new Date(l);return i.setHours(19,0,0,0),{today:E(i),future:E(e)}}const{today:d}=_(),r=d,a=ee({calendarId:"",date:"",end:"",title:"",locale:b.query?.locale||"",desc:"",recurrence:""});N(()=>a.date,l=>{if(!l)return;const e=new Date(l),i=e.getMinutes()===0?2:1.5;a.end=E(new Date(e.getTime()+i*36e5))}),a.date=b.query?.date||r,de(()=>{const l=o.calendars.filter(e=>o.filters.calendarIDs.includes(e.id));l.length===1&&(a.calendarId=l[0].id)});const s=v.titles,c=v.locales,g=v.desc,h=V(()=>k(s,a.title,3)),u=V(()=>k(c,a.locale,3)),n=V(()=>{if(!a.desc)return[];const l=a.desc.trim().split(/\s+/),e=l.slice(-2).join(" "),i=l.slice(-1).join(" "),A=new Set([...k(g,e),...k(g,i)]);return Array.from(A).slice(0,3)});function f(l,e){e&&(a[l]=e)}function M(l,e){e&&e.length>0&&(a[l]=e[0])}function J(){}async function H(){if(!a.calendarId||!o.calendars.some(l=>l.id===a.calendarId)){alert("Selecione um calendário válido.");return}if(a.date&&a.title&&a.locale){const l={...a};try{const e=new Date(l.date);if(isNaN(e.getTime())){alert("Data inválida.");return}const i=new Date(l.end||e.getTime()+7200*1e3);if(isNaN(e.getTime())){alert("Data inválida.");return}if(i<e){alert("A data de término não pode ser anterior à data de início.");return}const A=Intl.DateTimeFormat().resolvedOptions().timeZone,L=e.toISOString(),z=i.toISOString(),K={summary:l.title,location:l.locale,description:l.desc,start:{dateTime:L,timeZone:A},end:{dateTime:z,timeZone:A}};l.recurrence&&(K.recurrence=[l.recurrence]);const W=await o.createGoogleEvent(l.calendarId,K);$.success(W.summary+" criado com sucesso: "+W.description),a.date=r,a.locale="",a.desc="",a.rrule="",a.recurring=""}catch(e){$.error("Erro ao criar evento: "+(e?.message||e)),console.log("Erro ao criar evento: ",e)}}else alert("Por favor, preencha todos os campos obrigatórios.")}return(l,e)=>(y(),w("div",null,[t("form",{class:"form-inline",onSubmit:X(H,["prevent"])},[t("div",kt,[e[15]||(e[15]=t("label",{for:"calendar"},"Calendário:",-1)),I(t("select",{id:"calendar","onUpdate:modelValue":e[0]||(e[0]=i=>a.calendarId=i),required:""},[(y(!0),w(Y,null,j(m(o).calendars.filter(i=>m(o).filters.calendarIDs.includes(i.id)),i=>(y(),w("option",{key:i.id,value:i.id},x(i.summary),9,ht))),128))],512),[[ie,a.calendarId]])]),t("div",It,[e[16]||(e[16]=t("label",{for:"date"},"Data:",-1)),I(t("input",{id:"date","onUpdate:modelValue":e[1]||(e[1]=i=>a.date=i),type:"datetime-local",required:""},null,512),[[S,a.date]])]),t("div",Et,[e[17]||(e[17]=t("label",{for:"end"},"Fim:",-1)),I(t("input",{id:"end","onUpdate:modelValue":e[2]||(e[2]=i=>a.end=i),type:"datetime-local",required:""},null,512),[[S,a.end]])]),t("div",St,[e[18]||(e[18]=t("label",{for:"title"},"Título:",-1)),t("div",Tt,[I(t("input",{id:"title","onUpdate:modelValue":e[3]||(e[3]=i=>a.title=i),type:"text",placeholder:"Digite para buscar...",autocomplete:"off",onKeydown:[e[4]||(e[4]=q(X(i=>M("title",h.value),["prevent"]),["enter"])),e[5]||(e[5]=q(i=>void 0,["tab"]))]},null,544),[[S,a.title]]),a.title.length>0&&h.value.length?(y(),U(P,{key:0,suggestions:h.value,onSelect:e[6]||(e[6]=i=>f("title",i))},null,8,["suggestions"])):T("",!0)])]),t("div",_t,[e[19]||(e[19]=t("label",{for:"locale"},"Local:",-1)),t("div",xt,[I(t("input",{id:"locale","onUpdate:modelValue":e[7]||(e[7]=i=>a.locale=i),type:"text",placeholder:"Digite para buscar...",autocomplete:"off",onKeydown:[e[8]||(e[8]=q(X(i=>M("locale",u.value),["prevent"]),["enter"])),e[9]||(e[9]=q(i=>void 0,["tab"]))]},null,544),[[S,a.locale]]),a.locale.length>0&&u.value.length?(y(),U(P,{key:0,suggestions:u.value,onSelect:e[10]||(e[10]=i=>f("locale",i))},null,8,["suggestions"])):T("",!0)])]),t("div",At,[e[20]||(e[20]=t("label",{for:"desc",style:{display:"flex","align-items":"center",gap:"0.5rem"}},[t("span",{class:"tooltip","data-tooltip":"!nodate para não mostrar a data e hora. "},[Z(" Descrição: "),t("i",{class:"la la-info-circle",style:{color:"#2563eb",cursor:"pointer"}})])],-1)),I(t("textarea",{id:"desc","onUpdate:modelValue":e[11]||(e[11]=i=>a.desc=i),rows:"4"},null,512),[[S,a.desc]]),a.desc.length>0&&n.value.length?(y(),U(P,{key:0,suggestions:n.value,onSelect:e[12]||(e[12]=i=>f("desc",i))},null,8,["suggestions"])):T("",!0)]),t("div",Ot,[e[21]||(e[21]=t("label",null,null,-1)),R(wt,{rrule:a.rrule,"onUpdate:rrule":e[13]||(e[13]=i=>a.rrule=i),recurrence:a.recurrence,"onUpdate:recurrence":e[14]||(e[14]=i=>a.recurrence=i),msg:m(v).msg,data:a},null,8,["rrule","recurrence","msg","data"])]),e[22]||(e[22]=t("div",{class:"form-group",style:{flex:"1 1 100%","text-align":"right"}},[t("label"),t("button",{type:"submit",class:"success",style:{width:"100%","max-width":"200px"}}," Adicionar ")],-1))],32)]))}},Mt={class:"print-hide"},Lt={class:"tabs-container print-hide"},Ft={class:"tabs justify-end","aria-label":"Tabs",role:"tablist","aria-orientation":"horizontal"},Rt=["aria-selected"],Ut=["aria-selected"],Nt=["aria-selected"],zt={class:"tab-content"},Vt={id:"tab-content-filters",role:"tabpanel"},qt={key:0,id:"tab-content-create",role:"tabpanel"},Yt={id:"tab-content-git",role:"tabpanel"},Ht={__name:"eventos",setup(C){const{auth:$}=G(),v=O("filters");function o(b){v.value=b}return(b,p)=>{const D=we;return y(),w("div",null,[t("div",Mt,[t("div",Lt,[t("nav",Ft,[I(t("span",{id:"tab-create","aria-selected":v.value==="git",role:"tab",type:"button",class:F(["tab",{active:v.value==="git"}]),onClick:p[0]||(p[0]=k=>o("git"))},p[3]||(p[3]=[t("i",{class:"la la-git"},null,-1)]),10,Rt),[[Q,m($).user.token]]),I(t("span",{id:"tab-create","aria-selected":v.value==="create",role:"tab",type:"button",class:F(["tab",{active:v.value==="create"}]),onClick:p[1]||(p[1]=k=>o("create"))},p[4]||(p[4]=[t("i",{class:"la la-plus"},null,-1)]),10,Ut),[[Q,m($).user.token]]),t("span",{id:"tab-filters","aria-selected":v.value==="filters",role:"tab",type:"button",class:F(["tab",{active:v.value==="filters"}]),onClick:p[2]||(p[2]=k=>o("filters"))},p[5]||(p[5]=[t("i",{class:"la la-filter icon"},null,-1)]),10,Nt)])]),t("div",zt,[I(t("div",Vt,[R(Qe)],512),[[Q,v.value==="filters"]]),v.value==="create"?(y(),w("div",qt,[R(Ct)])):T("",!0),I(t("div",Yt,[R(D)],512),[[Q,v.value==="git"]])])]),m($).user.token?(y(),U(vt,{key:0})):T("",!0)])}}};export{Ht as default};
