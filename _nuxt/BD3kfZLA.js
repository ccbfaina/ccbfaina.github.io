import{L as ot}from"./DbEtIfB4.js";import{_ as rt,r as k,z as q,f as it,j as m,i as $,A as ut,c as r,B as dt,F as y,a as e,t as d,s as h,x as u,k as f,v as w,C as D,n as g,I,e as V,g as ct,R as O,Y as pt,q as vt,o as a,E as G,m as N,G as U}from"#entry";import{d as H}from"./D0Dr7phT.js";const ft={class:"tabs-container print-hide"},bt={class:"tabs justify-end","aria-label":"Tabs",role:"tablist","aria-orientation":"horizontal"},mt=["aria-selected"],yt={class:"badge"},gt=["aria-selected"],_t={class:"badge"},kt=["aria-selected"],ht={class:"tab-content"},wt={id:"tab-content-lista",role:"tabpanel"},Ct={class:"text-center"},St={key:0},At={key:1},Dt={key:2},Tt={key:3},Lt={key:4},xt={id:"tab-content-filters",role:"tabpanel"},$t={class:"content"},Vt={class:"form-inline"},Ot={class:"form-group"},Et={class:"row"},jt={class:"form-group"},zt={class:"row"},Bt=["value"],Mt={class:"form-group"},Rt={class:"row"},Ft=["value"],qt={class:"form-group"},It={class:"row gap-xs"},Gt={class:"form-group",style:{"text-align":"right"}},Nt=["disabled"],Ut={class:"form-inline",style:{gap:"1rem","margin-top":"1rem"}},Ht={id:"tab-content-print",role:"tabpanel"},Pt={class:"a4 print-hide"},Wt={class:"settings-list"},Yt={class:"settings-list"},Jt=["onClick"],Kt={key:0,class:"print-page print-layout"},Qt={class:"table-wrapper"},Xt={colspan:"5",class:"text-center",style:{"text-transform":"uppercase"}},Zt=["onDblclick"],te={key:0,class:"nowrap"},ee={key:0},se=["innerHTML"],le={key:0,class:"print-page print-layout"},ne={class:"table-wrapper"},ae={colspan:"5",class:"text-center",style:{"text-transform":"uppercase"}},oe=["onDblclick"],re={key:0,class:"nowrap"},ie={key:0},ue=["innerHTML"],de={__name:"calendar",setup(ce){pt(n=>({v34c10dce:C.value}));const P=ct(),W=vt(),c=k("lista"),_=k(!1),C=k(1),s=q({search:"",title:"",locale:"",date:"",start:"",end:"",calendars:[]}),{$indexedDB:Y}=it(),b=k([]),p=q({}),E=k([]),j=m(()=>({fontSize:`${C.value}rem`})),z=n=>n?.replace(/-$/,"").trim(),T=n=>{if(!n)return"";const t=n.split("T")[0];return t?t.split("-").reverse().join("/"):""},B=(n,t)=>Array.from(new Set(n.map(o=>o[t]).filter(o=>typeof o=="string"&&o.trim()))),J=m(()=>B(b.value,"title")),K=m(()=>B(b.value,"locale")),Q=()=>{const n=P.query||{};["search","title","locale","date","start","end"].forEach(v=>{n[v]!==void 0&&(s[v]=n[v])}),n.calendars&&(s.calendars=Array.isArray(n.calendars)?n.calendars:n.calendars.split(",").filter(Boolean));const{today:o,future:l}=O();s.start||(s.start=o),s.end||(s.end=l)},M=H(()=>{const n=Object.fromEntries(Object.entries(s).filter(([t,o])=>t==="calendars"?o.length:o!==""&&o!=null).map(([t,o])=>Array.isArray(o)?[t,o.join(",")]:[t,o]));W.replace({query:n})},200),X=H(async()=>{_.value=!0;try{const{data:n}=await Y.getEvents(s)||{},{events:t}=n||{};b.value=t||[];const o=Array.from(new Set(b.value.map(l=>l.title||"Sem título")));E.value=o}catch(n){console.error("Error fetching calendar events:",n)}finally{_.value=!1}},400),Z=()=>{M()};$(s,M,{deep:!0}),$(()=>s,()=>{s.start&&X()},{immediate:!0,deep:!0});function S(n){if(n==="calendars")s.calendars=[];else if(n==="date"){s.date="";const{today:t,future:o}=O();s.start=t,s.end=o}else if(n==="start"||n==="end"){const{today:t,future:o}=O();s.start=t,s.end=o}else s[n]=""}const tt=m(()=>{let n=0;return s.search&&n++,s.title&&n++,s.locale&&n++,s.date&&n++,s.calendars&&s.calendars.length>0&&n++,n}),et=()=>{c.value="lista",setTimeout(()=>{window.print()},1e3)},A=m(()=>{if(!b.value||!b.value.length)return[];const n=b.value.filter(o=>!["AVISOS À IRMANDADE","NOVOS SERVOS PARA O MINISTÉRIO"].includes(o.title)),t=new Map;for(const o of n||[]){if(!o.date)continue;const l=new Date(o.date),v=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}`,i=l.toLocaleDateString("pt-BR",{month:"long",year:"numeric"});t.has(v)||t.set(v,{month:i,items:[]}),t.get(v).items.push(o)}return Array.from(t.entries()).sort(([o],[l])=>o.localeCompare(l)).map(([o,{month:l,items:v}])=>({month:l,items:v.slice().sort((i,x)=>i.onDate-x.onDate)}))}),L=m(()=>{const n={};return b.value.forEach(t=>{const o=t.title||"Sem título";(n[o]||=[]).push(t)}),Object.keys(n).map(t=>({title:t}))}),st=()=>{if(!L.value)return;const n=L.value.map(t=>t.title);n.forEach(t=>{t in p||(p[t]=!0)});for(const t in p)n.includes(t)||(p[t]=!1)};ut(()=>{Q()}),$(L,st,{immediate:!0});const lt=n=>{c.value="print",p[n]=!p[n]},R=m(()=>Object.values(p).length>0&&Object.values(p).every(Boolean)),nt=n=>{for(const t in p)p[t]=n},at=m(()=>Object.values(p).filter(Boolean).length),F=n=>{const t=`https://www.google.com/calendar/event?eid=${n.htmlLink}`;window.open(t,"_blank")};return(n,t)=>{const o=ot;return a(),r("div",null,[_.value?(a(),dt(o,{key:0})):(a(),r(y,{key:1},[e("div",ft,[e("nav",bt,[e("span",{id:"tab-filters","aria-selected":c.value==="filters",role:"tab",type:"button",class:h(["tab",{active:c.value==="filters"}]),style:{position:"relative"},onClick:t[0]||(t[0]=l=>c.value="filters")},[e("span",yt,u(tt.value),1),t[15]||(t[15]=e("i",{class:"la la-filter z-10"},null,-1))],10,mt),e("span",{id:"tab-print","aria-selected":c.value==="print",role:"tab",type:"button",class:h(["tab",{active:c.value==="print"}]),onClick:t[1]||(t[1]=l=>c.value="print")},[e("span",_t,u(at.value),1),t[16]||(t[16]=e("i",{class:"la la-print"},null,-1))],10,gt),e("span",{id:"tab-lista","aria-selected":c.value==="lista",role:"tab",type:"button",class:h(["tab",{active:c.value==="lista"}]),onClick:t[2]||(t[2]=l=>c.value="lista")}," Calendário ",10,kt)])]),e("div",ht,[f(e("div",wt,[e("div",Ct,[t[17]||(t[17]=e("div",null,"CALENDÁRIO",-1)),s.calendars.length?(a(),r("div",St,[e("b",null,u(s.calendars.map(z).join(", ")),1)])):d("",!0),s.locale?(a(),r("span",At,[e("b",null,u(z(s.locale)),1)])):d("",!0),s.date?(a(),r("span",Dt," Data: "+u(T(s.date)),1)):d("",!0),!s.date&&(s.start||s.end)?(a(),r("div",Tt," Período: "+u(T(s.start))+" à "+u(T(s.end)),1)):d("",!0),s.search?(a(),r("div",Lt,u(s.search),1)):d("",!0)])],512),[[w,c.value==="lista"]]),f(e("div",xt,[e("div",$t,[e("div",Vt,[e("div",null,[e("div",Ot,[t[18]||(t[18]=e("label",{for:"search"},"Pesquisar",-1)),e("div",Et,[f(e("input",{id:"search","onUpdate:modelValue":t[3]||(t[3]=l=>s.search=l),type:"text",placeholder:"Buscar itens..."},null,512),[[D,s.search]]),s.search?(a(),r("button",{key:0,class:"btn-clear","aria-label":"Limpar pesquisa",type:"button",onClick:t[4]||(t[4]=l=>S("search"))}," × ")):d("",!0)])]),e("div",jt,[t[20]||(t[20]=e("label",{for:"title"},"Título",-1)),e("div",zt,[f(e("select",{id:"title","onUpdate:modelValue":t[5]||(t[5]=l=>s.title=l)},[t[19]||(t[19]=e("option",{value:""},"Todos os títulos",-1)),(a(!0),r(y,null,g(J.value,l=>(a(),r("option",{key:l,value:l},u(l),9,Bt))),128))],512),[[I,s.title]]),s.title?(a(),r("button",{key:0,class:"btn-clear","aria-label":"Limpar título",type:"button",onClick:t[6]||(t[6]=l=>S("title"))}," × ")):d("",!0)])]),e("div",Mt,[t[22]||(t[22]=e("label",{for:"locale"},"Local",-1)),e("div",Rt,[f(e("select",{id:"locale","onUpdate:modelValue":t[7]||(t[7]=l=>s.locale=l)},[t[21]||(t[21]=e("option",{value:""},"Todos os locais",-1)),(a(!0),r(y,null,g(K.value,l=>(a(),r("option",{key:l,value:l},u(l),9,Ft))),128))],512),[[I,s.locale]]),s.locale?(a(),r("button",{key:0,class:"btn-clear","aria-label":"Limpar local",type:"button",onClick:t[8]||(t[8]=l=>S("locale"))}," × ")):d("",!0)])]),e("div",qt,[t[23]||(t[23]=e("label",null,"Entre",-1)),e("div",It,[f(e("input",{"onUpdate:modelValue":t[9]||(t[9]=l=>s.start=l),type:"date"},null,512),[[D,s.start]]),f(e("input",{"onUpdate:modelValue":t[10]||(t[10]=l=>s.end=l),type:"date"},null,512),[[D,s.end]]),s.start||s.end?(a(),r("button",{key:0,class:"btn-clear","aria-label":"Limpar datas",type:"button",onClick:t[11]||(t[11]=l=>S("date"))}," × ")):d("",!0)])])]),e("div",null,[e("div",Gt,[t[24]||(t[24]=e("label",null,null,-1)),e("button",{class:"success",disabled:_.value,onClick:t[12]||(t[12]=l=>Z())},u(_.value?"Atualizando...":"Aplicar"),9,Nt)])])]),e("div",Ut,[e("span",null,[t[25]||(t[25]=e("i",{class:"la la-tasks"},null,-1)),V(" "+u(Array.isArray(b.value)?b.value.length:0),1)])])])],512),[[w,c.value==="filters"]]),f(e("div",Ht,[e("div",{class:"text-center flex col items-center gap-4"},[t[27]||(t[27]=e("b",{class:"mb-4 p"},"Ajustes de impressão:",-1)),e("div",{class:"p"},[e("button",{class:"success",onClick:et},[...t[26]||(t[26]=[e("i",{class:"la la-print"},null,-1),V(" Imprimir ",-1)])])])]),e("div",Pt,[e("div",Wt,[t[28]||(t[28]=e("b",null,"Tamanho da Fonte",-1)),f(e("input",{type:"range","onUpdate:modelValue":t[13]||(t[13]=l=>C.value=l),min:"0.8",max:"1.6",step:"0.1"},null,512),[[D,C.value]])]),e("div",Yt,[t[29]||(t[29]=e("b",null,"Lista",-1)),e("div",null,[e("i",{class:h(["la",R.value?"la-toggle-on":"la-toggle-off"]),title:"Ocultar todos",onClick:t[14]||(t[14]=l=>nt(!R.value))},null,2)])]),(a(!0),r(y,null,g(E.value,l=>(a(),r("div",{key:l,class:"settings-list print-hide",onClick:v=>lt(l)},[V(u(l)+" ",1),e("i",{class:h(["la",p[l]?"la-toggle-on":"la-toggle-off"]),title:"Alterar visibilidade"},null,2)],8,Jt))),128))])],512),[[w,c.value==="print"]]),A.value.length?(a(),r("div",Kt,[(a(!0),r(y,null,g(A.value,({month:l,items:v})=>(a(),r("div",{key:l,class:"month-section"},[e("div",Qt,[e("table",{style:G(j.value)},[e("thead",null,[e("tr",null,[e("th",Xt,u(l),1)])]),e("tbody",null,[(a(!0),r(y,null,g(v,i=>f((a(),r("tr",{key:i.id,onDblclick:x=>F(i)},[e("td",null,[i.formatDate?(a(),r("span",te,u(i.formatDate.split("/")[0])+" | "+u(i.formatWeek),1)):d("",!0)]),e("td",null,[i.formatTime?(a(),r("span",ee,u(i.formatTime),1)):d("",!0)]),e("td",null,u(i.locale),1),e("td",null,u(i.title),1),e("td",null,[i.desc?(a(),r("span",{key:0,innerHTML:N(U)(i.desc)},null,8,se)):d("",!0)])],40,Zt)),[[w,p[i.title||"Sem título"]]])),128))])],4)])]))),128))])):d("",!0)]),A.value.length?(a(),r("div",le,[(a(!0),r(y,null,g(A.value,({month:l,items:v})=>(a(),r("div",{key:l,class:"month-section"},[e("div",ne,[e("table",{style:G(j.value)},[e("thead",null,[e("tr",null,[e("th",ae,u(l),1)])]),e("tbody",null,[(a(!0),r(y,null,g(v,i=>f((a(),r("tr",{key:i.id,onDblclick:x=>F(i)},[e("td",null,[i.formatDate?(a(),r("span",re,u(i.formatDate.split("/")[0])+" | "+u(i.formatWeek),1)):d("",!0)]),e("td",null,[i.formatTime?(a(),r("span",ie,u(i.formatTime),1)):d("",!0)]),e("td",null,u(i.locale),1),e("td",null,u(i.title),1),e("td",null,[i.desc?(a(),r("span",{key:0,innerHTML:N(U)(i.desc)},null,8,ue)):d("",!0)])],40,oe)),[[w,p[i.title||"Sem título"]]])),128))])],4)])]))),128))])):d("",!0)],64))])}}},be=rt(de,[["__scopeId","data-v-66a164bb"]]);export{be as default};
