import{_ as H,r as C,A as re,i as z,c as h,t as x,o as y,k,a as t,C as T,y as ie,J as fe,f as Q,m as g,b as U,B as N,K as me,w as ge,s as F,x as A,T as ve,L as de,g as le,q as ye,u as Z,I as ue,F as j,n as G,e as ee,z as ae,M as ce,h as P,j as q,l as B,N as te,O as be,E as $e,v as X}from"#entry";import{d as ne}from"./D0Dr7phT.js";import{E as De,a as we,S as Ee}from"./DBqtv4qv.js";const he={key:0,class:"space-y-4 max-w-md mx-auto"},ke={__name:"EventosGit",setup(M,{expose:f}){const v=C(""),a=C(""),b=C(""),m=C(!1);re(()=>{const E=localStorage.getItem("git_config");if(E)try{const n=JSON.parse(atob(E));v.value=n.token||"",a.value=n.repoOwner||"",b.value=n.repoName||""}catch(n){console.log("Erro::: ",n)}m.value=!0}),z([v,a,b],()=>{const E={token:v.value,repoOwner:a.value,repoName:b.value};localStorage.setItem("git_config",btoa(JSON.stringify(E)))},{deep:!0});const D=()=>({Authorization:`Bearer ${v.value}`,"Content-Type":"application/json; charset=UTF-8",Accept:"application/vnd.github.v3+json"}),$=async E=>{const n=`https://api.github.com/repos/${a.value}/${b.value}/contents/${E}`,{data:o,error:d}=await ie(n,{method:"GET",headers:D(),pick:["content","sha"],watch:!1},"$9xe66jx9KU");if(d.value)throw new Error(`Erro ao buscar: ${d.value.data?.message||d.value.message}`);return{content:Buffer.from(o.value.content,"base64").toString("utf-8"),sha:o.value.sha}},I=async(E,n)=>{console.log("Solicitacao de atualizacao:: ",E,n);const o=`https://api.github.com/repos/${a.value}/${b.value}/contents/${n}`,d=D();let s=null;try{const l=await $(n);if(l.content===E)return console.info("GIT: Conteúdo idêntico."),!1;s=l.sha}catch(l){if(!l.message.includes("404"))throw l;console.log("GIT: Arquivo será criado.")}const u={message:s?"Atualização via Nuxt":"Criação via Nuxt",content:Buffer.from(E,"utf-8").toString("base64"),...s&&{sha:s}},{error:w}=await ie(o,{method:"PUT",headers:d,body:u,watch:!1},"$aH25C_JKj4");if(w.value)throw new Error(`Erro ao enviar: ${w.value.data?.message||w.value.message}`);return console.log("GIT: Enviado com sucesso!"),!0},S=async()=>{await I(`# Atualizado em ${new Date().toISOString()}`,"README.md")};return f({getFile:$,pushFile:I}),(E,n)=>m.value?(y(),h("div",he,[k(t("input",{"onUpdate:modelValue":n[0]||(n[0]=o=>v.value=o),type:"password",placeholder:"Token",class:"input"},null,512),[[T,v.value]]),k(t("input",{"onUpdate:modelValue":n[1]||(n[1]=o=>a.value=o),placeholder:"Owner",class:"input"},null,512),[[T,a.value]]),k(t("input",{"onUpdate:modelValue":n[2]||(n[2]=o=>b.value=o),placeholder:"Repo",class:"input"},null,512),[[T,b.value]]),t("button",{class:"btn",onClick:S},"Sync")])):x("",!0)}},Ie=H(ke,[["__scopeId","data-v-adc87aea"]]),Se={class:"container"},_e={key:0},Te={class:"dropdown-content"},xe={class:"dropdown-avatar-container"},Ae={class:"countdown"},Oe={key:1},se=!1,Ce={__name:"EventosAuth",setup(M){const f=fe(),{$toast:v}=Q(),a=C(!1),b=C(!1),m=C(!1);function D(){a.value=!a.value}function $(){a.value=!1}async function I(){const o=()=>v.success("Conectando"),d=s=>v.error("Erro ao conectar: "+s);try{await v.promise(f.signIn({callback:o,errorCallback:d}),{pending:"Conectando...",success:"Janela de solicitação aberta!",error:"Erro ao conectar."})}catch(s){console.error("Erro ao fazer login:",s),d(s)}}async function S(){try{const o=()=>{v.success("Até logo!",{duration:2e3,position:"top-right"}),$()},d=s=>v.error("Erro ao desconectar: "+s);await f.signOut(o,d)}catch(o){v.error("Erro ao fazer logout: "+o)}}const E=o=>o>0?[o/3600,o%3600/60,o%60].map(d=>String(Math.floor(d)).padStart(2,"0")).join(":"):"00:00:00",n=me({props:{src:{type:String,default:""},alt:{type:String,default:""},fallback:{type:String,default:""},hovered:Boolean,size:{type:Number,default:2.5},border:{type:String,default:"#d1d5db"}},setup(o){const d=C(!1);return()=>d.value?de("div",{class:"avatar-fallback",style:{width:`${o.size}rem`,height:`${o.size}rem`,borderRadius:"9999px",border:`2px solid ${o.border}`,display:"flex",alignItems:"center",justifyContent:"center",background:"#e5e7eb",color:"#111827",fontSize:o.size===4?"2rem":"1.25rem",fontWeight:600,transition:"border-color 0.2s"},class:{"avatar-hovered":o.hovered}},o.fallback):de("img",{src:o.src,alt:o.alt,class:"avatar",style:{width:`${o.size}rem`,height:`${o.size}rem`,borderRadius:"9999px",border:`2px solid ${o.border}`,transition:"border-color 0.2s"},class:{"avatar-hovered":o.hovered},onError:()=>d.value=!0})}});return(o,d)=>(y(),h("div",Se,[g(f).user.token?(y(),h("div",_e,[t("div",{class:"avatar-container",onClick:D,onMouseover:d[0]||(d[0]=s=>b.value=!0),onMouseleave:d[1]||(d[1]=s=>b.value=!1)},[(y(),N(g(n),{key:g(f).user.picture,src:g(f).user.picture,alt:g(f).user.name,fallback:g(f).user.name.charAt(0).toUpperCase(),hovered:b.value,size:2.5},null,8,["src","alt","fallback","hovered"]))],32),U(ve,{name:"fade"},{default:ge(()=>[a.value?(y(),h("div",{key:0,class:F(["dropdown",{"dropdown-dark":se}])},[t("div",Te,[t("div",xe,[(y(),N(g(n),{key:g(f).user.picture,src:g(f).user.picture,alt:g(f).user.name,fallback:g(f).user.name.charAt(0).toUpperCase(),size:4,border:"#3b82f6"},null,8,["src","alt","fallback"]))]),t("div",{class:F(["user-name",{"user-name-dark":se}])},A(g(f).user.name),3),t("div",{class:F(["user-email",{"user-email-dark":se}])},A(g(f).user.email),3),t("button",{class:F(["signout-button",{"signout-button-hovered":m.value}]),onClick:S,onMouseover:d[2]||(d[2]=s=>m.value=!0),onMouseleave:d[3]||(d[3]=s=>m.value=!1)},[d[4]||(d[4]=t("span",null,"Sair",-1)),t("span",Ae,A(E(g(f).user.expires_countdown)),1)],34)])],2)):x("",!0)]),_:1}),a.value?(y(),h("div",{key:0,class:"overlay",onClick:$})):x("",!0)])):(y(),h("div",Oe,[t("button",{class:"gsi-material-button",type:"button",onClick:I},[...d[5]||(d[5]=[t("div",{class:"gsi-material-button-state"},null,-1),t("div",{class:"gsi-material-button-content-wrapper"},[t("div",{class:"gsi-material-button-icon"}),t("span",{class:"gsi-material-button-contents"},"Entrar com Google")],-1)])])]))]))}},Me=H(Ce,[["__scopeId","data-v-b7b5bccb"]]),Le={class:"form-inline"},Fe={class:"form-group"},Re={class:"row"},Ue={class:"form-group"},Ne={class:"row"},ze={class:"form-group"},Ve={class:"row"},qe=["value"],Ye={class:"form-group"},Be={class:"flex gap-xs"},je={class:"form-group"},Ge={class:"flex gap-xs"},He={class:"form-group",style:{"align-items":"flex-start"}},Ke={class:"chips-container"},We=["onClick"],Pe={key:0,class:"las la-toggle-on"},Je={key:1,class:"las la-toggle-off"},Qe={class:"form-group",style:{"text-align":"right"}},Ze=["disabled"],Xe={class:"form-inline",style:{gap:"1rem","margin-top":"1rem"}},et={__name:"EventosFiltersAgenda",setup(M){const f=le(),v=ye(),{agenda:a,auth:b}=Z(),{$toast:m}=Q(),D=C(!1),$={formatISOToInput(l){if(!l)return"";const r=new Date(l);return l.length>10?r.toISOString().slice(0,16):r.toISOString().slice(0,10)},getDefaultDates(){const l=new Date,r=new Date;return r.setDate(l.getDate()+70),{today:this.formatISOToInput(l),future:this.formatISOToInput(r)}},getFriendlyErrorMessage(l){const r=l?.result?.error?.message||l?.message||l?.toString()||"";return r.includes("Request is missing required authentication credential")?"Sua sessão expirou. Por favor, faça login novamente para acessar os eventos.":`Erro (${l?.result?.error?.code||""}) ao carregar eventos: ${r}`},sleep(l){return new Promise(r=>setTimeout(r,l))}},{today:I,future:S}=$.getDefaultDates();(()=>{const l=f.query||{};if(l.calendar){const r=Array.isArray(l.calendar)?l.calendar:l.calendar.split(",").filter(Boolean);a.filters.calendarIDs=r}else a.filters.calendarIDs=[];a.filters.title=l.title||"",a.filters.locale=l.locale||"",a.filters.search=l.search||"",a.filters.date=l.date||"",a.filters.start=l.start||I,a.filters.end=l.end||S})();const n=ne(()=>{const l=Object.fromEntries(Object.entries(a.filters).filter(([r,p])=>r==="calendarIDs"?Array.isArray(p)&&p.length>0:p!==""&&p!==null&&p!==void 0).map(([r,p])=>r==="calendarIDs"&&Array.isArray(p)?["calendar",p.join(",")]:[r,p]));v.replace({query:{...l}})},300);function o(l){a.filters[l]="",l==="date"&&(a.filters.start=$.formatISOToInput(I),a.filters.end=$.formatISOToInput(S)),l==="calendarIDs"&&(a.filters.calendarIDs=[]),n()}async function d(){try{if(window&&!window?.gapi?.client?.calendar){m.error("Google Calendar API não está disponível. Faça login ou aguarde o carregamento.");return}await $.sleep(200),await m.promise(a.fetchGoogleCalendars(),{pending:"Carregando eventos...",success:"Eventos carregados com sucesso!",error:{render({data:l}){return $.getFriendlyErrorMessage(l)}}})}catch(l){m.error($.getFriendlyErrorMessage(l)),console.error(`Erro (${l.result?.error?.code}) ao carregar eventos: ${l.result?.error?.message}`,l)}finally{D.value=!1}}async function s(){await a.fetchGoogleEvents()}function u(l){a.filters.calendarIDs.includes(l)?a.filters.calendarIDs=a.filters.calendarIDs.filter(r=>r!==l):a.filters.calendarIDs.push(l)}const w=ne(async()=>{try{D.value=!0,await a.awaitGapi(),await d(),await s()}catch{m.error("Google Calendar API não foi carregada. Tente recarregar a página ou aguarde.")}finally{D.value=!1}},400);return z(()=>b.user.token,async l=>{l&&w()},{immediate:!0}),re(()=>{w()}),z(()=>({...a.filters}),()=>{n()},{deep:!0}),(l,r)=>(y(),h("div",null,[U(Me,{style:{"margin-bottom":"8px"}}),t("div",Le,[t("div",null,[t("div",Fe,[r[10]||(r[10]=t("label",{for:"search",class:"text-sm font-medium text-gray-700 mb-1"},"Pesquisar",-1)),t("div",Re,[k(t("input",{id:"search","onUpdate:modelValue":r[0]||(r[0]=p=>g(a).filters.search=p),type:"text",placeholder:"Buscar eventos..."},null,512),[[T,g(a).filters.search]]),g(a).filters.search?(y(),h("button",{key:0,"aria-label":"Limpar pesquisa",type:"button",onClick:r[1]||(r[1]=p=>o("search"))}," × ")):x("",!0)])]),t("div",Ue,[r[11]||(r[11]=t("label",{for:"title",class:"text-sm font-medium text-gray-700 mb-1"},"Título",-1)),t("div",Ne,[k(t("input",{id:"title","onUpdate:modelValue":r[2]||(r[2]=p=>g(a).filters.title=p),type:"text",placeholder:"Filtrar por título..."},null,512),[[T,g(a).filters.title]]),g(a).filters.title?(y(),h("button",{key:0,"aria-label":"Limpar título",type:"button",onClick:r[3]||(r[3]=p=>o("title"))}," × ")):x("",!0)])]),t("div",ze,[r[13]||(r[13]=t("label",{for:"locale",class:"text-sm font-medium text-gray-700 mb-1"},"Local",-1)),t("div",Ve,[k(t("select",{id:"locale","onUpdate:modelValue":r[4]||(r[4]=p=>g(a).filters.locale=p)},[r[12]||(r[12]=t("option",{value:""},"Todos os locais",-1)),(y(!0),h(j,null,G(g(a).eventsLocales,p=>(y(),h("option",{key:p,value:p},A(p),9,qe))),128))],512),[[ue,g(a).filters.locale]]),g(a).filters.locale?(y(),h("button",{key:0,"aria-label":"Limpar local",type:"button",onClick:r[5]||(r[5]=p=>o("locale"))}," × ")):x("",!0)])]),t("div",Ye,[r[14]||(r[14]=t("label",{for:"date",class:"text-sm font-medium text-gray-700 mb-1"},"Data",-1)),t("div",Be,[k(t("input",{id:"date","onUpdate:modelValue":r[6]||(r[6]=p=>g(a).filters.date=p),type:"date"},null,512),[[T,g(a).filters.date]]),g(a).filters.date?(y(),h("button",{key:0,"aria-label":"Limpar data",type:"button",onClick:r[7]||(r[7]=p=>o("date"))}," × ")):x("",!0)])]),t("div",je,[r[15]||(r[15]=t("label",null,"Intervalo de Datas",-1)),t("div",Ge,[k(t("input",{id:"datepicker-range-start","onUpdate:modelValue":r[8]||(r[8]=p=>g(a).filters.start=p),type:"date"},null,512),[[T,g(a).filters.start]]),k(t("input",{id:"datepicker-range-end","onUpdate:modelValue":r[9]||(r[9]=p=>g(a).filters.end=p),type:"date"},null,512),[[T,g(a).filters.end]])])])]),t("div",null,[t("div",He,[r[16]||(r[16]=t("label",null,"Agendas",-1)),t("div",Ke,[(y(!0),h(j,null,G(g(a).calendars,p=>(y(),h("span",{key:p.id,class:F(["chip",{"chip-disabled":!g(a).filters.calendarIDs.includes(p.id)}]),onClick:_=>u(p.id)},[g(a).filters.calendarIDs.includes(p.id)?(y(),h("i",Pe)):(y(),h("i",Je)),ee(" "+A(p.summary),1)],10,We))),128))])]),t("div",Qe,[r[17]||(r[17]=t("label",null,null,-1)),t("button",{class:"success",disabled:g(D)||g(a).loading,onClick:s},A(g(D)||g(a).loading?"Atualizando...":"Aplicar"),9,Ze)])])]),t("div",Xe,[t("span",null,[r[18]||(r[18]=t("i",{class:"la la-calendar-check"},null,-1)),ee(" "+A(g(a)?.calendars?.length),1)]),t("span",null,[r[19]||(r[19]=t("i",{class:"la la-tasks"},null,-1)),ee(" "+A(g(a).eventsFiltered?.length),1)])])]))}},tt=H(et,[["__scopeId","data-v-d4b88a2f"]]),at={class:"suggestion-container"},ot=["onClick"],st={__name:"EventosSuggestion",props:{suggestions:{type:Array,required:!0}},emits:["select"],setup(M,{emit:f}){const v=f,a=m=>typeof m=="string"?m:JSON.stringify(m),b=m=>{v("select",m)};return(m,D)=>(y(),h("ul",at,[(y(!0),h(j,null,G(M.suggestions,$=>(y(),h("li",{key:a($),class:"suggestion-item",onClick:I=>b($)},A($),9,ot))),128))]))}},J=H(st,[["__scopeId","data-v-b2c7e18e"]]),nt={key:0},rt={colspan:"2"},lt={class:"col"},it={class:"col"},dt={__name:"EventosAddEventRow",props:{initialTitle:{type:String,default:""},initialLocale:{type:String,default:""},initialDesc:{type:String,default:""},initialDate:{type:String,default:""}},async setup(M){let f,v;const a=M,{$toast:b,$indexedDB:m}=Q(),{agenda:D}=Z(),$=le(),I=i=>String(i).padStart(2,"0");function S(i){return(i||"").toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim()}function E(i,e,c=4){if(!e)return i.slice(0,c);const O=S(e);return i.filter(L=>e!==L).filter(L=>O.split(" ").every(V=>S(L).includes(V))).slice(0,c)}function n(i){if(!i)return"";const e=new Date(i);return`${e.getFullYear()}-${I(e.getMonth()+1)}-${I(e.getDate())}T${I(e.getHours())}:${I(e.getMinutes())}`}function o(){const i=new Date,e=new Date(i);return e.setHours(19,0,0,0),{today:n(e)}}const{today:d}=o(),s=d,u=ae({calendarId:"",date:"",end:"",title:"",locale:"",desc:"",recurrence:"",rrule:""});function w(){u.date=a.initialDate||$.query?.date||s,u.title=(a.initialTitle||$.query?.title||"").trim(),u.locale=(a.initialLocale||$.query?.locale||"").trim(),u.desc=(a.initialDesc||$.query?.desc||"").trim(),u.recurrence="",u.rrule="",u.end=""}re(()=>{w()}),z(()=>u.date,i=>{if(!i)return;const e=new Date(i),c=e.getMinutes()===0?2:1.5;u.end=n(new Date(e.getTime()+c*36e5))}),ce(()=>{const i=D.calendars.filter(e=>D.filters.calendarIDs.includes(e.id));i.length===1&&(u.calendarId=i[0].id)});const l=([f,v]=P(()=>m.getLocales()),f=await f,v(),f||[]),r=([f,v]=P(()=>m.getDesc()),f=await f,v(),f||[]),p=q(()=>E(l,u.locale,3)),_=q(()=>{if(!u.desc)return[];const i=u.desc.trim().split(/\s+/),e=i.slice(-2).join(" "),c=i.slice(-1).join(" "),O=new Set([...E(r,e),...E(r,c)]);return Array.from(O).slice(0,3)});function R(i,e){e&&(u[i]=e)}function Y(i,e){e&&e.length>0&&(u[i]=e[0])}function pe(){}async function oe(){if(!u.calendarId||!D.calendars.some(i=>i.id===u.calendarId)){alert("Selecione um calendário válido.");return}if(u.date&&u.title&&u.locale){const i={...u};try{const e=new Date(i.date);if(isNaN(e.getTime())){alert("Data inválida.");return}const c=new Date(i.end||e.getTime()+7200*1e3);if(isNaN(c.getTime())){alert("Data de término inválida.");return}if(c<e){alert("A data de término não pode ser anterior à data de início.");return}const O=Intl.DateTimeFormat().resolvedOptions().timeZone,L=e.toISOString(),V=c.toISOString(),K={summary:i.title,location:i.locale,description:i.desc,start:{dateTime:L,timeZone:O},end:{dateTime:V,timeZone:O}};i.recurrence&&(K.recurrence=[i.recurrence]);const W=await D.createGoogleEvent(i.calendarId,K);b.success(W.summary+" criado com sucesso: "+W.description),w()}catch(e){b.error("Erro ao criar evento: "+(e?.message||e)),console.log("Erro ao criar evento: ",e)}}else console.warn("Campos obrigatórios não preenchidos:",u),b.error("Por favor, preencha todos os campos obrigatórios."),alert("Por favor, preencha todos os campos obrigatórios.")}return(i,e)=>g(D).filters.calendarIDs.length===1?(y(),h("tr",nt,[t("td",rt,[e[7]||(e[7]=t("label",{for:"date",class:"sr-only"},"Data Início:",-1)),k(t("input",{"onUpdate:modelValue":e[0]||(e[0]=c=>u.date=c),type:"datetime-local",required:"",class:"form-control"},null,512),[[T,u.date]])]),t("td",null,[e[8]||(e[8]=t("label",{for:"locale",class:"sr-only"},"Local:",-1)),t("div",lt,[k(t("input",{"onUpdate:modelValue":e[1]||(e[1]=c=>u.locale=c),class:"form-control",type:"text",placeholder:"Local...",autocomplete:"off",onKeydown:[e[2]||(e[2]=B(te(c=>Y("locale",p.value),["prevent"]),["enter"])),e[3]||(e[3]=B(c=>void 0,["tab"]))]},null,544),[[T,u.locale]]),u.locale.length>0&&p.value.length?(y(),N(J,{key:0,suggestions:p.value,onSelect:e[4]||(e[4]=c=>R("locale",c))},null,8,["suggestions"])):x("",!0)])]),t("td",null,[t("div",it,[e[9]||(e[9]=t("label",{for:"desc",class:"sr-only"},"Descrição:",-1)),k(t("input",{"onUpdate:modelValue":e[5]||(e[5]=c=>u.desc=c),placeholder:"Descrição...",class:"form-control"},null,512),[[T,u.desc]]),u.desc.length>0&&_.value.length?(y(),N(J,{key:0,suggestions:_.value,onSelect:e[6]||(e[6]=c=>R("desc",c))},null,8,["suggestions"])):x("",!0)])]),t("td",null,[t("button",{title:"Adicionar evento",class:"btn-clean",style:{"font-size":"1.3rem",color:"#07bc0c"},onClick:oe},[...e[10]||(e[10]=[t("i",{class:"las la-save"},null,-1)])])])])):x("",!0)}},ut=H(dt,[["__scopeId","data-v-b4f5934c"]]),ct={colspan:"8"},pt=["onDblclick"],ft={key:0,class:"la la-redo-alt print-hide",style:{color:"#9e9e9e"}},mt={class:"tooltip","data-tooltip":"Data fim"},gt=["onUpdate:modelValue","onFocusout"],vt=["onFocusout"],yt={class:"print-hide"},bt=["onClick"],$t={__name:"EventosEdit",setup(M){const{agenda:f}=Z(),{$indexedDB:v}=Q(),a=ae({}),b={formatISOToInput(n){if(!n)return"";const o=new Date(n),d=s=>s.toString().padStart(2,"0");return n.length>10?`${o.getFullYear()}-${d(o.getMonth()+1)}-${d(o.getDate())}T${d(o.getHours())}:${d(o.getMinutes())}`:`${o.getFullYear()}-${d(o.getMonth()+1)}-${d(o.getDate())}`}};let m=[];v.getTitles().then(n=>{m=n});const D={grouped:q(()=>{const n=(f.eventsFiltered||[]).reduce((d,s)=>{const u=s.summary||s.title||"";return d[u]||(d[u]=[]),d[u].push({...s,startEvent:b.formatISOToInput(s.start?.dateTime||s.start?.date),endEvent:b.formatISOToInput(s.end?.dateTime||s.end?.date)}),d},{}),o={};return m.forEach(d=>{n[d]&&(o[d]=n[d])}),Object.keys(n).forEach(d=>{o[d]||(o[d]=n[d])}),o}),_debouncers:{},handleEdit(n,o,d){if(d!==(n[o]||"")){const s=`${n.id}_${o}`;a[n.id]=!0,this._debouncers[s]||(this._debouncers[s]=ne((u,w,l)=>{const r={summary:w==="summary"?l:u.summary,location:w==="location"?l:u.location,description:w==="description"?l:u.description,start:u.start,end:u.end},p=u.calendarId;f.updateGoogleEvent(p,u.id,r).then(()=>{a[u.id]=!1}).catch(_=>{a[u.id]=!1,console.warn("Erro ao editar evento:",_)})},3e3)),this._debouncers[s](n,o,d)}},updateDate(n,o,d){if(b.formatISOToInput(n.start?.dateTime||n.start?.date)!==d){a[n.id]=!0;let u=n.start,w=n.end;const l=Intl.DateTimeFormat().resolvedOptions().timeZone;if(o==="startEvent"){const p=new Date(d),_=new Date(p.getTime()+7200*1e3);_.setMinutes(0,0,0),u={...u,dateTime:p.toISOString(),timeZone:l},w={...w,dateTime:_.toISOString(),timeZone:l}}else if(o==="endEvent"){const p=new Date(d);w={...w,dateTime:p.toISOString(),timeZone:l}}const r={summary:n.summary,location:n.location,description:n.description,start:u,end:w};f.updateGoogleEvent(n.calendarId,n.id,r).then(p=>{a[n.id]=!1,console.log("Evento atualizado com sucesso:",p)}).catch(p=>{a[n.id]=!1,console.warn("Erro ao editar data do evento:",p)})}},openEventLink(n){n&&window.open(n,"_blank")},handleDelete(n){confirm("Tem certeza que deseja excluir este evento?")&&(a[n.id]=!0,f.deleteGoogleEvent(n.calendarId,n.id).then(()=>{a[n.id]=!1}).catch(o=>{a[n.id]=!1,console.warn("Erro ao excluir evento:",o)}))}},$=ae({});function I(){Object.values(D.grouped.value).flat().forEach(o=>{$[o.id]?$[o.id].getHTML()!==(o.description||"")&&$[o.id].commands.setContent(o.description||"",!1):$[o.id]=new we({content:`${o.description||""}`.trim().replace(/[\n\r]/g,`
<br />`),extensions:[Ee],editorProps:{attributes:{class:"focus:outline-none min-h-[60px] p-2"}},onUpdate:({editor:d})=>{console.log("Atualizando::: ",d.getHTML()),D.handleEdit(o,"description",d.getHTML())}})})}z(()=>D.grouped.value,()=>{be(()=>{I()})},{immediate:!0,deep:!0});function S(n){const o=$[n.id];if(!o)return;const d=o.getHTML();D.handleEdit(n,"description",d)}const E=D.grouped;return(n,o)=>{const d=ut;return y(),h("div",null,[(y(!0),h(j,null,G(g(E),(s,u)=>(y(),h("div",{key:u,class:"table-container"},[t("table",null,[t("thead",null,[t("tr",null,[t("th",ct,A(u||"(sem título)"),1)])]),t("tbody",null,[U(d,{"initial-title":u},null,8,["initial-title"]),(y(!0),h(j,null,G(s,w=>(y(),h("tr",{key:w.id,onDblclick:l=>D.openEventLink(w.htmlLink)},[t("td",null,[w.recurringEventId?(y(),h("i",ft)):x("",!0)]),t("td",mt,[k(t("input",{"onUpdate:modelValue":l=>w.startEvent=l,type:"datetime-local",class:F([{updating:a[w.id]},"date-clean"]),onFocusout:l=>D.updateDate(w,"startEvent",l.target.value)},null,42,gt),[[T,w.startEvent]])]),t("td",{contenteditable:"true",class:F(["tooltip",{updating:a[w.id]}]),"data-tooltip":"Local",onFocusout:l=>D.handleEdit(w,"location",l.target.innerText.trim())},A(w.location||""),43,vt),t("td",{class:F(["tooltip",{updating:a[w.id]}]),"data-tooltip":"Descrição"},[U(g(De),{editor:$[w.id],onBlur:l=>S(w)},null,8,["editor","onBlur"])],2),t("td",yt,[t("button",{title:"Excluir evento",class:"btn-clean",style:{"font-size":"1.3rem",color:"#e74c3c"},onClick:l=>D.handleDelete(w)},[...o[0]||(o[0]=[t("i",{class:"las la-trash-alt"},null,-1)])],8,bt)])],40,pt))),128))])])]))),128))])}}},Dt=H($t,[["__scopeId","data-v-ca13347a"]]),wt={class:"border shadow",style:{width:"100%"}},Et={key:0,style:{padding:"1rem",background:"#fff","border-radius":"0 0 0.5rem 0.5rem"}},ht=["value"],kt={style:{display:"block","margin-top":"0.25rem","font-size":"0.85em",color:"#6b7280"}},It={__name:"EventosRecurrence",props:{rrule:{type:String,default:""},data:{type:Object,default:()=>({})},recurrence:{type:String,default:""}},emits:["update:rrule","update:recurrence"],setup(M,{emit:f}){const v=C(!1),a=M,b=f,m=C(a.rrule||""),D=C("");z(()=>a.rrule,E=>{m.value=E||""});const $=q(()=>{if(!a.data?.date)return null;const E=new Date(a.data.date);return isNaN(E.getTime())?null:E});function I(E){m.value=E.target.value,b("update:rrule",m.value),S()}function S(){D.value="";const E=m.value?.toUpperCase()||"",n=/^(\d+)([DSMA])$/.exec(E);if(!a.data||!$.value){D.value="Data inválida.",b("update:recurrence","");return}if(!n){D.value="Expressão de recorrência inválida. Use [número][D/S/M/A]",b("update:recurrence","");return}const o=+n[1],s={D:"DAILY",S:"WEEKLY",M:"MONTHLY",A:"YEARLY"}[n[2]];if(!s||o<=0){D.value="Tipo ou intervalo inválido.",b("update:recurrence","");return}const u=$.value,l=["SU","MO","TU","WE","TH","FR","SA"][u.getDay()];if(s==="WEEKLY")b("update:recurrence",`RRULE:FREQ=${s};INTERVAL=${o};BYDAY=${l}`);else if(s==="MONTHLY"){let r=Math.floor((u.getDate()-1)/7)+1;const p=new Date(u);p.setDate(u.getDate()+7),p.getMonth()!==u.getMonth()&&(r=-1);const _=(r===-1?"-1":r)+l;b("update:recurrence",`RRULE:FREQ=${s};INTERVAL=${o};BYDAY=${_}`)}else if(s==="YEARLY"){const r=u.getMonth()+1,p=u.getDate();let _=Math.floor((p-1)/7)+1;const R=new Date(u);R.setDate(p+7),R.getMonth()!==u.getMonth()&&(_=-1);const Y=(_===-1?"-1":_)+l;b("update:recurrence",`RRULE:FREQ=YEARLY;INTERVAL=${o};BYMONTH=${r};BYDAY=${Y}`)}else b("update:recurrence",`RRULE:FREQ=${s};INTERVAL=${o}`)}return z(()=>a.data?.date,S,{immediate:!0}),(E,n)=>(y(),h("div",wt,[t("button",{type:"button",style:{display:"flex","align-items":"center",width:"100%",padding:"1rem","text-align":"left",color:"#374151",background:"none",border:"none",cursor:"pointer"},onClick:n[0]||(n[0]=o=>v.value=!v.value)},[n[1]||(n[1]=t("i",{class:"la la-tools"},null,-1)),n[2]||(n[2]=t("span",{style:{"margin-left":"0.5rem"}},"Outras opções",-1)),t("i",{class:"la la-angle-double-down",style:$e([{"margin-left":"auto",transition:"transform 0.2s"},{transform:v.value?"rotate(180deg)":""}])},null,4)]),v.value?(y(),h("div",Et,[n[3]||(n[3]=t("label",{for:"rrule-input",style:{display:"block","font-size":"0.95em","font-weight":"500",color:"#374151","margin-bottom":"0.25rem"}},"Recorrência",-1)),t("input",{id:"rrule-input",value:m.value,type:"text",style:{width:"100%",border:"1px solid #d1d5db","border-radius":"0.375rem",padding:"0.5rem 0.75rem","font-size":"0.95em"},placeholder:"Ex: 2S para cada 2 semanas ou 1M para cada mês",autocomplete:"off",onInput:I},null,40,ht),t("small",kt,A(D.value)+" "+A(M.recurrence),1)])):x("",!0)]))}},St={class:"form-group"},_t=["value"],Tt={class:"form-group"},xt={class:"form-group"},At={class:"form-group"},Ot={class:"row"},Ct={class:"form-group"},Mt={class:"row"},Lt={class:"form-group",style:{flex:"1 1 100%"}},Ft={class:"form-group",style:{flex:"1 1 100%"}},Rt={__name:"EventosCreate",async setup(M){let f,v;const{$toast:a,$indexedDB:b}=Q(),{agenda:m}=Z(),D=le(),$=i=>String(i).padStart(2,"0");function I(i){return(i||"").toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim()}function S(i,e,c=4){if(!e)return i.slice(0,c);const O=I(e);return i.filter(L=>e!==L).filter(L=>O.split(" ").every(V=>I(L).includes(V))).slice(0,c)}function E(i){if(!i)return"";const e=new Date(i);return`${e.getFullYear()}-${$(e.getMonth()+1)}-${$(e.getDate())}T${$(e.getHours())}:${$(e.getMinutes())}`}function n(){const i=new Date,e=new Date;e.setDate(i.getDate()+70);const c=new Date(i);return c.setHours(19,0,0,0),{today:E(c),future:E(e)}}const{today:o}=n(),d=o,s=ae({calendarId:"",date:"",end:"",title:"",locale:D.query?.locale||"",desc:"",recurrence:""});z(()=>s.date,i=>{if(!i)return;const e=new Date(i),c=e.getMinutes()===0?2:1.5;s.end=E(new Date(e.getTime()+c*36e5))}),s.date=D.query?.date||d,ce(()=>{const i=m.calendars.filter(e=>m.filters.calendarIDs.includes(e.id));i.length===1&&(s.calendarId=i[0].id)});const u=([f,v]=P(()=>b.getTitles()),f=await f,v(),f||[]),w=([f,v]=P(()=>b.getLocales()),f=await f,v(),f||[]),l=([f,v]=P(()=>b.getDesc()),f=await f,v(),f||[]),r=q(()=>S(u,s.title,3)),p=q(()=>S(w,s.locale,3)),_=q(()=>{if(!s.desc)return[];const i=s.desc.trim().split(/\s+/),e=i.slice(-2).join(" "),c=i.slice(-1).join(" "),O=new Set([...S(l,e),...S(l,c)]);return Array.from(O).slice(0,3)});function R(i,e){e&&(s[i]=e)}function Y(i,e){e&&e.length>0&&(s[i]=e[0])}function pe(){}async function oe(){if(!s.calendarId||!m.calendars.some(i=>i.id===s.calendarId)){alert("Selecione um calendário válido.");return}if(s.date&&s.title&&s.locale){const i={...s};try{const e=new Date(i.date);if(isNaN(e.getTime())){alert("Data inválida.");return}const c=new Date(i.end||e.getTime()+7200*1e3);if(isNaN(e.getTime())){alert("Data inválida.");return}if(c<e){alert("A data de término não pode ser anterior à data de início.");return}const O=Intl.DateTimeFormat().resolvedOptions().timeZone,L=e.toISOString(),V=c.toISOString(),K={summary:i.title,location:i.locale,description:i.desc,start:{dateTime:L,timeZone:O},end:{dateTime:V,timeZone:O}};i.recurrence&&(K.recurrence=[i.recurrence]);const W=await m.createGoogleEvent(i.calendarId,K);a.success(W.summary+" criado com sucesso: "+W.description),s.date=d,s.locale="",s.desc="",s.rrule="",s.recurring=""}catch(e){a.error("Erro ao criar evento: "+(e?.message||e)),console.log("Erro ao criar evento: ",e)}}else alert("Por favor, preencha todos os campos obrigatórios.")}return(i,e)=>(y(),h("div",null,[t("form",{class:"form-inline",onSubmit:te(oe,["prevent"])},[t("div",St,[e[15]||(e[15]=t("label",{for:"calendar"},"Calendário:",-1)),k(t("select",{id:"calendar","onUpdate:modelValue":e[0]||(e[0]=c=>s.calendarId=c),required:""},[(y(!0),h(j,null,G(g(m).calendars.filter(c=>g(m).filters.calendarIDs.includes(c.id)),c=>(y(),h("option",{key:c.id,value:c.id},A(c.summary),9,_t))),128))],512),[[ue,s.calendarId]])]),t("div",Tt,[e[16]||(e[16]=t("label",{for:"date"},"Data:",-1)),k(t("input",{id:"date","onUpdate:modelValue":e[1]||(e[1]=c=>s.date=c),type:"datetime-local",required:""},null,512),[[T,s.date]])]),t("div",xt,[e[17]||(e[17]=t("label",{for:"end"},"Fim:",-1)),k(t("input",{id:"end","onUpdate:modelValue":e[2]||(e[2]=c=>s.end=c),type:"datetime-local",required:""},null,512),[[T,s.end]])]),t("div",At,[e[18]||(e[18]=t("label",{for:"title"},"Título:",-1)),t("div",Ot,[k(t("input",{id:"title","onUpdate:modelValue":e[3]||(e[3]=c=>s.title=c),type:"text",placeholder:"Digite para buscar...",autocomplete:"off",onKeydown:[e[4]||(e[4]=B(te(c=>Y("title",r.value),["prevent"]),["enter"])),e[5]||(e[5]=B(c=>void 0,["tab"]))]},null,544),[[T,s.title]]),s.title.length>0&&r.value.length?(y(),N(J,{key:0,suggestions:r.value,onSelect:e[6]||(e[6]=c=>R("title",c))},null,8,["suggestions"])):x("",!0)])]),t("div",Ct,[e[19]||(e[19]=t("label",{for:"locale"},"Local:",-1)),t("div",Mt,[k(t("input",{id:"locale","onUpdate:modelValue":e[7]||(e[7]=c=>s.locale=c),type:"text",placeholder:"Digite para buscar...",autocomplete:"off",onKeydown:[e[8]||(e[8]=B(te(c=>Y("locale",p.value),["prevent"]),["enter"])),e[9]||(e[9]=B(c=>void 0,["tab"]))]},null,544),[[T,s.locale]]),s.locale.length>0&&p.value.length?(y(),N(J,{key:0,suggestions:p.value,onSelect:e[10]||(e[10]=c=>R("locale",c))},null,8,["suggestions"])):x("",!0)])]),t("div",Lt,[e[20]||(e[20]=t("label",{for:"desc",style:{display:"flex","align-items":"center",gap:"0.5rem"}},[t("span",{class:"tooltip","data-tooltip":"!nodate para não mostrar a data e hora. "},[ee(" Descrição: "),t("i",{class:"la la-info-circle",style:{color:"#2563eb",cursor:"pointer"}})])],-1)),k(t("textarea",{id:"desc","onUpdate:modelValue":e[11]||(e[11]=c=>s.desc=c),rows:"4"},null,512),[[T,s.desc]]),s.desc.length>0&&_.value.length?(y(),N(J,{key:0,suggestions:_.value,onSelect:e[12]||(e[12]=c=>R("desc",c))},null,8,["suggestions"])):x("",!0)]),t("div",Ft,[e[21]||(e[21]=t("label",null,null,-1)),U(It,{rrule:s.rrule,"onUpdate:rrule":e[13]||(e[13]=c=>s.rrule=c),recurrence:s.recurrence,"onUpdate:recurrence":e[14]||(e[14]=c=>s.recurrence=c),msg:"",data:s},null,8,["rrule","recurrence","data"])]),e[22]||(e[22]=t("div",{class:"form-group",style:{flex:"1 1 100%","text-align":"right"}},[t("label"),t("button",{type:"submit",class:"success",style:{width:"100%","max-width":"200px"}}," Adicionar ")],-1))],32)]))}},Ut={class:"print-hide"},Nt={class:"tabs-container print-hide"},zt={class:"tabs justify-end","aria-label":"Tabs",role:"tablist","aria-orientation":"horizontal"},Vt=["aria-selected"],qt=["aria-selected"],Yt=["aria-selected"],Bt={class:"tab-content"},jt={id:"tab-content-filters",role:"tabpanel"},Gt={key:0,id:"tab-content-create",role:"tabpanel"},Ht={id:"tab-content-git",role:"tabpanel"},Jt={__name:"eventos",setup(M){const{auth:f}=Z(),v=C("filters");function a(b){v.value=b}return(b,m)=>{const D=Ie;return y(),h("div",null,[t("div",Ut,[t("div",Nt,[t("nav",zt,[k(t("span",{id:"tab-create","aria-selected":v.value==="git",role:"tab",type:"button",class:F(["tab",{active:v.value==="git"}]),onClick:m[0]||(m[0]=$=>a("git"))},[...m[3]||(m[3]=[t("i",{class:"la la-git"},null,-1)])],10,Vt),[[X,g(f).user.token]]),k(t("span",{id:"tab-create","aria-selected":v.value==="create",role:"tab",type:"button",class:F(["tab",{active:v.value==="create"}]),onClick:m[1]||(m[1]=$=>a("create"))},[...m[4]||(m[4]=[t("i",{class:"la la-plus"},null,-1)])],10,qt),[[X,g(f).user.token]]),t("span",{id:"tab-filters","aria-selected":v.value==="filters",role:"tab",type:"button",class:F(["tab",{active:v.value==="filters"}]),onClick:m[2]||(m[2]=$=>a("filters"))},[...m[5]||(m[5]=[t("i",{class:"la la-filter icon"},null,-1)])],10,Yt)])]),t("div",Bt,[k(t("div",jt,[U(tt)],512),[[X,v.value==="filters"]]),v.value==="create"?(y(),h("div",Gt,[U(Rt)])):x("",!0),k(t("div",Ht,[U(D)],512),[[X,v.value==="git"]])])]),g(f).user.token?(y(),N(Dt,{key:0})):x("",!0)])}}};export{Jt as default};
