import{L as lt}from"./DbEtIfB4.js";import{_ as at,r as _,z as F,f as nt,j as m,i as D,A as ot,c as r,B as rt,F as y,a as e,s as k,x as i,k as b,t as p,v as A,C as S,n as h,I as M,e as T,g as it,R as V,Y as ut,q as dt,o,E as ct,m as pt,G as vt}from"#entry";import{d as q}from"./D0Dr7phT.js";const ft={class:"tabs-container print-hide"},bt={class:"tabs justify-end","aria-label":"Tabs",role:"tablist","aria-orientation":"horizontal"},mt=["aria-selected"],yt={class:"badge"},gt=["aria-selected"],_t={class:"badge"},kt=["aria-selected"],ht={class:"tab-content"},Ct={id:"tab-content-lista",role:"tabpanel"},wt={class:"text-center"},At={key:0},St={key:1},Lt={key:2},xt={key:3},Dt={key:4},Tt={id:"tab-content-filters",role:"tabpanel"},Vt={class:"content"},$t={class:"form-inline"},Ot={class:"form-group"},Et={class:"row"},jt={class:"form-group"},zt={class:"row"},Bt=["value"],Rt={class:"form-group"},Ft={class:"row"},Mt=["value"],qt={class:"form-group"},It={class:"row gap-xs"},Gt={class:"form-group",style:{"text-align":"right"}},Nt=["disabled"],Ut={class:"form-inline",style:{gap:"1rem","margin-top":"1rem"}},Pt={id:"tab-content-print",role:"tabpanel"},Ht={class:"a4 print-hide"},Yt={class:"settings-list"},Wt={class:"settings-list"},Jt=["onClick"],Kt={key:0,class:"print-page print-layout"},Qt={class:"table-wrapper"},Xt={colspan:"5",class:"text-center",style:{"text-transform":"uppercase"}},Zt=["onDblclick"],te={key:0,class:"nowrap"},ee={key:0},se=["innerHTML"],le={__name:"calendar",setup(ae){ut(l=>({c2c2ab22:C.value}));const I=it(),G=dt(),d=_("lista"),g=_(!1),C=_(1),s=F({search:"",title:"",locale:"",date:"",start:"",end:"",calendars:[]}),{$indexedDB:N}=nt(),f=_([]),c=F({}),$=_([]),U=m(()=>({fontSize:`${C.value}rem`})),O=l=>l?.replace(/-$/,"").trim(),L=l=>{if(!l)return"";const t=l.split("T")[0];return t?t.split("-").reverse().join("/"):""},E=(l,t)=>Array.from(new Set(l.map(n=>n[t]).filter(n=>typeof n=="string"&&n.trim()))),P=m(()=>E(f.value,"title")),H=m(()=>E(f.value,"locale")),Y=()=>{const l=I.query||{};["search","title","locale","date","start","end"].forEach(v=>{l[v]!==void 0&&(s[v]=l[v])}),l.calendars&&(s.calendars=Array.isArray(l.calendars)?l.calendars:l.calendars.split(",").filter(Boolean));const{today:n,future:a}=V();s.start||(s.start=n),s.end||(s.end=a)},j=q(()=>{const l=Object.fromEntries(Object.entries(s).filter(([t,n])=>t==="calendars"?n.length:n!==""&&n!=null).map(([t,n])=>Array.isArray(n)?[t,n.join(",")]:[t,n]));G.replace({query:l})},2e3),W=q(async()=>{g.value=!0;try{const{data:l}=await N.getEvents(s)||{},{events:t}=l||{};f.value=t||[];const n=Array.from(new Set(f.value.map(a=>a.title||"Sem título")));$.value=n}catch(l){console.error("Error fetching calendar events:",l)}finally{g.value=!1}},2e3),J=()=>{j()};D(s,j,{deep:!0}),D(()=>s,()=>{s.start&&W()},{immediate:!0,deep:!0});function w(l){if(l==="calendars")s.calendars=[];else if(l==="date"){s.date="";const{today:t,future:n}=V();s.start=t,s.end=n}else if(l==="start"||l==="end"){const{today:t,future:n}=V();s.start=t,s.end=n}else s[l]=""}const K=m(()=>{let l=0;return s.search&&l++,s.title&&l++,s.locale&&l++,s.date&&l++,s.calendars&&s.calendars.length>0&&l++,l}),Q=()=>{d.value="lista",setTimeout(()=>{window.print()},1e3)},z=m(()=>{if(!f.value||!f.value.length)return[];const l=f.value.filter(n=>!["AVISOS À IRMANDADE","NOVOS SERVOS PARA O MINISTÉRIO"].includes(n.title)),t=new Map;for(const n of l||[]){if(!n.date)continue;const a=new Date(n.date),v=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`,u=a.toLocaleDateString("pt-BR",{month:"long",year:"numeric"});t.has(v)||t.set(v,{month:u,items:[]}),t.get(v).items.push(n)}return Array.from(t.entries()).sort(([n],[a])=>n.localeCompare(a)).map(([n,{month:a,items:v}])=>({month:a,items:v.slice().sort((u,R)=>u.onDate-R.onDate)}))}),x=m(()=>{const l={};return f.value.forEach(t=>{const n=t.title||"Sem título";(l[n]||=[]).push(t)}),Object.keys(l).map(t=>({title:t}))}),X=()=>{if(!x.value)return;const l=x.value.map(t=>t.title);l.forEach(t=>{t in c||(c[t]=!0)});for(const t in c)l.includes(t)||(c[t]=!1)};ot(()=>{Y()}),D(x,X,{immediate:!0});const Z=l=>{d.value="print",c[l]=!c[l]},B=m(()=>Object.values(c).length>0&&Object.values(c).every(Boolean)),tt=l=>{for(const t in c)c[t]=l},et=m(()=>Object.values(c).filter(Boolean).length),st=l=>{const t=`https://www.google.com/calendar/event?eid=${l.htmlLink}`;window.open(t,"_blank")};return(l,t)=>{const n=lt;return o(),r("div",null,[g.value?(o(),rt(n,{key:0})):(o(),r(y,{key:1},[e("div",ft,[e("nav",bt,[e("span",{id:"tab-filters","aria-selected":d.value==="filters",role:"tab",type:"button",class:k(["tab",{active:d.value==="filters"}]),style:{position:"relative"},onClick:t[0]||(t[0]=a=>d.value="filters")},[e("span",yt,i(K.value),1),t[15]||(t[15]=e("i",{class:"la la-filter z-10"},null,-1))],10,mt),e("span",{id:"tab-print","aria-selected":d.value==="print",role:"tab",type:"button",class:k(["tab",{active:d.value==="print"}]),onClick:t[1]||(t[1]=a=>d.value="print")},[e("span",_t,i(et.value),1),t[16]||(t[16]=e("i",{class:"la la-print"},null,-1))],10,gt),e("span",{id:"tab-lista","aria-selected":d.value==="lista",role:"tab",type:"button",class:k(["tab",{active:d.value==="lista"}]),onClick:t[2]||(t[2]=a=>d.value="lista")}," Calendário ",10,kt)])]),e("div",ht,[b(e("div",Ct,[e("div",wt,[t[17]||(t[17]=e("div",null,"CALENDÁRIO",-1)),s.calendars.length?(o(),r("div",At,[e("b",null,i(s.calendars.map(O).join(", ")),1)])):p("",!0),s.locale?(o(),r("span",St,[e("b",null,i(O(s.locale)),1)])):p("",!0),s.date?(o(),r("span",Lt," Data: "+i(L(s.date)),1)):p("",!0),!s.date&&(s.start||s.end)?(o(),r("div",xt," Período: "+i(L(s.start))+" à "+i(L(s.end)),1)):p("",!0),s.search?(o(),r("div",Dt,i(s.search),1)):p("",!0)])],512),[[A,d.value==="lista"]]),b(e("div",Tt,[e("div",Vt,[e("div",$t,[e("div",null,[e("div",Ot,[t[18]||(t[18]=e("label",{for:"search"},"Pesquisar",-1)),e("div",Et,[b(e("input",{id:"search","onUpdate:modelValue":t[3]||(t[3]=a=>s.search=a),type:"text",placeholder:"Buscar itens..."},null,512),[[S,s.search]]),s.search?(o(),r("button",{key:0,class:"btn-clear","aria-label":"Limpar pesquisa",type:"button",onClick:t[4]||(t[4]=a=>w("search"))}," × ")):p("",!0)])]),e("div",jt,[t[20]||(t[20]=e("label",{for:"title"},"Título",-1)),e("div",zt,[b(e("select",{id:"title","onUpdate:modelValue":t[5]||(t[5]=a=>s.title=a)},[t[19]||(t[19]=e("option",{value:""},"Todos os títulos",-1)),(o(!0),r(y,null,h(P.value,a=>(o(),r("option",{key:a,value:a},i(a),9,Bt))),128))],512),[[M,s.title]]),s.title?(o(),r("button",{key:0,class:"btn-clear","aria-label":"Limpar título",type:"button",onClick:t[6]||(t[6]=a=>w("title"))}," × ")):p("",!0)])]),e("div",Rt,[t[22]||(t[22]=e("label",{for:"locale"},"Local",-1)),e("div",Ft,[b(e("select",{id:"locale","onUpdate:modelValue":t[7]||(t[7]=a=>s.locale=a)},[t[21]||(t[21]=e("option",{value:""},"Todos os locais",-1)),(o(!0),r(y,null,h(H.value,a=>(o(),r("option",{key:a,value:a},i(a),9,Mt))),128))],512),[[M,s.locale]]),s.locale?(o(),r("button",{key:0,class:"btn-clear","aria-label":"Limpar local",type:"button",onClick:t[8]||(t[8]=a=>w("locale"))}," × ")):p("",!0)])]),e("div",qt,[t[23]||(t[23]=e("label",null,"Entre",-1)),e("div",It,[b(e("input",{"onUpdate:modelValue":t[9]||(t[9]=a=>s.start=a),type:"date"},null,512),[[S,s.start]]),b(e("input",{"onUpdate:modelValue":t[10]||(t[10]=a=>s.end=a),type:"date"},null,512),[[S,s.end]]),s.start||s.end?(o(),r("button",{key:0,class:"btn-clear","aria-label":"Limpar datas",type:"button",onClick:t[11]||(t[11]=a=>w("date"))}," × ")):p("",!0)])])]),e("div",null,[e("div",Gt,[t[24]||(t[24]=e("label",null,null,-1)),e("button",{class:"success",disabled:g.value,onClick:t[12]||(t[12]=a=>J())},i(g.value?"Atualizando...":"Aplicar"),9,Nt)])])]),e("div",Ut,[e("span",null,[t[25]||(t[25]=e("i",{class:"la la-tasks"},null,-1)),T(" "+i(Array.isArray(f.value)?f.value.length:0),1)])])])],512),[[A,d.value==="filters"]]),b(e("div",Pt,[e("div",{class:"text-center flex col items-center gap-4"},[t[27]||(t[27]=e("b",{class:"mb-4 p"},"Ajustes de impressão:",-1)),e("div",{class:"p"},[e("button",{class:"success",onClick:Q},[...t[26]||(t[26]=[e("i",{class:"la la-print"},null,-1),T(" Imprimir ",-1)])])])]),e("div",Ht,[e("div",Yt,[t[28]||(t[28]=e("b",null,"Tamanho da Fonte",-1)),b(e("input",{type:"range","onUpdate:modelValue":t[13]||(t[13]=a=>C.value=a),min:"0.8",max:"1.6",step:"0.1"},null,512),[[S,C.value]])]),e("div",Wt,[t[29]||(t[29]=e("b",null,"Lista",-1)),e("div",null,[e("i",{class:k(["la",B.value?"la-toggle-on":"la-toggle-off"]),title:"Ocultar todos",onClick:t[14]||(t[14]=a=>tt(!B.value))},null,2)])]),(o(!0),r(y,null,h($.value,a=>(o(),r("div",{key:a,class:"settings-list print-hide",onClick:v=>Z(a)},[T(i(a)+" ",1),e("i",{class:k(["la",c[a]?"la-toggle-on":"la-toggle-off"]),title:"Alterar visibilidade"},null,2)],8,Jt))),128))])],512),[[A,d.value==="print"]]),z.value.length?(o(),r("div",Kt,[(o(!0),r(y,null,h(z.value,({month:a,items:v})=>(o(),r("div",{key:a,class:"month-section"},[e("div",Qt,[e("table",{style:ct(U.value)},[e("thead",null,[e("tr",null,[e("th",Xt,i(a),1)])]),e("tbody",null,[(o(!0),r(y,null,h(v,u=>b((o(),r("tr",{key:u.id,onDblclick:R=>st(u)},[e("td",null,[u.formatDate?(o(),r("span",te,i(u.formatDate.split("/")[0])+" | "+i(u.formatWeek),1)):p("",!0)]),e("td",null,[u.formatTime?(o(),r("span",ee,i(u.formatTime),1)):p("",!0)]),e("td",null,i(u.locale),1),e("td",null,i(u.title),1),e("td",null,[u.desc?(o(),r("span",{key:0,innerHTML:pt(vt)(u.desc)},null,8,se)):p("",!0)])],40,Zt)),[[A,c[u.title||"Sem título"]]])),128))])],4)])]))),128))])):p("",!0)])],64))])}}},ie=at(le,[["__scopeId","data-v-758abe3a"]]);export{ie as default};
