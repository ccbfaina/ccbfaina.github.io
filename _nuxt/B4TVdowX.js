import{L as de}from"./DqqTAazl.js";import{_ as ie,r as C,A as ce,u as ve,o as he,i as fe,j as y,B as w,c as u,k as pe,a as l,t as b,F as m,p as D,f as N,m as be,C as ge,D as Ce,b as r,x as M,y as H,E as A,d as ye,w as me,l as De,G as _e,e as Ge}from"#entry";const ke={key:1,class:"calendar-wrapper"},we={class:"calendar-header"},Me={class:"month-year"},Te={class:"calendar-table"},Se=["onClick"],xe={class:"day-content"},Ee={class:"day-number"},Ne={key:0,class:"event-indicators"},Ae={class:"events-panel"},qe={class:"events-list-container"},Ue={class:"chips-container"},Fe={key:0,class:"las la-toggle-on"},Re={key:1,class:"las la-toggle-off"},$e=["onClick"],Be={key:0,class:"las la-toggle-on"},Ye={key:1,class:"las la-toggle-off"},Le={class:"chips-container"},Ie=["onClick"],Pe={key:0,class:"las la-toggle-on"},ze={key:1,class:"las la-toggle-off"},Oe={class:"search-container"},Xe={key:0},Ve={class:"event-date-title"},Je={class:"events-list"},je={class:"sub-events-list"},He=["innerHTML"],Qe={key:1,class:"no-events-message"},Q=50,Ke={__name:"agenda",setup(We){const g=fe(),q=C(!0),T=new Date,i=C(T.getMonth()),v=C(T.getFullYear()),c=C(null),a=ce({search:"",title:"",locale:"",date:"",start:"",end:"",enabledGroups:[],disabledGroups:[],enabledCalendars:[],disabledCalendars:[]}),{$indexedDB:K}=ve(),k=C([]),U=C([]);he(async()=>{g.query?.regionais==="true"&&a.enabledCalendars.push("REGIONAL FAINA","Regional Goiânia","Regional Uruaçu","Regional Bom Jesus","Regional Catalão"),console.log("Carregando eventos do IndexedDB com filtros:",{...a,calendars:a.enabledCalendars});const{events:e,calendars:s}=await K.getEvents({...a,calendars:a.enabledCalendars});k.value=e.sort((t,n)=>new Date(t.date)-new Date(n.date)),U.value=s});function F(){return[]}const _=y(()=>Array.from(new Set(k.value.map(e=>e.group))).filter(e=>e).sort((e,s)=>e.localeCompare(s)));w(_,e=>{if(!(g.query.groups&&g.query.groups.length>0)&&a.enabledGroups.length===0&&a.disabledGroups.length===0){const s=F(),t=F();s.length>0||t.length>0?(a.enabledGroups=s.filter(n=>e.includes(n)),a.disabledGroups=t.filter(n=>e.includes(n))):(a.enabledGroups=e.filter(n=>n!=="Rodízios"),a.disabledGroups=e.filter(n=>n==="Rodízios"))}},{immediate:!0}),w(U,e=>{g.query.calendars&&g.query.calendars.length>0||a.enabledCalendars.length===0&&a.disabledCalendars.length===0&&(a.enabledCalendars=[...e],a.disabledCalendars=[])},{immediate:!0}),w([()=>a.enabledGroups,()=>a.disabledGroups],()=>{},{deep:!0});const W=y(()=>{const e=[...a.enabledGroups,...a.disabledGroups];return Array.from(new Set(e)).sort((t,n)=>t.localeCompare(n))}),Z=y(()=>{const e=[...a.enabledCalendars,...a.disabledCalendars];return Array.from(new Set(e)).sort((t,n)=>t.localeCompare(n))}),R=y(()=>a.enabledGroups.length===_.value.length);w(()=>k.value,()=>{const e=g.query||{};if(["search","title","locale","date","start","end"].forEach(t=>{e[t]!==void 0&&(a[t]=e[t])}),e.groups){const t=Array.isArray(e.groups)?e.groups:e.groups.split(",").filter(Boolean);a.enabledGroups=t.filter(n=>_.value.includes(n)),a.disabledGroups=_.value.filter(n=>!t.includes(n))}if(e.calendars){const t=Array.isArray(e.calendars)?e.calendars:e.calendars.split(",").filter(Boolean);console.log("Calendários da URL:",t),a.enabledCalendars=t,a.disabledCalendars=[]}q.value=!1},{immediate:!0});function ee(e){a.enabledGroups.includes(e)?(a.enabledGroups=a.enabledGroups.filter(t=>t!==e),a.disabledGroups.push(e)):(a.disabledGroups=a.disabledGroups.filter(t=>t!==e),a.enabledGroups.push(e)),a.enabledGroups.sort((t,n)=>t.localeCompare(n)),a.disabledGroups.sort((t,n)=>t.localeCompare(n))}function te(){R.value?(a.disabledGroups=[..._.value],a.enabledGroups=[]):(a.enabledGroups=[..._.value],a.disabledGroups=[])}function ae(e){a.enabledCalendars.includes(e)?(a.enabledCalendars=a.enabledCalendars.filter(t=>t!==e),a.disabledCalendars.push(e)):(a.disabledCalendars=a.disabledCalendars.filter(t=>t!==e),a.enabledCalendars.push(e)),a.enabledCalendars.sort((t,n)=>t.localeCompare(n)),a.disabledCalendars.sort((t,n)=>t.localeCompare(n))}const S=y(()=>{const e=a.search.trim();let s=Ce(k.value||[],a);if(g.query.next==="true"){const n=new Date;s=s.filter(o=>new Date(o.date)>n)}return s=s.filter(n=>a.enabledGroups.includes(n.group)).filter(n=>a.enabledCalendars.includes(n.list)).filter(n=>!n.noDate),s}),$=y(()=>{let e;if(c.value){const t=c.value.date;e=S.value.filter(n=>{const o=new Date(n.date);return o.getUTCFullYear()===t.getFullYear()&&o.getUTCMonth()===t.getMonth()&&o.getUTCDate()===t.getDate()})}else e=S.value.filter(t=>{const n=new Date(t.date);return n.getUTCFullYear()===v.value&&n.getUTCMonth()===i.value});const s=new Map;for(const t of e){const o=new Date(t.date).toISOString().split("T")[0];s.has(o)||s.set(o,new Map);const h=s.get(o);h.has(t.title)||h.set(t.title,[]),h.get(t.title).push(t)}return Array.from(s.entries()).sort(([t],[n])=>new Date(t)-new Date(n))}),B=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],se=y(()=>`${B[i.value]} ${v.value}`),Y=y(()=>{const e=[],s=new Date(v.value,i.value,1).getDay(),t=new Date(v.value,i.value+1,0).getDate(),n=new Date(v.value,i.value,0).getDate();for(let d=s-1;d>=0;d--)e.push({dayNumber:n-d,date:new Date(v.value,i.value-1,n-d),isPrevMonth:!0,isNextMonth:!1,isToday:!1,hasEvent:!1,events:[]});for(let d=1;d<=t;d++){const p=new Date(v.value,i.value,d),f=S.value.filter(ue=>{const E=new Date(ue.date);return E.getUTCDate()===d&&E.getUTCMonth()===i.value&&E.getUTCFullYear()===v.value});e.push({dayNumber:d,date:p,isPrevMonth:!1,isNextMonth:!1,isToday:p.toDateString()===T.toDateString(),hasEvent:f.length>0,events:f})}const o=42-e.length;for(let d=1;d<=o;d++)e.push({dayNumber:d,date:new Date(v.value,i.value+1,d),isPrevMonth:!1,isNextMonth:!0,isToday:!1,hasEvent:!1,events:[]});const h=[];for(;e.length>0;)h.push(e.splice(0,7));return h});function ne(e){const s=new Date(e),t=s.getUTCDate(),n=B[s.getUTCMonth()],o=s.getUTCFullYear();return`${t} de ${n} de ${o}`}function G(e){i.value+=e,i.value<0?(i.value=11,v.value--):i.value>11&&(i.value=0,v.value++),c.value=null}function le(e){return{"prev-month-day":e.isPrevMonth||e.isNextMonth,today:e.isToday,"has-event":e.hasEvent,"selected-day":c.value&&e.date&&c.value.date&&c.value.date.toDateString()===e.date.toDateString()}}function L(e){e.isPrevMonth?(G(-1),c.value={...e,date:new Date(v.value,i.value,e.dayNumber)}):e.isNextMonth?(G(1),c.value={...e,date:new Date(v.value,i.value,e.dayNumber)}):c.value&&c.value.date.toDateString()===e.date.toDateString()?c.value=null:c.value=e}if(g.query?.data){const e=Y.value[0].find(s=>s.date?.toDateString()===new Date(g.query?.data+" 03:00:00")?.toDateString());e&&L(e)}function oe(e){return c.value?e.some(s=>{const t=new Date(s.date),n=c.value.date;return t.getUTCFullYear()===n.getFullYear()&&t.getUTCMonth()===n.getMonth()&&t.getUTCDate()===n.getDate()}):!1}function re(e){const s=new Set;for(const t of e)t.group&&s.add(t.group);return[...s]}const I=["#d6b8c1","#d1c965","#cdb8d1","#aed4d7","#b3a9a5","#a9c6aa","#d39a8f","#b0a2cc","#d28fa9","#b2d29f","#d1b05e","#84c9cc","#d1be83","#92c2be","#a3b1b5","#bdc75d"],P={Reuniões:"#c4d7b9",Atendimentos:"#b4d0e3",Rodízios:"#e6b97f",Outros:"#c3bfe0"},x=C({});function z(e){if(P[e])return P[e];if(!x.value[e]){const t=Array.from(new Set(k.value.map(n=>n.group).filter(n=>n!==null))).indexOf(e);x.value[e]=I[t%I.length]}return x.value[e]}function O(e){return{backgroundColor:z(e)}}const X=C(0),V=C(0);function J(e){X.value=e.touches?e.touches[0].clientX:e.clientX}function j(e){V.value=e.changedTouches?e.changedTouches[0].clientX:e.clientX;const s=V.value-X.value;s>Q?G(-1):s<-Q&&G(1)}return(e,s)=>{const t=de,n=Ge;return r(),u("div",null,[q.value?(r(),pe(t,{key:0})):(r(),u("div",ke,[l("div",{class:"calendar-panel",onTouchstart:J,onTouchend:j,onMousedown:J,onMouseup:j},[l("div",we,[l("i",{class:"las la-chevron-left",onClick:s[0]||(s[0]=o=>G(-1))}),l("h2",Me,b(se.value),1),l("i",{class:"las la-chevron-right",onClick:s[1]||(s[1]=o=>G(1))})]),l("table",Te,[s[3]||(s[3]=l("thead",null,[l("tr",null,[l("th",null,"Dom"),l("th",null,"Seg"),l("th",null,"Ter"),l("th",null,"Qua"),l("th",null,"Qui"),l("th",null,"Sex"),l("th",null,"Sáb")])],-1)),l("tbody",null,[(r(!0),u(m,null,D(Y.value,(o,h)=>(r(),u("tr",{key:h},[(r(!0),u(m,null,D(o,d=>(r(),u("td",{key:d.date,class:M(le(d)),onClick:p=>L(d)},[l("div",xe,[l("div",Ee,b(d.dayNumber),1),d.events.length?(r(),u("div",Ne,[(r(!0),u(m,null,D(re(d.events),p=>(r(),u("span",{key:p,class:"event-indicator",style:A({backgroundColor:z(p)})},null,4))),128))])):H("",!0)])],10,Se))),128))]))),128))])])],32),l("div",Ae,[l("div",qe,[s[6]||(s[6]=l("small",{style:{opacity:"0.8"}},"Grupos:",-1)),l("div",Ue,[l("span",{class:"chip",onClick:te},[R.value?(r(),u("i",Fe)):(r(),u("i",Re)),s[4]||(s[4]=N(" Todos os Grupos ",-1))]),(r(!0),u(m,null,D(W.value,o=>(r(),u("span",{key:o,class:M(["chip",{"chip-disabled":a.disabledGroups.includes(o)}]),style:A(O(o)),onClick:h=>ee(o)},[a.enabledGroups.includes(o)?(r(),u("i",Be)):(r(),u("i",Ye)),N(" "+b(o),1)],14,$e))),128))]),s[7]||(s[7]=l("small",{style:{opacity:"0.8"}},"Agenda(s):",-1)),l("div",Le,[(r(!0),u(m,null,D(Z.value,o=>(r(),u("span",{key:o,class:M(["chip",{"chip-disabled":a.disabledCalendars.includes(o)}]),onClick:h=>ae(o)},[a.enabledCalendars.includes(o)?(r(),u("i",Pe)):(r(),u("i",ze)),N(" "+b(o),1)],10,Ie))),128))]),l("div",Oe,[be(l("input",{"onUpdate:modelValue":s[2]||(s[2]=o=>a.search=o),type:"text",placeholder:"Buscar eventos...",class:"search-input"},null,512),[[ge,a.search]]),s[5]||(s[5]=l("i",{class:"las la-search search-icon"},null,-1))]),Object.keys($.value).length?(r(),u("div",Xe,[(r(!0),u(m,null,D($.value,([o,h])=>(r(),u("div",{key:o},[l("h4",Ve,b(ne(o)),1),l("ul",Je,[(r(!0),u(m,null,D(h,([d,p])=>(r(),u("li",{key:d,class:M({"selected-event":oe(p)}),style:A(O(p[0].group))},[l("strong",null,b(d),1),l("ul",je,[(r(!0),u(m,null,D(p,f=>(r(),u("li",{key:f.id},[ye(n,{to:{path:"/evento",query:{id:f.id}}},{default:me(()=>[l("p",null,[l("b",null,[l("i",null,b(f.formatTime)+b(f.formatTime?" - ":"")+b(f.formatDate),1)])]),l("p",null,b(f.locale),1),f.desc?(r(),u("p",{key:0,innerHTML:De(_e)(f.desc)},null,8,He)):H("",!0)]),_:2},1032,["to"])]))),128))])],6))),128))])]))),128))])):(r(),u("p",Qe,"Nenhum evento agendado."))])])]))])}}},tt=ie(Ke,[["__scopeId","data-v-14d86aaa"]]);export{tt as default};
