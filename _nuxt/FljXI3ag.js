import{_ as I,f as U,r as v,z,j as M,A as H,i as N,c as d,a as o,k as y,C as k,x as a,t as A,F as G,n as W,I as J,g as K,q as Q,o as c,e as u,m as X,G as Y}from"#entry";import{d as D}from"./D0Dr7phT.js";const Z={class:"page-relatorio"},ee={class:"filters"},oe={class:"form-group"},te={class:"form-group"},se={class:"row gap flex-end",style:{"justify-content":"flex-end","margin-bottom":"1em","align-items":"center"}},ne={style:{color:"#a4a4a4"}},ae=["disabled"],le={class:"table-container"},ie=["onMouseup"],re={class:"cursor"},de={key:0},ce=["innerHTML"],ue={key:0},fe={class:"row space-between"},me={class:"form-group"},pe={class:"row gap-xs text-center flex-end"},ve=["disabled"],be=["disabled"],ge=5e3,he={__name:"relatorio",setup(ye){const{$toast:R,$indexedDB:L}=U(),_=K(),q=Q(),f=v([]),l=v(0),i=v(!1),e=z({nome:"",cidade:"",offset:0,limit:50}),w=v(0),b=s=>{const t=Date.now();return t-w.value>ge?(R.success(s),w.value=t,!0):!1},S=M(()=>Math.floor(e.offset/e.limit)+1),$=M(()=>l.value?Math.ceil(l.value/e.limit):1),g=async()=>{i.value=!0;try{const{data:s,total:t,message:n}=await L.getRelatorio({nome:e.nome,cidade:e.cidade,locale:"",offset:e.offset,limit:e.limit});f.value=s||[],l.value=Number(t)||0,b(n||"RelatÃ³rio carregado com sucesso.")}catch(s){console.error(s),f.value=[],l.value=0}finally{i.value=!1}},T=D(g,300),j=()=>{e.offset=0,m()},E=()=>{e.nome="",e.cidade="",e.offset=0,m()},C=()=>{if(typeof window>"u"||typeof document>"u")return;const s=document.querySelector(".content");s?typeof s.scrollTo=="function"?s.scrollTo({top:0,behavior:"smooth"}):s.scrollTop=0:typeof window.scrollTo=="function"&&window.scrollTo({top:0,behavior:"smooth"})},F=()=>{e.offset=Math.max(0,e.offset-e.limit),m(),C()},O=()=>{e.offset+e.limit<l.value&&(e.offset=e.offset+e.limit,m(),C())},m=D(()=>{const s=Object.fromEntries(Object.entries(e).filter(([,t])=>t!==""&&t!==0&&t!=null).map(([t,n])=>[t,Array.isArray(n)?n.join(","):String(n)]));q.replace({query:s}),T()},400),x=()=>{const s=_.query||{};e.nome=s.search||"",e.offset=s.offset&&parseInt(s.offset,10)||0,e.limit=s.limit&&parseInt(s.limit,10)||50};H(async()=>{x(),await g()}),N(()=>_.query,()=>{x(),g()}),N([()=>[e.nome,e.cidade],()=>e.limit,()=>e.offset],()=>{T()});let h=null;const P=s=>{h=s.currentTarget},V=async(s,t)=>{if(h!==s.currentTarget)return;h=null;const n=window.getSelection(),r=n?n.toString().trim():"";if(r){try{await navigator.clipboard.writeText(r)}catch{const p=document.createElement("textarea");p.value=r,document.body.appendChild(p),p.select(),document.execCommand("copy"),document.body.removeChild(p)}b("Texto copiado para a Ã¡rea de transferÃªncia");return}B(t),b("Abrindo Google Maps")},B=s=>{window.open(`https://www.google.com/maps/search/?api=1&query=CCB CongregaÃ§Ã£o ${s.NomeLocalidade} ${s.NomeCidade} ${s.NomeEstado} ${s.NomePais} ${s.Cep}`,"_blank","noopener noreferrer")};return(s,t)=>(c(),d("div",Z,[o("div",ee,[o("div",oe,[t[3]||(t[3]=o("label",{for:"search"},"MinistÃ©rio",-1)),y(o("input",{id:"search","onUpdate:modelValue":t[0]||(t[0]=n=>e.nome=n),type:"text",placeholder:"Nome"},null,512),[[k,e.nome]])]),o("div",te,[t[4]||(t[4]=o("label",{for:"search"},"Cidade",-1)),y(o("input",{id:"search","onUpdate:modelValue":t[1]||(t[1]=n=>e.cidade=n),type:"text",placeholder:"Cidade"},null,512),[[k,e.cidade]])])]),o("div",se,[o("small",ne,"Total: "+a(l.value),1),o("button",{class:"success",disabled:i.value,onClick:j},a(i.value?"Aguarde...":"Aplicar"),9,ae),o("button",{onClick:E},"Limpar")]),o("div",le,[o("table",null,[t[8]||(t[8]=o("thead",null,[o("tr",null,[o("th",null,"Local"),o("th",null,"Culto"),o("th",null,"MinistÃ©rio")])],-1)),o("tbody",null,[(c(!0),d(G,null,W(f.value,n=>(c(),d("tr",{key:n.Codigo,onMousedown:P,onMouseup:r=>V(r,n)},[o("td",re,[u(" ğŸ“ "+a(n.NomeLocalidade)+" ",1),t[5]||(t[5]=o("br",null,null,-1)),u(" ğŸ™ï¸ "+a(n.NomeCidade)+" ",1),t[6]||(t[6]=o("br",null,null,-1)),u(" ğŸŒ "+a(n.NomeEstado),1)]),o("td",null,[u(a(n.DiasCultosConcatenado)+" ",1),n.DiasCultosConcatenado?(c(),d("br",de)):A("",!0),u(" "+a(n.Observacao),1)]),o("td",null,[o("div",{innerHTML:X(Y)(n.MinisterioConcatenados?.split(";").join("<br>"))},null,8,ce)])],40,ie))),128)),!f.value.length&&!i.value?(c(),d("tr",ue,[...t[7]||(t[7]=[o("td",{colspan:"6"},"Nenhum registro encontrado.",-1)])])):A("",!0)])])]),o("div",fe,[o("div",me,[y(o("select",{"onUpdate:modelValue":t[2]||(t[2]=n=>e.limit=n),style:{"min-width":"100px"}},[...t[9]||(t[9]=[o("option",{value:50},"50",-1),o("option",{value:100},"100",-1),o("option",{value:200},"200",-1)])],512),[[J,e.limit,void 0,{number:!0}]])]),o("div",pe,[o("small",null,"PÃ¡gina: "+a(S.value)+" / "+a($.value),1),o("button",{disabled:e.offset===0,onClick:F},"Anterior",8,ve),o("button",{disabled:e.offset+e.limit>=l.value,onClick:O},"PrÃ³xima",8,be)])])]))}},Te=I(he,[["__scopeId","data-v-7aba455c"]]);export{Te as default};
