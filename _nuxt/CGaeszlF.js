import{L as be}from"./But1cDCZ.js";import{_ as ge}from"./CUpR8154.js";import{_ as ye,f as _e,r as v,z as Z,A as ee,i as F,j as x,R as ke,c as a,B as te,F as y,a as t,s as _,x as u,k as m,v as A,E as B,t as c,C as V,n as D,I as se,e as z,m as le,b as he,g as Ce,S as G,q as De,o,N as L,G as Se}from"./CcehPV9g.js";import{a as $e,S as Te,E as Ee}from"./BS8QdyU_.js";import{d as ne}from"./D0Dr7phT.js";const Le={class:"tabs-container print-hide"},we={class:"tabs justify-end","aria-label":"Tabs",role:"tablist","aria-orientation":"horizontal"},xe=["aria-selected"],Ae={class:"badge"},Ve=["aria-selected"],ze={class:"badge"},qe=["aria-selected"],Oe={class:"tab-content"},je={id:"tab-content-lista",role:"tabpanel"},Fe={key:0},Be={key:1},Ge={key:2},Ie={key:3},Me={id:"tab-content-filters",role:"tabpanel"},Ne={class:"content"},Re={class:"form-inline"},Ue={class:"form-group"},Pe={class:"row"},He={class:"form-group"},We={class:"row"},Ke=["value"],Je={class:"form-group"},Qe={class:"row"},Xe=["value"],Ye={class:"form-group"},Ze={class:"flex gap-xs"},et={class:"form-group",style:{"text-align":"right"}},tt=["disabled"],st={class:"form-inline",style:{gap:"1rem","margin-top":"1rem"}},lt={id:"tab-content-print",role:"tabpanel"},nt={class:"a4 print-hide"},ot={class:"settings-list"},at={id:"fontSteps"},it=["value"],rt={class:"settings-list print-hide"},ut=["onDragstart","onDragover","onDrop","onClick"],dt={key:0,class:"print-page"},ct=["onDragstart","onDragover","onDrop"],vt={colspan:"5"},pt={class:"flex items-center aling-center justify-center"},ft=["onClick"],mt=["onClick","onContextmenu","onMousedown"],bt={key:0},gt={key:0},yt={key:0},_t=["innerHTML"],kt={key:1},ht={__name:"index",setup(Ct){const{$toast:oe,$indexedDB:I}=_e(),S=v([]),d=v("lista"),l=Z({search:"",title:"",locale:"",date:"",start:"",end:"",calendars:[]}),k=v(1),ae=Ce(),M=De(),q=v(!1),ie=()=>{const s=ae.query||{};["search","title","locale","date","start","end"].forEach(n=>{s[n]!==void 0&&(l[n]=s[n])}),s.calendars&&(l.calendars=Array.isArray(s.calendars)?s.calendars:s.calendars.split(",").filter(Boolean));const{today:i,future:g}=G();l.start||(l.start=i),l.end||(l.end=g)},N=ne(()=>{const s=Object.fromEntries(Object.entries(l).filter(([e,i])=>e==="calendars"?i.length:i!==""&&i!=null).map(([e,i])=>Array.isArray(i)?[e,i.join(",")]:[e,i]));M.replace({query:s})},200);function re(){N()}ee(()=>{ie()}),F([l,k],N,{deep:!0});function w(s){if(s==="calendars")l.calendars=[];else if(s==="date"){l.date="";const{today:e,future:i}=G();l.start=e,l.end=i}else if(s==="start"||s==="end"){const{today:e,future:i}=G();l.start=e,l.end=i}else l[s]=""}const ue=v([]),R=v([]),U=v([]),$=v([]),P=v([]),de=ne(async()=>{const{data:s,message:e}=await I.getEvents(l)||{},{events:i,calendars:g,titles:n,locales:f}=s;P.value=await I.getTitles()||[],S.value=i,ue.value=g,R.value=n,U.value=f;const r=Array.from(new Set(S.value.map(C=>C.title||"Sem título"))),j=P.value.filter(C=>r.includes(C));r.forEach(C=>{j.includes(C)||j.push(C)}),$.value=j,oe.success(e||"Eventos carregados com sucesso.")},400);F(()=>l,async()=>{l.start&&de()},{immediate:!0,deep:!0});const b=x(()=>{const s={};return S.value.forEach(e=>{const i=e.title||"Sem título";(s[i]||=[]).push(e)}),$.value.filter(e=>s[e]).map(e=>({title:e,items:s[e].slice().sort((i,g)=>i.onDate&&g.onDate?i.onDate-g.onDate:0)}))}),H=s=>s?.replace(/-$/,"")?.trim(),ce=x(()=>{let s=0;return l.search&&s++,l.title&&s++,l.locale&&s++,l.date&&s++,l.calendars&&l.calendars.length>0&&s++,s}),ve=()=>{d.value="lista",setTimeout(()=>{window.print()},1e3)},h=v(null),T=v(null),W=s=>{h.value=s},K=s=>{T.value=s},J=s=>{if(h.value===null||h.value===s){h.value=null,T.value=null;return}const e=[...$.value],[i]=e.splice(h.value,1);e.splice(s,0,i),$.value=e,h.value=null,T.value=null},p=Z({});F(b,()=>{if(!b.value)return;const s=b.value.map(e=>e.title);s.forEach(e=>{e in p||(p[e]=!0)});for(const e in p)s.includes(e)||delete p[e]},{immediate:!0});const Q=s=>{d.value="print",p[s]=!p[s]},X=x(()=>b.value.length>0&&b.value.every(s=>p[s.title])),pe=s=>{b.value.forEach(e=>{p[e.title]=s})},E=v(null),fe=x(()=>Object.values(p).filter(Boolean).length);ee(()=>{E.value=new $e({extensions:[Te],content:`
      <p>Oração Santa Ceia</p>
      <p><strong>Pão:</strong> "Senhor, abençoa este Pão que vamos comer, que é a comunhão do Corpo de Cristo."</p>
      <p><strong>Cálice:</strong> "Senhor, abençoa o Cálice que vamos beber, que é a comunhão do Sangue de Cristo."</p>
    `,editable:!0})}),ke(()=>{E.value&&E.value.destroy()});const me=s=>{M.push({path:"/evento",query:{id:s.id}})},Y=s=>{s&&s.htmlLink&&window.open(s.htmlLink,"_blank")};return(s,e)=>{const i=be,g=ge;return o(),a("div",null,[q.value?(o(),te(i,{key:0})):(o(),a(y,{key:1},[t("div",Le,[t("nav",we,[t("span",{id:"tab-filters","aria-selected":d.value==="filters",role:"tab",type:"button",class:_(["tab",{active:d.value==="filters"}]),style:{position:"relative"},onClick:e[0]||(e[0]=n=>d.value="filters")},[t("span",Ae,u(ce.value),1),e[15]||(e[15]=t("i",{class:"la la-filter z-10"},null,-1))],10,xe),t("span",{id:"tab-print","aria-selected":d.value==="print",role:"tab",type:"button",class:_(["tab",{active:d.value==="print"}]),onClick:e[1]||(e[1]=n=>d.value="print")},[t("span",ze,u(fe.value),1),e[16]||(e[16]=t("i",{class:"la la-print"},null,-1))],10,Ve),t("span",{id:"tab-lista","aria-selected":d.value==="lista",role:"tab",type:"button",class:_(["tab",{active:d.value==="lista"}]),onClick:e[2]||(e[2]=n=>d.value="lista")}," Lista ",10,qe)])]),t("div",null,[t("div",Oe,[m(t("div",je,[t("div",{class:"text-center",style:B({fontSize:k.value+"em"})},[e[17]||(e[17]=t("div",null,"LISTA DE ATENDIMENTO E DIVERSOS",-1)),l.calendars.length?(o(),a("div",Fe,[t("b",null,u(l.calendars.map(H).join(", ")),1)])):c("",!0),l.locale?(o(),a("span",Be,[t("b",null,u(H(l.locale)),1)])):c("",!0),!l.date&&(l.start||l.end)?(o(),a("div",Ge," Período: "+u(l.start?.split("T")[0]?.split("-")?.reverse()?.join("/"))+" à "+u(l.end?.split("T")[0]?.split("-")?.reverse()?.join("/")),1)):c("",!0),l.search?(o(),a("div",Ie,u(l.search.replace(/\!\S+/gi,"")),1)):c("",!0)],4)],512),[[A,d.value==="lista"]]),m(t("div",Me,[t("div",Ne,[t("div",Re,[t("div",null,[t("div",Ue,[e[18]||(e[18]=t("label",{for:"search"},"Pesquisar",-1)),t("div",Pe,[m(t("input",{id:"search","onUpdate:modelValue":e[3]||(e[3]=n=>l.search=n),type:"text",placeholder:"Buscar itens..."},null,512),[[V,l.search]]),l.search?(o(),a("button",{key:0,class:"btn-clear","aria-label":"Limpar pesquisa",type:"button",onClick:e[4]||(e[4]=n=>w("search"))}," × ")):c("",!0)])]),t("div",He,[e[20]||(e[20]=t("label",{for:"title"},"Título",-1)),t("div",We,[m(t("select",{id:"title","onUpdate:modelValue":e[5]||(e[5]=n=>l.title=n)},[e[19]||(e[19]=t("option",{value:""},"Todos os títulos",-1)),(o(!0),a(y,null,D(R.value,n=>(o(),a("option",{key:n,value:n},u(n),9,Ke))),128))],512),[[se,l.title]]),l.title?(o(),a("button",{key:0,class:"btn-clear","aria-label":"Limpar título",type:"button",onClick:e[6]||(e[6]=n=>w("title"))}," × ")):c("",!0)])]),t("div",Je,[e[22]||(e[22]=t("label",{for:"locale"},"Local",-1)),t("div",Qe,[m(t("select",{id:"locale","onUpdate:modelValue":e[7]||(e[7]=n=>l.locale=n)},[e[21]||(e[21]=t("option",{value:""},"Todos os locais",-1)),(o(!0),a(y,null,D(U.value,n=>(o(),a("option",{key:n,value:n},u(n),9,Xe))),128))],512),[[se,l.locale]]),l.locale?(o(),a("button",{key:0,class:"btn-clear","aria-label":"Limpar local",type:"button",onClick:e[8]||(e[8]=n=>w("locale"))}," × ")):c("",!0)])]),t("div",Ye,[e[23]||(e[23]=t("label",null,"Intervalo de Datas",-1)),t("div",Ze,[m(t("input",{"onUpdate:modelValue":e[9]||(e[9]=n=>l.start=n),type:"date"},null,512),[[V,l.start]]),m(t("input",{"onUpdate:modelValue":e[10]||(e[10]=n=>l.end=n),type:"date"},null,512),[[V,l.end]]),l.start||l.end?(o(),a("button",{key:0,class:"btn-clear","aria-label":"Limpar datas",type:"button",onClick:e[11]||(e[11]=n=>w("date"))}," × ")):c("",!0)])])]),t("div",null,[t("div",et,[e[24]||(e[24]=t("label",null,null,-1)),t("button",{class:"success",disabled:q.value,onClick:e[12]||(e[12]=n=>re())},u(q.value?"Atualizando...":"Aplicar"),9,tt)])])]),t("div",st,[t("span",null,[e[25]||(e[25]=t("i",{class:"la la-tasks"},null,-1)),z(" "+u(Array.isArray(S.value)?S.value.length:0),1)])])])],512),[[A,d.value==="filters"]]),m(t("div",lt,[t("div",{class:"text-center flex col items-center gap-4"},[e[27]||(e[27]=t("b",{class:"mb-4 p"},"Ajustes de impressão:",-1)),t("div",{class:"p"},[t("button",{class:"success",onClick:ve},[...e[26]||(e[26]=[t("i",{class:"la la-print"},null,-1),z(" Imprimir ",-1)])])])]),t("div",nt,[t("div",ot,[e[28]||(e[28]=t("b",null,"Tamanho da Fonte",-1)),m(t("input",{id:"fontSizeSlider",type:"range","onUpdate:modelValue":e[13]||(e[13]=n=>k.value=n),min:"0.5",max:"1.6",step:"0.05",list:"fontSteps"},null,512),[[V,k.value,void 0,{number:!0}]]),t("datalist",at,[(o(),a(y,null,D(15,n=>t("option",{key:n,value:(n*.1).toFixed(1)},null,8,it)),64))])]),t("div",rt,[e[29]||(e[29]=t("b",null,"Lista",-1)),t("div",null,[t("i",{class:_(["la",X.value?"la-toggle-on":"la-toggle-off"]),title:"Ocultar todos",onClick:e[14]||(e[14]=n=>pe(!X.value))},null,2)])]),(o(!0),a(y,null,D($.value,(n,f)=>(o(),a("div",{key:n,class:_(["settings-list print-hide",{"drag-over":T.value===f}]),draggable:"true",onDragstart:r=>W(f),onDragover:L(r=>K(f),["prevent"]),onDrop:r=>J(f),onClick:r=>Q(n)},[z(u(n)+" ",1),t("i",{class:_(["la",p[n]?"la-toggle-on":"la-toggle-off"]),title:"Alterar visibilidade"},null,2)],42,ut))),128))])],512),[[A,d.value==="print"]])])]),b.value.length?(o(),a("div",dt,[(o(!0),a(y,null,D(b.value,(n,f)=>m((o(),a("div",{key:n.title,class:_(["table-list",{"drag-over":T.value===f}]),draggable:"true",style:{cursor:"move"},onDragstart:r=>W(f),onDragover:L(r=>K(f),["prevent"]),onDrop:r=>J(f)},[t("div",{class:"table-container",style:B({fontSize:k.value+"em"})},[t("table",null,[t("thead",null,[t("tr",null,[t("th",vt,[t("div",pt,[z(u(n.title)+" ",1),t("i",{class:"la la-toggle-on print-hide",style:{cursor:"pointer"},onClick:r=>Q(n.title)},null,8,ft)])])])]),t("tbody",null,[(o(!0),a(y,null,D(n.items,r=>(o(),a("tr",{key:r.id,onClick:L(O=>me(r),["left"]),onContextmenu:L(O=>Y(r),["prevent"]),onMousedown:L(O=>Y(r),["right","prevent"])},[t("td",null,[r.formatDate?(o(),a("span",bt,u(r.formatDate),1)):c("",!0)]),t("td",null,[r.formatWeek?(o(),a("span",gt,u(r.formatWeek),1)):c("",!0)]),t("td",null,[r.formatTime?(o(),a("span",yt,u(r.formatTime),1)):c("",!0)]),t("td",null,u(r.locale),1),t("td",null,[r.desc?(o(),a("span",{key:0,innerHTML:le(Se)(r.desc)},null,8,_t)):c("",!0)])],40,mt))),128))])])],4)],42,ct)),[[A,p[n.title]]])),128)),E.value?(o(),te(le(Ee),{key:0,editor:E.value,class:"editable",style:B({fontSize:k.value+"em"})},null,8,["editor","style"])):c("",!0)])):(o(),a("div",kt,[e[30]||(e[30]=t("p",{class:"text-center p"}," Nenhum evento encontrado com os filtros aplicados. ",-1)),he(g)]))],64))])}}},wt=ye(ht,[["__scopeId","data-v-218156b3"]]);export{wt as default};
